<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Dynamic branching | The drake R Package User Manual</title>
  <meta name="description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Dynamic branching | The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://books.ropensci.org/drake/" />
  <meta property="og:image" content="https://books.ropensci.org/drake//images/logo.png" />
  <meta property="og:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="github-repo" content="ropensci-books/drake" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Dynamic branching | The drake R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="twitter:image" content="https://books.ropensci.org/drake//images/logo.png" />

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert, Ellis Hughes, Matthew Mark Strasiotto" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="static.html"/>
<link rel="next" href="projects.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150843595-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150843595-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="https://ropensci.github.io/dev_guide/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The drake R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#short-version"><i class="fa fa-check"></i><b>1.1</b> Short version</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#long-version"><i class="fa fa-check"></i><b>1.2</b> Long version</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.3</b> The drake R package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.4</b> Installation</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.5</b> Why drake?</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.5.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.5.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#scale-up-and-out."><i class="fa fa-check"></i><b>1.5.3</b> Scale up and out.</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#with-docker"><i class="fa fa-check"></i><b>1.6</b> With Docker</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.7</b> Documentation</a><ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.7.1</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.7.2</b> Function reference</a></li>
<li class="chapter" data-level="1.7.3" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.7.3</b> Tutorials</a></li>
<li class="chapter" data-level="1.7.4" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.7.4</b> Examples</a></li>
<li class="chapter" data-level="1.7.5" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.7.5</b> Presentations</a></li>
<li class="chapter" data-level="1.7.6" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.7.6</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.8</b> Help and troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="similar-work.html"><a href="similar-work.html"><i class="fa fa-check"></i><b>2</b> Similar work</a><ul>
<li class="chapter" data-level="2.1" data-path="similar-work.html"><a href="similar-work.html#pipeline-tools"><i class="fa fa-check"></i><b>2.1</b> Pipeline tools</a><ul>
<li class="chapter" data-level="2.1.1" data-path="similar-work.html"><a href="similar-work.html#gnu-make"><i class="fa fa-check"></i><b>2.1.1</b> GNU Make</a></li>
<li class="chapter" data-level="2.1.2" data-path="similar-work.html"><a href="similar-work.html#remake"><i class="fa fa-check"></i><b>2.1.2</b> Remake</a></li>
<li class="chapter" data-level="2.1.3" data-path="similar-work.html"><a href="similar-work.html#factuals-drake"><i class="fa fa-check"></i><b>2.1.3</b> Factual’s Drake</a></li>
<li class="chapter" data-level="2.1.4" data-path="similar-work.html"><a href="similar-work.html#other-pipeline-tools"><i class="fa fa-check"></i><b>2.1.4</b> Other pipeline tools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="similar-work.html"><a href="similar-work.html#memoization"><i class="fa fa-check"></i><b>2.2</b> Memoization</a></li>
<li class="chapter" data-level="2.3" data-path="similar-work.html"><a href="similar-work.html#literate-programming"><i class="fa fa-check"></i><b>2.3</b> Literate programming</a><ul>
<li class="chapter" data-level="2.3.1" data-path="similar-work.html"><a href="similar-work.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>2.3.1</b> knitr and R Markdown</a></li>
<li class="chapter" data-level="2.3.2" data-path="similar-work.html"><a href="similar-work.html#version-control"><i class="fa fa-check"></i><b>2.3.2</b> Version control</a></li>
<li class="chapter" data-level="2.3.3" data-path="similar-work.html"><a href="similar-work.html#containerization-and-r-package-environments"><i class="fa fa-check"></i><b>2.3.3</b> Containerization and R package environments</a></li>
<li class="chapter" data-level="2.3.4" data-path="similar-work.html"><a href="similar-work.html#workflowr"><i class="fa fa-check"></i><b>2.3.4</b> workflowr</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="similar-work.html"><a href="similar-work.html#acknowledgements"><i class="fa fa-check"></i><b>2.4</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="3" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>3</b> Walkthrough</a><ul>
<li class="chapter" data-level="3.1" data-path="walkthrough.html"><a href="walkthrough.html#set-the-stage."><i class="fa fa-check"></i><b>3.1</b> Set the stage.</a></li>
<li class="chapter" data-level="3.2" data-path="walkthrough.html"><a href="walkthrough.html#make-your-results."><i class="fa fa-check"></i><b>3.2</b> Make your results.</a></li>
<li class="chapter" data-level="3.3" data-path="walkthrough.html"><a href="walkthrough.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>3.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="3.4" data-path="walkthrough.html"><a href="walkthrough.html#history-and-provenance"><i class="fa fa-check"></i><b>3.4</b> History and provenance</a></li>
<li class="chapter" data-level="3.5" data-path="walkthrough.html"><a href="walkthrough.html#reproducible-data-recovery-and-renaming"><i class="fa fa-check"></i><b>3.5</b> Reproducible data recovery and renaming</a><ul>
<li class="chapter" data-level="3.5.1" data-path="walkthrough.html"><a href="walkthrough.html#undoing-clean"><i class="fa fa-check"></i><b>3.5.1</b> Undoing <code>clean()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="walkthrough.html"><a href="walkthrough.html#renaming"><i class="fa fa-check"></i><b>3.5.2</b> Renaming</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="walkthrough.html"><a href="walkthrough.html#try-the-code-yourself"><i class="fa fa-check"></i><b>3.6</b> Try the code yourself!</a></li>
<li class="chapter" data-level="3.7" data-path="walkthrough.html"><a href="walkthrough.html#thanks"><i class="fa fa-check"></i><b>3.7</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>4</b> <code>drake</code> plans</a><ul>
<li class="chapter" data-level="4.1" data-path="plans.html"><a href="plans.html#functions"><i class="fa fa-check"></i><b>4.1</b> Functions</a></li>
<li class="chapter" data-level="4.2" data-path="plans.html"><a href="plans.html#intro-to-plans"><i class="fa fa-check"></i><b>4.2</b> Intro to plans</a></li>
<li class="chapter" data-level="4.3" data-path="plans.html"><a href="plans.html#how-to-choose-good-targets"><i class="fa fa-check"></i><b>4.3</b> How to choose good targets</a></li>
<li class="chapter" data-level="4.4" data-path="plans.html"><a href="plans.html#special-data-formats-for-targets"><i class="fa fa-check"></i><b>4.4</b> Special data formats for targets</a></li>
<li class="chapter" data-level="4.5" data-path="plans.html"><a href="plans.html#special-columns"><i class="fa fa-check"></i><b>4.5</b> Special columns</a></li>
<li class="chapter" data-level="4.6" data-path="plans.html"><a href="plans.html#external-files-and-directories"><i class="fa fa-check"></i><b>4.6</b> External files and directories</a><ul>
<li class="chapter" data-level="4.6.1" data-path="plans.html"><a href="plans.html#urls"><i class="fa fa-check"></i><b>4.6.1</b> URLs</a></li>
<li class="chapter" data-level="4.6.2" data-path="plans.html"><a href="plans.html#limitations-of-file-tracking"><i class="fa fa-check"></i><b>4.6.2</b> Limitations of file tracking</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="plans.html"><a href="plans.html#large-plans"><i class="fa fa-check"></i><b>4.7</b> Large plans</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="static.html"><a href="static.html"><i class="fa fa-check"></i><b>5</b> Static branching</a><ul>
<li class="chapter" data-level="5.1" data-path="static.html"><a href="static.html#why-static-branching"><i class="fa fa-check"></i><b>5.1</b> Why static branching?</a></li>
<li class="chapter" data-level="5.2" data-path="static.html"><a href="static.html#grouping-variables-and-the-trace"><i class="fa fa-check"></i><b>5.2</b> Grouping variables and the trace</a><ul>
<li class="chapter" data-level="5.2.1" data-path="static.html"><a href="static.html#unnested-grouping-variables"><i class="fa fa-check"></i><b>5.2.1</b> Unnested grouping variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="static.html"><a href="static.html#tidy-evaluation"><i class="fa fa-check"></i><b>5.3</b> Tidy evaluation</a></li>
<li class="chapter" data-level="5.4" data-path="static.html"><a href="static.html#static-transformations"><i class="fa fa-check"></i><b>5.4</b> Static transformations</a><ul>
<li class="chapter" data-level="5.4.1" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>5.4.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="5.4.2" data-path="static.html"><a href="static.html#cross"><i class="fa fa-check"></i><b>5.4.2</b> <code>cross()</code></a></li>
<li class="chapter" data-level="5.4.3" data-path="static.html"><a href="static.html#split"><i class="fa fa-check"></i><b>5.4.3</b> <code>split()</code></a></li>
<li class="chapter" data-level="5.4.4" data-path="static.html"><a href="static.html#combine"><i class="fa fa-check"></i><b>5.4.4</b> <code>combine()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="static.html"><a href="static.html#tags"><i class="fa fa-check"></i><b>5.5</b> Tags</a><ul>
<li class="chapter" data-level="5.5.1" data-path="static.html"><a href="static.html#target-names"><i class="fa fa-check"></i><b>5.5.1</b> Target names</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>6</b> Dynamic branching</a><ul>
<li class="chapter" data-level="6.1" data-path="dynamic.html"><a href="dynamic.html#a-note-about-versions"><i class="fa fa-check"></i><b>6.1</b> A note about versions</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic.html"><a href="dynamic.html#motivation"><i class="fa fa-check"></i><b>6.2</b> Motivation</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic.html"><a href="dynamic.html#which-kind-of-branching-should-i-use"><i class="fa fa-check"></i><b>6.3</b> Which kind of branching should I use?</a></li>
<li class="chapter" data-level="6.4" data-path="dynamic.html"><a href="dynamic.html#dynamic-targets"><i class="fa fa-check"></i><b>6.4</b> Dynamic targets</a></li>
<li class="chapter" data-level="6.5" data-path="dynamic.html"><a href="dynamic.html#dynamic-transformations"><i class="fa fa-check"></i><b>6.5</b> Dynamic transformations</a><ul>
<li class="chapter" data-level="6.5.1" data-path="dynamic.html"><a href="dynamic.html#map-1"><i class="fa fa-check"></i><b>6.5.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="dynamic.html"><a href="dynamic.html#cross-1"><i class="fa fa-check"></i><b>6.5.2</b> <code>cross()</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="dynamic.html"><a href="dynamic.html#group"><i class="fa fa-check"></i><b>6.5.3</b> <code>group()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="dynamic.html"><a href="dynamic.html#trace"><i class="fa fa-check"></i><b>6.6</b> Trace</a></li>
<li class="chapter" data-level="6.7" data-path="dynamic.html"><a href="dynamic.html#max_expand"><i class="fa fa-check"></i><b>6.7</b> <code>max_expand</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>7</b> <code>drake</code> projects</a><ul>
<li class="chapter" data-level="7.1" data-path="projects.html"><a href="projects.html#code-files"><i class="fa fa-check"></i><b>7.1</b> Code files</a></li>
<li class="chapter" data-level="7.2" data-path="projects.html"><a href="projects.html#safer-interactivity"><i class="fa fa-check"></i><b>7.2</b> Safer interactivity</a><ul>
<li class="chapter" data-level="7.2.1" data-path="projects.html"><a href="projects.html#motivation-1"><i class="fa fa-check"></i><b>7.2.1</b> Motivation</a></li>
<li class="chapter" data-level="7.2.2" data-path="projects.html"><a href="projects.html#usage"><i class="fa fa-check"></i><b>7.2.2</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="projects.html"><a href="projects.html#script-file-pitfalls"><i class="fa fa-check"></i><b>7.3</b> Script file pitfalls</a></li>
<li class="chapter" data-level="7.4" data-path="projects.html"><a href="projects.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>7.4</b> Workflows as R packages</a></li>
<li class="chapter" data-level="7.5" data-path="projects.html"><a href="projects.html#other-tools"><i class="fa fa-check"></i><b>7.5</b> Other tools</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="scripts.html"><a href="scripts.html"><i class="fa fa-check"></i><b>8</b> Script-based workflows</a><ul>
<li class="chapter" data-level="8.1" data-path="scripts.html"><a href="scripts.html#function-oriented-workflows"><i class="fa fa-check"></i><b>8.1</b> Function-oriented workflows</a></li>
<li class="chapter" data-level="8.2" data-path="scripts.html"><a href="scripts.html#traditional-and-legacy-workflows"><i class="fa fa-check"></i><b>8.2</b> Traditional and legacy workflows</a></li>
<li class="chapter" data-level="8.3" data-path="scripts.html"><a href="scripts.html#overcoming-technical-debt"><i class="fa fa-check"></i><b>8.3</b> Overcoming Technical Debt</a></li>
<li class="chapter" data-level="8.4" data-path="scripts.html"><a href="scripts.html#dependencies"><i class="fa fa-check"></i><b>8.4</b> Dependencies</a></li>
<li class="chapter" data-level="8.5" data-path="scripts.html"><a href="scripts.html#building-the-connections"><i class="fa fa-check"></i><b>8.5</b> Building the connections</a></li>
<li class="chapter" data-level="8.6" data-path="scripts.html"><a href="scripts.html#run-the-workflow"><i class="fa fa-check"></i><b>8.6</b> Run the workflow</a></li>
<li class="chapter" data-level="8.7" data-path="scripts.html"><a href="scripts.html#keeping-the-results-up-to-date"><i class="fa fa-check"></i><b>8.7</b> Keeping the results up to date</a></li>
<li class="chapter" data-level="8.8" data-path="scripts.html"><a href="scripts.html#final-thoughts"><i class="fa fa-check"></i><b>8.8</b> Final thoughts</a></li>
</ul></li>
<li class="part"><span><b>II Examples</b></span></li>
<li class="chapter" data-level="9" data-path="churn.html"><a href="churn.html"><i class="fa fa-check"></i><b>9</b> Customer churn and deep learning</a><ul>
<li class="chapter" data-level="9.1" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>9.1</b> Packages</a></li>
<li class="chapter" data-level="9.2" data-path="churn.html"><a href="churn.html#functions-1"><i class="fa fa-check"></i><b>9.2</b> Functions</a></li>
<li class="chapter" data-level="9.3" data-path="churn.html"><a href="churn.html#plan"><i class="fa fa-check"></i><b>9.3</b> Plan</a></li>
<li class="chapter" data-level="9.4" data-path="churn.html"><a href="churn.html#dependency-graph"><i class="fa fa-check"></i><b>9.4</b> Dependency graph</a></li>
<li class="chapter" data-level="9.5" data-path="churn.html"><a href="churn.html#run-the-models"><i class="fa fa-check"></i><b>9.5</b> Run the models</a></li>
<li class="chapter" data-level="9.6" data-path="churn.html"><a href="churn.html#inspect-the-results"><i class="fa fa-check"></i><b>9.6</b> Inspect the results</a></li>
<li class="chapter" data-level="9.7" data-path="churn.html"><a href="churn.html#add-models"><i class="fa fa-check"></i><b>9.7</b> Add models</a></li>
<li class="chapter" data-level="9.8" data-path="churn.html"><a href="churn.html#inspect-the-results-again"><i class="fa fa-check"></i><b>9.8</b> Inspect the results again</a></li>
<li class="chapter" data-level="9.9" data-path="churn.html"><a href="churn.html#update-your-code"><i class="fa fa-check"></i><b>9.9</b> Update your code</a></li>
<li class="chapter" data-level="9.10" data-path="churn.html"><a href="churn.html#history-and-provenance-1"><i class="fa fa-check"></i><b>9.10</b> History and provenance</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>10</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="10.1" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>10.1</b> Get the code.</a></li>
<li class="chapter" data-level="10.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>10.2</b> Overview</a></li>
<li class="chapter" data-level="10.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>10.3</b> Analysis</a></li>
<li class="chapter" data-level="10.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>10.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>11</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="11.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>11.1</b> Get the code.</a></li>
<li class="chapter" data-level="11.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>11.2</b> Objective and methods</a></li>
<li class="chapter" data-level="11.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>11.3</b> Data</a></li>
<li class="chapter" data-level="11.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>11.4</b> Analysis</a></li>
<li class="chapter" data-level="11.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>11.5</b> Results</a></li>
<li class="chapter" data-level="11.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>11.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="11.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>11.7</b> References</a></li>
</ul></li>
<li class="part"><span><b>III Resource management</b></span></li>
<li class="chapter" data-level="12" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>12</b> High-performance computing</a><ul>
<li class="chapter" data-level="12.1" data-path="hpc.html"><a href="hpc.html#start-small"><i class="fa fa-check"></i><b>12.1</b> Start small</a></li>
<li class="chapter" data-level="12.2" data-path="hpc.html"><a href="hpc.html#let-make-schedule-your-targets."><i class="fa fa-check"></i><b>12.2</b> Let <code>make()</code> schedule your targets.</a></li>
<li class="chapter" data-level="12.3" data-path="hpc.html"><a href="hpc.html#the-master-process"><i class="fa fa-check"></i><b>12.3</b> The master process</a><ul>
<li class="chapter" data-level="12.3.1" data-path="hpc.html"><a href="hpc.html#master-on-a-cluster"><i class="fa fa-check"></i><b>12.3.1</b> Master on a cluster</a></li>
<li class="chapter" data-level="12.3.2" data-path="hpc.html"><a href="hpc.html#local-master"><i class="fa fa-check"></i><b>12.3.2</b> Local master</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>12.4</b> Parallel backends</a></li>
<li class="chapter" data-level="12.5" data-path="hpc.html"><a href="hpc.html#the-clustermq-backend"><i class="fa fa-check"></i><b>12.5</b> The <code>clustermq</code> backend</a><ul>
<li class="chapter" data-level="12.5.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>12.5.1</b> Persistent workers</a></li>
<li class="chapter" data-level="12.5.2" data-path="hpc.html"><a href="hpc.html#installation-1"><i class="fa fa-check"></i><b>12.5.2</b> Installation</a></li>
<li class="chapter" data-level="12.5.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine"><i class="fa fa-check"></i><b>12.5.3</b> On your local machine</a></li>
<li class="chapter" data-level="12.5.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster"><i class="fa fa-check"></i><b>12.5.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="hpc.html"><a href="hpc.html#the-future-backend"><i class="fa fa-check"></i><b>12.6</b> The <code>future</code> backend</a><ul>
<li class="chapter" data-level="12.6.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>12.6.1</b> Transient workers</a></li>
<li class="chapter" data-level="12.6.2" data-path="hpc.html"><a href="hpc.html#installation-2"><i class="fa fa-check"></i><b>12.6.2</b> Installation</a></li>
<li class="chapter" data-level="12.6.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine-1"><i class="fa fa-check"></i><b>12.6.3</b> On your local machine</a></li>
<li class="chapter" data-level="12.6.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster-1"><i class="fa fa-check"></i><b>12.6.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="hpc.html"><a href="hpc.html#advanced-options"><i class="fa fa-check"></i><b>12.7</b> Advanced options</a><ul>
<li class="chapter" data-level="12.7.1" data-path="hpc.html"><a href="hpc.html#selectivity"><i class="fa fa-check"></i><b>12.7.1</b> Selectivity</a></li>
<li class="chapter" data-level="12.7.2" data-path="hpc.html"><a href="hpc.html#memory-options"><i class="fa fa-check"></i><b>12.7.2</b> Memory options</a></li>
<li class="chapter" data-level="12.7.3" data-path="hpc.html"><a href="hpc.html#storage-options"><i class="fa fa-check"></i><b>12.7.3</b> Storage options</a></li>
<li class="chapter" data-level="12.7.4" data-path="hpc.html"><a href="hpc.html#the-template-argument-for-persistent-workers"><i class="fa fa-check"></i><b>12.7.4</b> The <code>template</code> argument for persistent workers</a></li>
<li class="chapter" data-level="12.7.5" data-path="hpc.html"><a href="hpc.html#the-resources-column-for-transient-workers"><i class="fa fa-check"></i><b>12.7.5</b> The <code>resources</code> column for transient workers</a></li>
<li class="chapter" data-level="12.7.6" data-path="hpc.html"><a href="hpc.html#parallel-computing-within-targets"><i class="fa fa-check"></i><b>12.7.6</b> Parallel computing <em>within</em> targets</a></li>
<li class="chapter" data-level="12.7.7" data-path="hpc.html"><a href="hpc.html#custom-job-schedulers"><i class="fa fa-check"></i><b>12.7.7</b> Custom job schedulers</a></li>
<li class="chapter" data-level="12.7.8" data-path="hpc.html"><a href="hpc.html#hasty-mode"><i class="fa fa-check"></i><b>12.7.8</b> Hasty mode</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>13</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="13.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>13.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="13.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>13.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>14</b> Memory management</a><ul>
<li class="chapter" data-level="14.1" data-path="memory.html"><a href="memory.html#garbage-collection-and-custom-files"><i class="fa fa-check"></i><b>14.1</b> Garbage collection and custom files</a></li>
<li class="chapter" data-level="14.2" data-path="memory.html"><a href="memory.html#memory-strategies"><i class="fa fa-check"></i><b>14.2</b> Memory strategies</a></li>
<li class="chapter" data-level="14.3" data-path="memory.html"><a href="memory.html#data-splitting"><i class="fa fa-check"></i><b>14.3</b> Data splitting</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="storage.html"><a href="storage.html"><i class="fa fa-check"></i><b>15</b> Storage</a><ul>
<li class="chapter" data-level="15.1" data-path="storage.html"><a href="storage.html#special-data-formats-for-targets-1"><i class="fa fa-check"></i><b>15.1</b> Special data formats for targets</a></li>
<li class="chapter" data-level="15.2" data-path="storage.html"><a href="storage.html#cache-management"><i class="fa fa-check"></i><b>15.2</b> Cache management</a></li>
<li class="chapter" data-level="15.3" data-path="storage.html"><a href="storage.html#cache-formats"><i class="fa fa-check"></i><b>15.3</b> Cache formats</a><ul>
<li class="chapter" data-level="15.3.1" data-path="storage.html"><a href="storage.html#rds-caches"><i class="fa fa-check"></i><b>15.3.1</b> RDS caches</a></li>
<li class="chapter" data-level="15.3.2" data-path="storage.html"><a href="storage.html#database-caches"><i class="fa fa-check"></i><b>15.3.2</b> Database caches</a></li>
<li class="chapter" data-level="15.3.3" data-path="storage.html"><a href="storage.html#environment-caches"><i class="fa fa-check"></i><b>15.3.3</b> Environment caches</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="storage.html"><a href="storage.html#hash-algorithms"><i class="fa fa-check"></i><b>15.4</b> Hash algorithms</a></li>
</ul></li>
<li class="part"><span><b>IV Extra features</b></span></li>
<li class="chapter" data-level="16" data-path="visuals.html"><a href="visuals.html"><i class="fa fa-check"></i><b>16</b> Visualization with drake</a><ul>
<li class="chapter" data-level="16.1" data-path="visuals.html"><a href="visuals.html#plotting-plans"><i class="fa fa-check"></i><b>16.1</b> Plotting plans</a><ul>
<li class="chapter" data-level="16.1.1" data-path="visuals.html"><a href="visuals.html#vis_drake_graph"><i class="fa fa-check"></i><b>16.1.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="16.1.2" data-path="visuals.html"><a href="visuals.html#sankey_drake_graph"><i class="fa fa-check"></i><b>16.1.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="16.1.3" data-path="visuals.html"><a href="visuals.html#drake_ggraph"><i class="fa fa-check"></i><b>16.1.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="16.1.4" data-path="visuals.html"><a href="visuals.html#text_drake_graph"><i class="fa fa-check"></i><b>16.1.4</b> <code>text_drake_graph()</code></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="visuals.html"><a href="visuals.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>16.2</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="16.3" data-path="visuals.html"><a href="visuals.html#visualizing-target-status"><i class="fa fa-check"></i><b>16.3</b> Visualizing target status</a></li>
<li class="chapter" data-level="16.4" data-path="visuals.html"><a href="visuals.html#subgraphs"><i class="fa fa-check"></i><b>16.4</b> Subgraphs</a></li>
<li class="chapter" data-level="16.5" data-path="visuals.html"><a href="visuals.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>16.5</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="16.6" data-path="visuals.html"><a href="visuals.html#clusters"><i class="fa fa-check"></i><b>16.6</b> Clusters</a></li>
<li class="chapter" data-level="16.7" data-path="visuals.html"><a href="visuals.html#output-files"><i class="fa fa-check"></i><b>16.7</b> Output files</a></li>
<li class="chapter" data-level="16.8" data-path="visuals.html"><a href="visuals.html#node-selection"><i class="fa fa-check"></i><b>16.8</b> Node Selection</a><ul>
<li class="chapter" data-level="16.8.1" data-path="visuals.html"><a href="visuals.html#perform-the-default-action-on-select"><i class="fa fa-check"></i><b>16.8.1</b> Perform the default action on select</a></li>
<li class="chapter" data-level="16.8.2" data-path="visuals.html"><a href="visuals.html#perform-no-action-on-select"><i class="fa fa-check"></i><b>16.8.2</b> Perform no action on select</a></li>
<li class="chapter" data-level="16.8.3" data-path="visuals.html"><a href="visuals.html#customize-the-onselect-event-behaviour"><i class="fa fa-check"></i><b>16.8.3</b> Customize the onSelect event behaviour</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>17</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="17.0.1" data-path="debugging.html"><a href="debugging.html#start-small-1"><i class="fa fa-check"></i><b>17.0.1</b> Start small</a></li>
<li class="chapter" data-level="17.1" data-path="debugging.html"><a href="debugging.html#dependencies-1"><i class="fa fa-check"></i><b>17.1</b> Dependencies</a><ul>
<li class="chapter" data-level="17.1.1" data-path="debugging.html"><a href="debugging.html#visualize-your-dependency-graph."><i class="fa fa-check"></i><b>17.1.1</b> Visualize your dependency graph.</a></li>
<li class="chapter" data-level="17.1.2" data-path="debugging.html"><a href="debugging.html#check-specific-dependency-information."><i class="fa fa-check"></i><b>17.1.2</b> Check specific dependency information.</a></li>
<li class="chapter" data-level="17.1.3" data-path="debugging.html"><a href="debugging.html#outdated-targets-and-missing-dependencies"><i class="fa fa-check"></i><b>17.1.3</b> Outdated targets and missing dependencies</a></li>
<li class="chapter" data-level="17.1.4" data-path="debugging.html"><a href="debugging.html#but-why-are-my-targets-out-of-date"><i class="fa fa-check"></i><b>17.1.4</b> But <em>why</em> are my targets out of date?</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="debugging.html"><a href="debugging.html#diagnose-failures."><i class="fa fa-check"></i><b>17.2</b> Diagnose failures.</a></li>
<li class="chapter" data-level="17.3" data-path="debugging.html"><a href="debugging.html#timeouts-and-retries"><i class="fa fa-check"></i><b>17.3</b> Timeouts and retries</a></li>
<li class="chapter" data-level="17.4" data-path="debugging.html"><a href="debugging.html#more-help"><i class="fa fa-check"></i><b>17.4</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>18</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="18.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>18.1</b> What are triggers?</a></li>
<li class="chapter" data-level="18.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>18.2</b> Customization</a></li>
<li class="chapter" data-level="18.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>18.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="18.4" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>18.4</b> A more practical example</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>B</b> Cautionary notes</a><ul>
<li class="chapter" data-level="B.1" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>B.1</b> Workflow plans</a><ul>
<li class="chapter" data-level="B.1.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>B.1.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="B.1.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>B.1.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>B.2</b> Execution</a><ul>
<li class="chapter" data-level="B.2.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>B.2.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="B.2.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>B.2.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="B.2.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>B.2.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="B.2.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>B.2.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="B.2.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>B.2.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="B.2.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>B.2.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="B.2.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>B.2.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="B.2.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>B.2.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="caution.html"><a href="caution.html#dependencies-2"><i class="fa fa-check"></i><b>B.3</b> Dependencies</a><ul>
<li class="chapter" data-level="B.3.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-rebuild-too-often"><i class="fa fa-check"></i><b>B.3.1</b> Objects that contain functions may rebuild too often</a></li>
<li class="chapter" data-level="B.3.2" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>B.3.2</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="B.3.3" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>B.3.3</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="B.3.4" data-path="caution.html"><a href="caution.html#s3-and-generic-methods"><i class="fa fa-check"></i><b>B.3.4</b> S3 and generic methods</a></li>
<li class="chapter" data-level="B.3.5" data-path="caution.html"><a href="caution.html#file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>B.3.5</b> File outputs in imported functions.</a></li>
<li class="chapter" data-level="B.3.6" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>B.3.6</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="B.3.7" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.7</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.8" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.8</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.9" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>B.3.9</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>B.4</b> High-performance computing</a><ul>
<li class="chapter" data-level="B.4.1" data-path="caution.html"><a href="caution.html#calling-mclapply-within-targets"><i class="fa fa-check"></i><b>B.4.1</b> Calling <code>mclapply()</code> <em>within</em> targets</a></li>
<li class="chapter" data-level="B.4.2" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>B.4.2</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="caution.html"><a href="caution.html#storage-1"><i class="fa fa-check"></i><b>B.5</b> Storage</a><ul>
<li class="chapter" data-level="B.5.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>B.5.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="B.5.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>B.5.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="B.5.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>B.5.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dynamic" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Dynamic branching</h1>
<div id="a-note-about-versions" class="section level2">
<h2><span class="header-section-number">6.1</span> A note about versions</h2>
<p>The first release of dynamic branching was in <code>drake</code> version 7.8.0. In subsequent versions, dynamic branching behaves differently. This manual describes how dynamic branching works in development <code>drake</code> (to become version 7.9.0 in early January 2020). If you are using version 7.8.0, please refer to <a href="https://github.com/ropensci-books/drake/blob/c4dfa6dd71b5ffa4c6027633ae048d2ab0513c6d/dynamic.Rmd">this version of the chapter</a> instead.</p>
</div>
<div id="motivation" class="section level2">
<h2><span class="header-section-number">6.2</span> Motivation</h2>
<p>In large workflows, you may need more targets than you can easily type in a plan, and you may not be able to fully specify all targets in advance. Dynamic branching is an interface to declare new targets while <code>make()</code> is running. It lets you create more compact plans and graphs, it is easier to use than <a href="static.html#static">static branching</a>, and it improves the startup speed of <code>make()</code> and friends.</p>
</div>
<div id="which-kind-of-branching-should-i-use" class="section level2">
<h2><span class="header-section-number">6.3</span> Which kind of branching should I use?</h2>
<p>With dynamic branching, <code>make()</code> is faster to initialize, and you have far more flexibility. With <a href="static.html#static">static branching</a>, you have meaningful target names, and it is easier to predict what the plan is going to do in advance. There is a ton of room for overlap and personal judgement, and you can even use both kinds of branching together.</p>
</div>
<div id="dynamic-targets" class="section level2">
<h2><span class="header-section-number">6.4</span> Dynamic targets</h2>
<p>A dynamic target is a <a href="https://vctrs.r-lib.org/">vector</a> of <em>sub-targets</em>. We let <code>make()</code> figure out which sub-targets to create and how to aggregate them.</p>
<p>As an example, let’s fit a regression model to each continent in <a href="https://github.com/jennybc/gapminder">Gapminder data</a>. To activate dynamic branching, use the <code>dynamic</code> argument of <code>target()</code>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="kw">library</span>(drake)</a>
<a class="sourceLine" id="cb75-3" data-line-number="3"><span class="kw">library</span>(gapminder)</a>
<a class="sourceLine" id="cb75-4" data-line-number="4"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb75-5" data-line-number="5"></a>
<a class="sourceLine" id="cb75-6" data-line-number="6"><span class="co"># Split the Gapminder data by continent.</span></a>
<a class="sourceLine" id="cb75-7" data-line-number="7">gapminder_continents &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb75-8" data-line-number="8">  gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-9" data-line-number="9"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">gdpPercap =</span> <span class="kw">scale</span>(gdpPercap)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-10" data-line-number="10"><span class="st">    </span><span class="kw">split</span>(<span class="dt">f =</span> .<span class="op">$</span>continent)</a>
<a class="sourceLine" id="cb75-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb75-12" data-line-number="12"></a>
<a class="sourceLine" id="cb75-13" data-line-number="13"><span class="co"># Fit a model to a continent.</span></a>
<a class="sourceLine" id="cb75-14" data-line-number="14">fit_model &lt;-<span class="st"> </span><span class="cf">function</span>(continent_data) {</a>
<a class="sourceLine" id="cb75-15" data-line-number="15">  data &lt;-<span class="st"> </span>continent_data[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb75-16" data-line-number="16">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-17" data-line-number="17"><span class="st">    </span><span class="kw">lm</span>(<span class="dt">formula =</span> gdpPercap <span class="op">~</span><span class="st"> </span>year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-18" data-line-number="18"><span class="st">    </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-19" data-line-number="19"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">continent =</span> data<span class="op">$</span>continent[<span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-20" data-line-number="20"><span class="st">    </span><span class="kw">select</span>(continent, term, statistic, p.value)</a>
<a class="sourceLine" id="cb75-21" data-line-number="21">}</a>
<a class="sourceLine" id="cb75-22" data-line-number="22"></a>
<a class="sourceLine" id="cb75-23" data-line-number="23">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb75-24" data-line-number="24">  <span class="dt">continents =</span> <span class="kw">gapminder_continents</span>(),</a>
<a class="sourceLine" id="cb75-25" data-line-number="25">  <span class="dt">model =</span> <span class="kw">target</span>(<span class="kw">fit_model</span>(continents), <span class="dt">dynamic =</span> <span class="kw">map</span>(continents))</a>
<a class="sourceLine" id="cb75-26" data-line-number="26">)</a>
<a class="sourceLine" id="cb75-27" data-line-number="27"></a>
<a class="sourceLine" id="cb75-28" data-line-number="28"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb75-29" data-line-number="29"><span class="co">#&gt; target continents</span></a>
<a class="sourceLine" id="cb75-30" data-line-number="30"><span class="co">#&gt; dynamic model</span></a>
<a class="sourceLine" id="cb75-31" data-line-number="31"><span class="co">#&gt; subtarget model_23022788</span></a>
<a class="sourceLine" id="cb75-32" data-line-number="32"><span class="co">#&gt; subtarget model_e020ff00</span></a>
<a class="sourceLine" id="cb75-33" data-line-number="33"><span class="co">#&gt; subtarget model_53c1b086</span></a>
<a class="sourceLine" id="cb75-34" data-line-number="34"><span class="co">#&gt; subtarget model_0fc4392a</span></a>
<a class="sourceLine" id="cb75-35" data-line-number="35"><span class="co">#&gt; subtarget model_8b2d2fd5</span></a>
<a class="sourceLine" id="cb75-36" data-line-number="36"><span class="co">#&gt; aggregate model</span></a></code></pre></div>
<p>Thanks to <a href="https://vctrs.r-lib.org/"><code>vctrs</code></a>, the data type of every sub-target is the same as the dynamic target it belongs to. In other words, <code>model</code> and <code>model_23022788</code> are both data frames. To understand how <code>drake</code> splits and aggregates dynamic targets, see functions <a href="https://vctrs.r-lib.org/reference/vec_size.html"><code>vec_size()</code></a>, <a href="https://vctrs.r-lib.org/reference/vec_slice.html"><code>vec_slice()</code></a>, and <a href="https://vctrs.r-lib.org/reference/vec_c.html"><code>vec_c()</code></a>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">readd</span>(model)</a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="co">#&gt; # A tibble: 10 x 4</span></a>
<a class="sourceLine" id="cb76-3" data-line-number="3"><span class="co">#&gt;    continent term        statistic  p.value</span></a>
<a class="sourceLine" id="cb76-4" data-line-number="4"><span class="co">#&gt;  * &lt;fct&gt;     &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb76-5" data-line-number="5"><span class="co">#&gt;  1 Africa    (Intercept)     -4.44 1.08e- 5</span></a>
<a class="sourceLine" id="cb76-6" data-line-number="6"><span class="co">#&gt;  2 Africa    year             4.04 5.90e- 5</span></a>
<a class="sourceLine" id="cb76-7" data-line-number="7"><span class="co">#&gt;  3 Americas  (Intercept)     -5.56 6.10e- 8</span></a>
<a class="sourceLine" id="cb76-8" data-line-number="8"><span class="co">#&gt;  4 Americas  year             5.55 6.16e- 8</span></a>
<a class="sourceLine" id="cb76-9" data-line-number="9"><span class="co">#&gt;  5 Asia      (Intercept)     -2.74 6.39e- 3</span></a>
<a class="sourceLine" id="cb76-10" data-line-number="10"><span class="co">#&gt;  6 Asia      year             2.75 6.23e- 3</span></a>
<a class="sourceLine" id="cb76-11" data-line-number="11"><span class="co">#&gt;  7 Europe    (Intercept)    -14.4  3.12e-37</span></a>
<a class="sourceLine" id="cb76-12" data-line-number="12"><span class="co">#&gt;  8 Europe    year            14.5  7.06e-38</span></a>
<a class="sourceLine" id="cb76-13" data-line-number="13"><span class="co">#&gt;  9 Oceania   (Intercept)    -11.3  1.32e-10</span></a>
<a class="sourceLine" id="cb76-14" data-line-number="14"><span class="co">#&gt; 10 Oceania   year            11.5  9.48e-11</span></a></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw">readd</span>(model_<span class="dv">23022788</span>) <span class="co"># equivalent: readd(model, subtargets = 1)</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="co">#&gt; # A tibble: 2 x 4</span></a>
<a class="sourceLine" id="cb77-3" data-line-number="3"><span class="co">#&gt;   continent term        statistic   p.value</span></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="co">#&gt;   &lt;fct&gt;     &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="co">#&gt; 1 Africa    (Intercept)     -4.44 0.0000108</span></a>
<a class="sourceLine" id="cb77-6" data-line-number="6"><span class="co">#&gt; 2 Africa    year             4.04 0.0000590</span></a></code></pre></div>
<p>Likewise, when we write <code>dynamic = map(continents)</code> in the plan, <code>drake</code> treats <code>continents</code> as a <a href="https://vctrs.r-lib.org/">vector</a>. In other words, <code>target(fit_model(continents), dynamic = map(continents))</code> is equivalent to commands <code>fit_model(continents[1])</code> through <code>fit_model(continents[5])</code>. Since <code>continents</code> is really a list of data frames, <code>continents[1]</code> through <code>continents[5]</code> are also lists of data frames, which is why we need the line <code>data &lt;- continent_data[[1]]</code> in <code>fit_model()</code>. This may seem inconvenient at first, but it comes with extra type stability, and it allows us to reference a dynamic target and its sub-targets interchangeably.</p>
<p>To post-process our models, we can work with either the individual sub-targets or the whole vector of all the models. Below, <code>year</code> uses the former and <code>intercept</code> uses the latter.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">  <span class="dt">continents =</span> <span class="kw">gapminder_continents</span>(),</a>
<a class="sourceLine" id="cb78-3" data-line-number="3">  <span class="dt">model =</span> <span class="kw">target</span>(<span class="kw">fit_model</span>(continents), <span class="dt">dynamic =</span> <span class="kw">map</span>(continents)),</a>
<a class="sourceLine" id="cb78-4" data-line-number="4">  <span class="co"># Filter each model individually:</span></a>
<a class="sourceLine" id="cb78-5" data-line-number="5">  <span class="dt">year =</span> <span class="kw">target</span>(<span class="kw">filter</span>(model, term <span class="op">==</span><span class="st"> &quot;year&quot;</span>), <span class="dt">dynamic =</span> <span class="kw">map</span>(model)),</a>
<a class="sourceLine" id="cb78-6" data-line-number="6">  <span class="co"># Aggregate all the models, then filter the whole vector:</span></a>
<a class="sourceLine" id="cb78-7" data-line-number="7">  <span class="dt">intercept =</span> <span class="kw">filter</span>(model, term <span class="op">!=</span><span class="st"> &quot;year&quot;</span>)</a>
<a class="sourceLine" id="cb78-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb78-9" data-line-number="9"></a>
<a class="sourceLine" id="cb78-10" data-line-number="10"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb78-11" data-line-number="11"><span class="co">#&gt; dynamic year</span></a>
<a class="sourceLine" id="cb78-12" data-line-number="12"><span class="co">#&gt; subtarget year_8b2ba535</span></a>
<a class="sourceLine" id="cb78-13" data-line-number="13"><span class="co">#&gt; subtarget year_9eb9c094</span></a>
<a class="sourceLine" id="cb78-14" data-line-number="14"><span class="co">#&gt; subtarget year_063dea11</span></a>
<a class="sourceLine" id="cb78-15" data-line-number="15"><span class="co">#&gt; subtarget year_0171ca0a</span></a>
<a class="sourceLine" id="cb78-16" data-line-number="16"><span class="co">#&gt; subtarget year_7401d5f6</span></a>
<a class="sourceLine" id="cb78-17" data-line-number="17"><span class="co">#&gt; aggregate year</span></a>
<a class="sourceLine" id="cb78-18" data-line-number="18"><span class="co">#&gt; target intercept</span></a></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">readd</span>(year)</a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="co">#&gt; # A tibble: 5 x 4</span></a>
<a class="sourceLine" id="cb79-3" data-line-number="3"><span class="co">#&gt;   continent term  statistic  p.value</span></a>
<a class="sourceLine" id="cb79-4" data-line-number="4"><span class="co">#&gt; * &lt;fct&gt;     &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb79-5" data-line-number="5"><span class="co">#&gt; 1 Africa    year       4.04 5.90e- 5</span></a>
<a class="sourceLine" id="cb79-6" data-line-number="6"><span class="co">#&gt; 2 Americas  year       5.55 6.16e- 8</span></a>
<a class="sourceLine" id="cb79-7" data-line-number="7"><span class="co">#&gt; 3 Asia      year       2.75 6.23e- 3</span></a>
<a class="sourceLine" id="cb79-8" data-line-number="8"><span class="co">#&gt; 4 Europe    year      14.5  7.06e-38</span></a>
<a class="sourceLine" id="cb79-9" data-line-number="9"><span class="co">#&gt; 5 Oceania   year      11.5  9.48e-11</span></a></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">readd</span>(intercept)</a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="co">#&gt; # A tibble: 5 x 4</span></a>
<a class="sourceLine" id="cb80-3" data-line-number="3"><span class="co">#&gt;   continent term        statistic  p.value</span></a>
<a class="sourceLine" id="cb80-4" data-line-number="4"><span class="co">#&gt;   &lt;fct&gt;     &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb80-5" data-line-number="5"><span class="co">#&gt; 1 Africa    (Intercept)     -4.44 1.08e- 5</span></a>
<a class="sourceLine" id="cb80-6" data-line-number="6"><span class="co">#&gt; 2 Americas  (Intercept)     -5.56 6.10e- 8</span></a>
<a class="sourceLine" id="cb80-7" data-line-number="7"><span class="co">#&gt; 3 Asia      (Intercept)     -2.74 6.39e- 3</span></a>
<a class="sourceLine" id="cb80-8" data-line-number="8"><span class="co">#&gt; 4 Europe    (Intercept)    -14.4  3.12e-37</span></a>
<a class="sourceLine" id="cb80-9" data-line-number="9"><span class="co">#&gt; 5 Oceania   (Intercept)    -11.3  1.32e-10</span></a></code></pre></div>
</div>
<div id="dynamic-transformations" class="section level2">
<h2><span class="header-section-number">6.5</span> Dynamic transformations</h2>
<p>Dynamic branching supports transformations <code>map()</code>, <code>cross()</code>, and <code>group()</code>. These transformations tell <code>drake</code> how to create sub-targets.</p>
<div id="map-1" class="section level3">
<h3><span class="header-section-number">6.5.1</span> <code>map()</code></h3>
<p><code>map()</code> iterates over the <a href="https://vctrs.r-lib.org/reference/vec_slice.html">vector slices</a> of the targets you supply as arguments. We saw above how <code>map()</code> iterates over lists. If you give it a data frame, it will map over the rows.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb81-2" data-line-number="2">  <span class="dt">subset =</span> <span class="kw">head</span>(gapminder),</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">  <span class="dt">row =</span> <span class="kw">target</span>(subset, <span class="dt">dynamic =</span> <span class="kw">map</span>(subset))</a>
<a class="sourceLine" id="cb81-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb81-5" data-line-number="5"></a>
<a class="sourceLine" id="cb81-6" data-line-number="6"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb81-7" data-line-number="7"><span class="co">#&gt; target subset</span></a>
<a class="sourceLine" id="cb81-8" data-line-number="8"><span class="co">#&gt; dynamic row</span></a>
<a class="sourceLine" id="cb81-9" data-line-number="9"><span class="co">#&gt; subtarget row_9939cae3</span></a>
<a class="sourceLine" id="cb81-10" data-line-number="10"><span class="co">#&gt; subtarget row_e8047114</span></a>
<a class="sourceLine" id="cb81-11" data-line-number="11"><span class="co">#&gt; subtarget row_2ef3db10</span></a>
<a class="sourceLine" id="cb81-12" data-line-number="12"><span class="co">#&gt; subtarget row_f9171bbe</span></a>
<a class="sourceLine" id="cb81-13" data-line-number="13"><span class="co">#&gt; subtarget row_7d6002e9</span></a>
<a class="sourceLine" id="cb81-14" data-line-number="14"><span class="co">#&gt; subtarget row_509468b3</span></a>
<a class="sourceLine" id="cb81-15" data-line-number="15"><span class="co">#&gt; aggregate row</span></a></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="kw">readd</span>(row_9939cae3)</a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1 x 6</span></a>
<a class="sourceLine" id="cb82-3" data-line-number="3"><span class="co">#&gt;   country     continent  year lifeExp     pop gdpPercap</span></a>
<a class="sourceLine" id="cb82-4" data-line-number="4"><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb82-5" data-line-number="5"><span class="co">#&gt; 1 Afghanistan Asia       1952    28.8 8425333      779.</span></a></code></pre></div>
<p>If you supply multiple targets, <code>map()</code> iterates over the slices of each.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb83-2" data-line-number="2">  <span class="dt">numbers =</span> <span class="kw">seq_len</span>(<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb83-3" data-line-number="3">  <span class="dt">letters =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb83-4" data-line-number="4">  <span class="dt">zipped =</span> <span class="kw">target</span>(<span class="kw">paste0</span>(numbers, letters), <span class="dt">dynamic =</span> <span class="kw">map</span>(numbers, letters))</a>
<a class="sourceLine" id="cb83-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb83-6" data-line-number="6"></a>
<a class="sourceLine" id="cb83-7" data-line-number="7"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb83-8" data-line-number="8"><span class="co">#&gt; target numbers</span></a>
<a class="sourceLine" id="cb83-9" data-line-number="9"><span class="co">#&gt; target letters</span></a>
<a class="sourceLine" id="cb83-10" data-line-number="10"><span class="co">#&gt; dynamic zipped</span></a>
<a class="sourceLine" id="cb83-11" data-line-number="11"><span class="co">#&gt; subtarget zipped_8ac3968c</span></a>
<a class="sourceLine" id="cb83-12" data-line-number="12"><span class="co">#&gt; subtarget zipped_4a7a9b07</span></a>
<a class="sourceLine" id="cb83-13" data-line-number="13"><span class="co">#&gt; aggregate zipped</span></a></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw">readd</span>(zipped)</a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="co">#&gt; [1] &quot;1a&quot; &quot;2b&quot;</span></a></code></pre></div>
</div>
<div id="cross-1" class="section level3">
<h3><span class="header-section-number">6.5.2</span> <code>cross()</code></h3>
<p><code>cross()</code> creates a new sub-target for each combination of targets you supply as arguments.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb85-2" data-line-number="2">  <span class="dt">numbers =</span> <span class="kw">seq_len</span>(<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb85-3" data-line-number="3">  <span class="dt">letters =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb85-4" data-line-number="4">  <span class="dt">combo =</span> <span class="kw">target</span>(<span class="kw">paste0</span>(numbers, letters), <span class="dt">dynamic =</span> <span class="kw">cross</span>(numbers, letters))</a>
<a class="sourceLine" id="cb85-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb85-6" data-line-number="6"></a>
<a class="sourceLine" id="cb85-7" data-line-number="7"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb85-8" data-line-number="8"><span class="co">#&gt; dynamic combo</span></a>
<a class="sourceLine" id="cb85-9" data-line-number="9"><span class="co">#&gt; subtarget combo_8ac3968c</span></a>
<a class="sourceLine" id="cb85-10" data-line-number="10"><span class="co">#&gt; subtarget combo_ef37ab56</span></a>
<a class="sourceLine" id="cb85-11" data-line-number="11"><span class="co">#&gt; subtarget combo_ed1d2e7b</span></a>
<a class="sourceLine" id="cb85-12" data-line-number="12"><span class="co">#&gt; subtarget combo_4a7a9b07</span></a>
<a class="sourceLine" id="cb85-13" data-line-number="13"><span class="co">#&gt; aggregate combo</span></a></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">readd</span>(combo)</a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="co">#&gt; [1] &quot;1a&quot; &quot;1b&quot; &quot;2a&quot; &quot;2b&quot;</span></a></code></pre></div>
</div>
<div id="group" class="section level3">
<h3><span class="header-section-number">6.5.3</span> <code>group()</code></h3>
<p>With <code>group()</code>, you can create multiple aggregates of a given target. Use the <code>.by</code> argument to set a grouping variable.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb87-2" data-line-number="2">  <span class="dt">data =</span> gapminder,</a>
<a class="sourceLine" id="cb87-3" data-line-number="3">  <span class="dt">by =</span> data<span class="op">$</span>continent,</a>
<a class="sourceLine" id="cb87-4" data-line-number="4">  <span class="dt">gdp =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb87-5" data-line-number="5">    <span class="kw">tibble</span>(<span class="dt">median =</span> <span class="kw">median</span>(data<span class="op">$</span>gdpPercap), <span class="dt">continent =</span> by[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb87-6" data-line-number="6">    <span class="dt">dynamic =</span> <span class="kw">group</span>(data, <span class="dt">.by =</span> by)</a>
<a class="sourceLine" id="cb87-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb87-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb87-9" data-line-number="9"></a>
<a class="sourceLine" id="cb87-10" data-line-number="10"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb87-11" data-line-number="11"><span class="co">#&gt; target data</span></a>
<a class="sourceLine" id="cb87-12" data-line-number="12"><span class="co">#&gt; target by</span></a>
<a class="sourceLine" id="cb87-13" data-line-number="13"><span class="co">#&gt; dynamic gdp</span></a>
<a class="sourceLine" id="cb87-14" data-line-number="14"><span class="co">#&gt; subtarget gdp_9adfc39f</span></a>
<a class="sourceLine" id="cb87-15" data-line-number="15"><span class="co">#&gt; subtarget gdp_d9f30951</span></a>
<a class="sourceLine" id="cb87-16" data-line-number="16"><span class="co">#&gt; subtarget gdp_958a2f81</span></a>
<a class="sourceLine" id="cb87-17" data-line-number="17"><span class="co">#&gt; subtarget gdp_962b03c8</span></a>
<a class="sourceLine" id="cb87-18" data-line-number="18"><span class="co">#&gt; subtarget gdp_dc1cff81</span></a>
<a class="sourceLine" id="cb87-19" data-line-number="19"><span class="co">#&gt; aggregate gdp</span></a></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="kw">readd</span>(gdp)</a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="co">#&gt;   median continent</span></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="co">#&gt; *  &lt;dbl&gt; &lt;fct&gt;    </span></a>
<a class="sourceLine" id="cb88-5" data-line-number="5"><span class="co">#&gt; 1  2647. Asia     </span></a>
<a class="sourceLine" id="cb88-6" data-line-number="6"><span class="co">#&gt; 2 12082. Europe   </span></a>
<a class="sourceLine" id="cb88-7" data-line-number="7"><span class="co">#&gt; 3  1192. Africa   </span></a>
<a class="sourceLine" id="cb88-8" data-line-number="8"><span class="co">#&gt; 4  5466. Americas </span></a>
<a class="sourceLine" id="cb88-9" data-line-number="9"><span class="co">#&gt; 5 17983. Oceania</span></a></code></pre></div>
</div>
</div>
<div id="trace" class="section level2">
<h2><span class="header-section-number">6.6</span> Trace</h2>
<p>All dynamic transforms have a <code>.trace</code> argument to record optional metadata for each sub-target. In the example from <code>group()</code>, the trace is another way to keep track of the continent of each median GDP value.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb89-2" data-line-number="2">  <span class="dt">data =</span> gapminder,</a>
<a class="sourceLine" id="cb89-3" data-line-number="3">  <span class="dt">by =</span> data<span class="op">$</span>continent,</a>
<a class="sourceLine" id="cb89-4" data-line-number="4">  <span class="dt">gdp =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb89-5" data-line-number="5">    <span class="kw">median</span>(data<span class="op">$</span>gdpPercap),</a>
<a class="sourceLine" id="cb89-6" data-line-number="6">    <span class="dt">dynamic =</span> <span class="kw">group</span>(data, <span class="dt">.by =</span> by, <span class="dt">.trace =</span> by)</a>
<a class="sourceLine" id="cb89-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb89-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb89-9" data-line-number="9"></a>
<a class="sourceLine" id="cb89-10" data-line-number="10"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb89-11" data-line-number="11"><span class="co">#&gt; dynamic gdp</span></a>
<a class="sourceLine" id="cb89-12" data-line-number="12"><span class="co">#&gt; subtarget gdp_7e88fb1c</span></a>
<a class="sourceLine" id="cb89-13" data-line-number="13"><span class="co">#&gt; subtarget gdp_a61b8e1b</span></a>
<a class="sourceLine" id="cb89-14" data-line-number="14"><span class="co">#&gt; subtarget gdp_278ff532</span></a>
<a class="sourceLine" id="cb89-15" data-line-number="15"><span class="co">#&gt; subtarget gdp_6f3facea</span></a>
<a class="sourceLine" id="cb89-16" data-line-number="16"><span class="co">#&gt; subtarget gdp_73037e69</span></a>
<a class="sourceLine" id="cb89-17" data-line-number="17"><span class="co">#&gt; aggregate gdp</span></a></code></pre></div>
<p>The <code>gdp</code> target no longer contains any explicit reference to continent.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">readd</span>(gdp)</a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="co">#&gt; [1]  2646.787 12081.749  1192.138  5465.510 17983.304</span></a></code></pre></div>
<p>However, we can look up the continents in the trace.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw">read_trace</span>(<span class="st">&quot;by&quot;</span>, gdp)</a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="co">#&gt; [1] Asia     Europe   Africa   Americas Oceania </span></a>
<a class="sourceLine" id="cb91-3" data-line-number="3"><span class="co">#&gt; Levels: Africa Americas Asia Europe Oceania</span></a></code></pre></div>
</div>
<div id="max_expand" class="section level2">
<h2><span class="header-section-number">6.7</span> <code>max_expand</code></h2>
<p>Suppose we want a model for each <em>country</em>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">gapminder_countries &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb92-2" data-line-number="2">  gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb92-3" data-line-number="3"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">gdpPercap =</span> <span class="kw">scale</span>(gdpPercap)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb92-4" data-line-number="4"><span class="st">    </span><span class="kw">split</span>(<span class="dt">f =</span> .<span class="op">$</span>country)</a>
<a class="sourceLine" id="cb92-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb92-6" data-line-number="6"></a>
<a class="sourceLine" id="cb92-7" data-line-number="7">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb92-8" data-line-number="8">  <span class="dt">countries =</span> <span class="kw">gapminder_countries</span>(),</a>
<a class="sourceLine" id="cb92-9" data-line-number="9">  <span class="dt">model =</span> <span class="kw">target</span>(<span class="kw">fit_model</span>(countries), <span class="dt">dynamic =</span> <span class="kw">map</span>(countries))</a>
<a class="sourceLine" id="cb92-10" data-line-number="10">)</a></code></pre></div>
<p>The Gapminder dataset has 142 countries, which can get overwhelming. In the early stages of the workflow when we are still debugging and testing, we can limit the number of sub-targets using the <code>max_expand</code> argument of <code>make()</code>.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw">make</span>(plan, <span class="dt">max_expand =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="co">#&gt; target countries</span></a>
<a class="sourceLine" id="cb93-3" data-line-number="3"><span class="co">#&gt; dynamic model</span></a>
<a class="sourceLine" id="cb93-4" data-line-number="4"><span class="co">#&gt; subtarget model_c5e7c7a2</span></a>
<a class="sourceLine" id="cb93-5" data-line-number="5"><span class="co">#&gt; subtarget model_656f8fe2</span></a>
<a class="sourceLine" id="cb93-6" data-line-number="6"><span class="co">#&gt; aggregate model</span></a></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw">readd</span>(model)</a>
<a class="sourceLine" id="cb94-2" data-line-number="2"><span class="co">#&gt; # A tibble: 4 x 4</span></a>
<a class="sourceLine" id="cb94-3" data-line-number="3"><span class="co">#&gt;   continent term        statistic  p.value</span></a>
<a class="sourceLine" id="cb94-4" data-line-number="4"><span class="co">#&gt; * &lt;fct&gt;     &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb94-5" data-line-number="5"><span class="co">#&gt; 1 Asia      (Intercept)    -1.48  0.170   </span></a>
<a class="sourceLine" id="cb94-6" data-line-number="6"><span class="co">#&gt; 2 Asia      year           -0.233 0.821   </span></a>
<a class="sourceLine" id="cb94-7" data-line-number="7"><span class="co">#&gt; 3 Europe    (Intercept)    -4.76  0.000773</span></a>
<a class="sourceLine" id="cb94-8" data-line-number="8"><span class="co">#&gt; 4 Europe    year            4.59  0.000998</span></a></code></pre></div>
<p>Then, when we are confident and ready, we can scale up to the full number of models.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">make</span>(plan)</a></code></pre></div>

</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="static.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="projects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropensci-books/drake/edit/master/dynamic.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropensci-books/drake/commits/master/dynamic.Rmd",
"text": "Chapter edit history"
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
