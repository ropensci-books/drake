<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Customer churn and deep learning | The drake R Package User Manual</title>
  <meta name="description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Customer churn and deep learning | The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://books.ropensci.org/drake/" />
  <meta property="og:image" content="https://books.ropensci.org/drake//images/logo.png" />
  <meta property="og:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="github-repo" content="ropensci-books/drake" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Customer churn and deep learning | The drake R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="twitter:image" content="https://books.ropensci.org/drake//images/logo.png" />

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert, Ellis Hughes, Matthew Mark Strasiotto" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="scripts.html"/>
<link rel="next" href="stan.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150843595-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150843595-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The drake R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#video"><i class="fa fa-check"></i><b>1.1</b> Video</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#that-feeling-of-workflowing-miles-mcbain"><i class="fa fa-check"></i><b>1.1.1</b> That Feeling of Workflowing (Miles McBain)</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#ropensci-community-call"><i class="fa fa-check"></i><b>1.1.2</b> rOpenSci Community Call</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.2</b> The drake R package</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.3</b> Installation</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.4</b> Why drake?</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.4.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.4.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#scale-up-and-out."><i class="fa fa-check"></i><b>1.4.3</b> Scale up and out.</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#with-docker"><i class="fa fa-check"></i><b>1.5</b> With Docker</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.6</b> Documentation</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#core-concepts"><i class="fa fa-check"></i><b>1.6.1</b> Core concepts</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="index.html#in-practice"><i class="fa fa-check"></i><b>1.6.2</b> In practice</a></li>
<li class="chapter" data-level="1.6.3" data-path="index.html"><a href="index.html#use-cases"><i class="fa fa-check"></i><b>1.6.3</b> Use cases</a></li>
<li class="chapter" data-level="1.6.4" data-path="index.html"><a href="index.html#drake-projects-as-r-packages"><i class="fa fa-check"></i><b>1.6.4</b> <code>drake</code> projects as R packages</a></li>
<li class="chapter" data-level="1.6.5" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.6.5</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.6.6" data-path="index.html"><a href="index.html#reference"><i class="fa fa-check"></i><b>1.6.6</b> Reference</a></li>
<li class="chapter" data-level="1.6.7" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.6.7</b> Function reference</a></li>
<li class="chapter" data-level="1.6.8" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.6.8</b> Tutorials</a></li>
<li class="chapter" data-level="1.6.9" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.6.9</b> Examples</a></li>
<li class="chapter" data-level="1.6.10" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.6.10</b> Presentations</a></li>
<li class="chapter" data-level="1.6.11" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.6.11</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.7</b> Help and troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="similar-work.html"><a href="similar-work.html"><i class="fa fa-check"></i><b>2</b> Similar work</a>
<ul>
<li class="chapter" data-level="2.1" data-path="similar-work.html"><a href="similar-work.html#pipeline-tools"><i class="fa fa-check"></i><b>2.1</b> Pipeline tools</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="similar-work.html"><a href="similar-work.html#gnu-make"><i class="fa fa-check"></i><b>2.1.1</b> GNU Make</a></li>
<li class="chapter" data-level="2.1.2" data-path="similar-work.html"><a href="similar-work.html#remake"><i class="fa fa-check"></i><b>2.1.2</b> Remake</a></li>
<li class="chapter" data-level="2.1.3" data-path="similar-work.html"><a href="similar-work.html#factuals-drake"><i class="fa fa-check"></i><b>2.1.3</b> Factual’s Drake</a></li>
<li class="chapter" data-level="2.1.4" data-path="similar-work.html"><a href="similar-work.html#other-pipeline-tools"><i class="fa fa-check"></i><b>2.1.4</b> Other pipeline tools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="similar-work.html"><a href="similar-work.html#memoization"><i class="fa fa-check"></i><b>2.2</b> Memoization</a></li>
<li class="chapter" data-level="2.3" data-path="similar-work.html"><a href="similar-work.html#literate-programming"><i class="fa fa-check"></i><b>2.3</b> Literate programming</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="similar-work.html"><a href="similar-work.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>2.3.1</b> knitr and R Markdown</a></li>
<li class="chapter" data-level="2.3.2" data-path="similar-work.html"><a href="similar-work.html#version-control"><i class="fa fa-check"></i><b>2.3.2</b> Version control</a></li>
<li class="chapter" data-level="2.3.3" data-path="similar-work.html"><a href="similar-work.html#containerization-and-r-package-environments"><i class="fa fa-check"></i><b>2.3.3</b> Containerization and R package environments</a></li>
<li class="chapter" data-level="2.3.4" data-path="similar-work.html"><a href="similar-work.html#workflowr"><i class="fa fa-check"></i><b>2.3.4</b> workflowr</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="similar-work.html"><a href="similar-work.html#acknowledgements"><i class="fa fa-check"></i><b>2.4</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="3" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>3</b> Walkthrough</a>
<ul>
<li class="chapter" data-level="3.1" data-path="walkthrough.html"><a href="walkthrough.html#set-the-stage."><i class="fa fa-check"></i><b>3.1</b> Set the stage.</a></li>
<li class="chapter" data-level="3.2" data-path="walkthrough.html"><a href="walkthrough.html#make-your-results."><i class="fa fa-check"></i><b>3.2</b> Make your results.</a></li>
<li class="chapter" data-level="3.3" data-path="walkthrough.html"><a href="walkthrough.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>3.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="3.4" data-path="walkthrough.html"><a href="walkthrough.html#history-and-provenance"><i class="fa fa-check"></i><b>3.4</b> History and provenance</a></li>
<li class="chapter" data-level="3.5" data-path="walkthrough.html"><a href="walkthrough.html#reproducible-data-recovery-and-renaming"><i class="fa fa-check"></i><b>3.5</b> Reproducible data recovery and renaming</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="walkthrough.html"><a href="walkthrough.html#undoing-clean"><i class="fa fa-check"></i><b>3.5.1</b> Undoing <code>clean()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="walkthrough.html"><a href="walkthrough.html#renaming"><i class="fa fa-check"></i><b>3.5.2</b> Renaming</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="walkthrough.html"><a href="walkthrough.html#try-the-code-yourself"><i class="fa fa-check"></i><b>3.6</b> Try the code yourself!</a></li>
<li class="chapter" data-level="3.7" data-path="walkthrough.html"><a href="walkthrough.html#thanks"><i class="fa fa-check"></i><b>3.7</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>4</b> <code>drake</code> plans</a>
<ul>
<li class="chapter" data-level="4.1" data-path="plans.html"><a href="plans.html#functions"><i class="fa fa-check"></i><b>4.1</b> Functions</a></li>
<li class="chapter" data-level="4.2" data-path="plans.html"><a href="plans.html#intro-to-plans"><i class="fa fa-check"></i><b>4.2</b> Intro to plans</a></li>
<li class="chapter" data-level="4.3" data-path="plans.html"><a href="plans.html#a-strategy-for-building-up-plans"><i class="fa fa-check"></i><b>4.3</b> A strategy for building up plans</a></li>
<li class="chapter" data-level="4.4" data-path="plans.html"><a href="plans.html#how-to-choose-good-targets"><i class="fa fa-check"></i><b>4.4</b> How to choose good targets</a></li>
<li class="chapter" data-level="4.5" data-path="plans.html"><a href="plans.html#special-data-formats-for-targets"><i class="fa fa-check"></i><b>4.5</b> Special data formats for targets</a></li>
<li class="chapter" data-level="4.6" data-path="plans.html"><a href="plans.html#special-columns"><i class="fa fa-check"></i><b>4.6</b> Special columns</a></li>
<li class="chapter" data-level="4.7" data-path="plans.html"><a href="plans.html#static-files"><i class="fa fa-check"></i><b>4.7</b> Static files</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="plans.html"><a href="plans.html#urls"><i class="fa fa-check"></i><b>4.7.1</b> URLs</a></li>
<li class="chapter" data-level="4.7.2" data-path="plans.html"><a href="plans.html#limitations-of-static-files"><i class="fa fa-check"></i><b>4.7.2</b> Limitations of static files</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="plans.html"><a href="plans.html#dynamic-files"><i class="fa fa-check"></i><b>4.8</b> Dynamic files</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="plans.html"><a href="plans.html#how-to-use-dynamic-files"><i class="fa fa-check"></i><b>4.8.1</b> How to use dynamic files</a></li>
<li class="chapter" data-level="4.8.2" data-path="plans.html"><a href="plans.html#example-of-dynamic-files"><i class="fa fa-check"></i><b>4.8.2</b> Example of dynamic files</a></li>
<li class="chapter" data-level="4.8.3" data-path="plans.html"><a href="plans.html#limitations-of-dynamic-files"><i class="fa fa-check"></i><b>4.8.3</b> Limitations of dynamic files</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="plans.html"><a href="plans.html#large-plans"><i class="fa fa-check"></i><b>4.9</b> Large plans</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="static.html"><a href="static.html"><i class="fa fa-check"></i><b>5</b> Static branching</a>
<ul>
<li class="chapter" data-level="5.1" data-path="static.html"><a href="static.html#why-static-branching"><i class="fa fa-check"></i><b>5.1</b> Why static branching?</a></li>
<li class="chapter" data-level="5.2" data-path="static.html"><a href="static.html#grouping-variables"><i class="fa fa-check"></i><b>5.2</b> Grouping variables</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="static.html"><a href="static.html#limitations-of-grouping-variables"><i class="fa fa-check"></i><b>5.2.1</b> Limitations of grouping variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="static.html"><a href="static.html#tidy-evaluation"><i class="fa fa-check"></i><b>5.3</b> Tidy evaluation</a></li>
<li class="chapter" data-level="5.4" data-path="static.html"><a href="static.html#static-transformations"><i class="fa fa-check"></i><b>5.4</b> Static transformations</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>5.4.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="5.4.2" data-path="static.html"><a href="static.html#cross"><i class="fa fa-check"></i><b>5.4.2</b> <code>cross()</code></a></li>
<li class="chapter" data-level="5.4.3" data-path="static.html"><a href="static.html#split"><i class="fa fa-check"></i><b>5.4.3</b> <code>split()</code></a></li>
<li class="chapter" data-level="5.4.4" data-path="static.html"><a href="static.html#combine"><i class="fa fa-check"></i><b>5.4.4</b> <code>combine()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="static.html"><a href="static.html#target-names"><i class="fa fa-check"></i><b>5.5</b> Target names</a></li>
<li class="chapter" data-level="5.6" data-path="static.html"><a href="static.html#tags"><i class="fa fa-check"></i><b>5.6</b> Tags</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>6</b> Dynamic branching</a>
<ul>
<li class="chapter" data-level="6.1" data-path="dynamic.html"><a href="dynamic.html#a-note-about-versions"><i class="fa fa-check"></i><b>6.1</b> A note about versions</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic.html"><a href="dynamic.html#motivation"><i class="fa fa-check"></i><b>6.2</b> Motivation</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic.html"><a href="dynamic.html#which-kind-of-branching-should-i-use"><i class="fa fa-check"></i><b>6.3</b> Which kind of branching should I use?</a></li>
<li class="chapter" data-level="6.4" data-path="dynamic.html"><a href="dynamic.html#dynamic-targets"><i class="fa fa-check"></i><b>6.4</b> Dynamic targets</a></li>
<li class="chapter" data-level="6.5" data-path="dynamic.html"><a href="dynamic.html#dynamic-transformations"><i class="fa fa-check"></i><b>6.5</b> Dynamic transformations</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>6.5.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="static.html"><a href="static.html#cross"><i class="fa fa-check"></i><b>6.5.2</b> <code>cross()</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="dynamic.html"><a href="dynamic.html#group"><i class="fa fa-check"></i><b>6.5.3</b> <code>group()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="dynamic.html"><a href="dynamic.html#trace"><i class="fa fa-check"></i><b>6.6</b> Trace</a></li>
<li class="chapter" data-level="6.7" data-path="dynamic.html"><a href="dynamic.html#max_expand"><i class="fa fa-check"></i><b>6.7</b> <code>max_expand</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>7</b> <code>drake</code> projects</a>
<ul>
<li class="chapter" data-level="7.1" data-path="projects.html"><a href="projects.html#external-resources"><i class="fa fa-check"></i><b>7.1</b> External resources</a></li>
<li class="chapter" data-level="7.2" data-path="projects.html"><a href="projects.html#code-files"><i class="fa fa-check"></i><b>7.2</b> Code files</a></li>
<li class="chapter" data-level="7.3" data-path="projects.html"><a href="projects.html#safer-interactivity"><i class="fa fa-check"></i><b>7.3</b> Safer interactivity</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="dynamic.html"><a href="dynamic.html#motivation"><i class="fa fa-check"></i><b>7.3.1</b> Motivation</a></li>
<li class="chapter" data-level="7.3.2" data-path="projects.html"><a href="projects.html#usage"><i class="fa fa-check"></i><b>7.3.2</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="projects.html"><a href="projects.html#script-file-pitfalls"><i class="fa fa-check"></i><b>7.4</b> Script file pitfalls</a></li>
<li class="chapter" data-level="7.5" data-path="projects.html"><a href="projects.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>7.5</b> Workflows as R packages</a></li>
<li class="chapter" data-level="7.6" data-path="projects.html"><a href="projects.html#other-tools"><i class="fa fa-check"></i><b>7.6</b> Other tools</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="scripts.html"><a href="scripts.html"><i class="fa fa-check"></i><b>8</b> Script-based workflows</a>
<ul>
<li class="chapter" data-level="8.1" data-path="scripts.html"><a href="scripts.html#function-oriented-workflows"><i class="fa fa-check"></i><b>8.1</b> Function-oriented workflows</a></li>
<li class="chapter" data-level="8.2" data-path="scripts.html"><a href="scripts.html#traditional-and-legacy-workflows"><i class="fa fa-check"></i><b>8.2</b> Traditional and legacy workflows</a></li>
<li class="chapter" data-level="8.3" data-path="scripts.html"><a href="scripts.html#overcoming-technical-debt"><i class="fa fa-check"></i><b>8.3</b> Overcoming Technical Debt</a></li>
<li class="chapter" data-level="8.4" data-path="scripts.html"><a href="scripts.html#dependencies"><i class="fa fa-check"></i><b>8.4</b> Dependencies</a></li>
<li class="chapter" data-level="8.5" data-path="scripts.html"><a href="scripts.html#building-the-connections"><i class="fa fa-check"></i><b>8.5</b> Building the connections</a></li>
<li class="chapter" data-level="8.6" data-path="scripts.html"><a href="scripts.html#run-the-workflow"><i class="fa fa-check"></i><b>8.6</b> Run the workflow</a></li>
<li class="chapter" data-level="8.7" data-path="scripts.html"><a href="scripts.html#keeping-the-results-up-to-date"><i class="fa fa-check"></i><b>8.7</b> Keeping the results up to date</a></li>
<li class="chapter" data-level="8.8" data-path="scripts.html"><a href="scripts.html#final-thoughts"><i class="fa fa-check"></i><b>8.8</b> Final thoughts</a></li>
</ul></li>
<li class="part"><span><b>II Examples</b></span></li>
<li class="chapter" data-level="9" data-path="churn.html"><a href="churn.html"><i class="fa fa-check"></i><b>9</b> Customer churn and deep learning</a>
<ul>
<li class="chapter" data-level="9.1" data-path="churn.html"><a href="churn.html#churn-packages"><i class="fa fa-check"></i><b>9.1</b> Churn packages</a></li>
<li class="chapter" data-level="9.2" data-path="churn.html"><a href="churn.html#churn-functions"><i class="fa fa-check"></i><b>9.2</b> Churn functions</a></li>
<li class="chapter" data-level="9.3" data-path="churn.html"><a href="churn.html#churn-plan"><i class="fa fa-check"></i><b>9.3</b> Churn plan</a></li>
<li class="chapter" data-level="9.4" data-path="churn.html"><a href="churn.html#churn-dependency-graph"><i class="fa fa-check"></i><b>9.4</b> Churn dependency graph</a></li>
<li class="chapter" data-level="9.5" data-path="churn.html"><a href="churn.html#run-the-keras-models"><i class="fa fa-check"></i><b>9.5</b> Run the Keras models</a></li>
<li class="chapter" data-level="9.6" data-path="churn.html"><a href="churn.html#inspect-the-keras-results"><i class="fa fa-check"></i><b>9.6</b> Inspect the Keras results</a></li>
<li class="chapter" data-level="9.7" data-path="churn.html"><a href="churn.html#add-keras-models"><i class="fa fa-check"></i><b>9.7</b> Add Keras models</a></li>
<li class="chapter" data-level="9.8" data-path="churn.html"><a href="churn.html#inspect-the-churn-results-again"><i class="fa fa-check"></i><b>9.8</b> Inspect the Churn results again</a></li>
<li class="chapter" data-level="9.9" data-path="churn.html"><a href="churn.html#update-the-churn-code"><i class="fa fa-check"></i><b>9.9</b> Update the Churn code</a></li>
<li class="chapter" data-level="9.10" data-path="churn.html"><a href="churn.html#churn-history-and-provenance"><i class="fa fa-check"></i><b>9.10</b> Churn history and provenance</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>10</b> Validating a small hierarchical model with Stan</a>
<ul>
<li class="chapter" data-level="10.1" data-path="stan.html"><a href="stan.html#the-drake-project"><i class="fa fa-check"></i><b>10.1</b> The <code>drake</code> project</a></li>
<li class="chapter" data-level="10.2" data-path="plans.html"><a href="plans.html#functions"><i class="fa fa-check"></i><b>10.2</b> Functions</a></li>
<li class="chapter" data-level="10.3" data-path="stan.html"><a href="stan.html#plan"><i class="fa fa-check"></i><b>10.3</b> Plan</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="stan.html"><a href="stan.html#model"><i class="fa fa-check"></i><b>10.3.1</b> Model</a></li>
<li class="chapter" data-level="10.3.2" data-path="stan.html"><a href="stan.html#index"><i class="fa fa-check"></i><b>10.3.2</b> Index</a></li>
<li class="chapter" data-level="10.3.3" data-path="stan.html"><a href="stan.html#data"><i class="fa fa-check"></i><b>10.3.3</b> Data</a></li>
<li class="chapter" data-level="10.3.4" data-path="stan.html"><a href="stan.html#fit"><i class="fa fa-check"></i><b>10.3.4</b> Fit</a></li>
<li class="chapter" data-level="10.3.5" data-path="stan.html"><a href="stan.html#report"><i class="fa fa-check"></i><b>10.3.5</b> Report</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="stan.html"><a href="stan.html#try-it-out"><i class="fa fa-check"></i><b>10.4</b> Try it out!</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>11</b> An analysis of R package download trends</a>
<ul>
<li class="chapter" data-level="11.1" data-path="packages.html"><a href="packages.html#get-the-code."><i class="fa fa-check"></i><b>11.1</b> Get the code.</a></li>
<li class="chapter" data-level="11.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>11.2</b> Overview</a></li>
<li class="chapter" data-level="11.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>11.3</b> Analysis</a></li>
<li class="chapter" data-level="11.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>11.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>12</b> Finding the best model of gross state product</a>
<ul>
<li class="chapter" data-level="12.1" data-path="packages.html"><a href="packages.html#get-the-code."><i class="fa fa-check"></i><b>12.1</b> Get the code.</a></li>
<li class="chapter" data-level="12.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>12.2</b> Objective and methods</a></li>
<li class="chapter" data-level="12.3" data-path="stan.html"><a href="stan.html#data"><i class="fa fa-check"></i><b>12.3</b> Data</a></li>
<li class="chapter" data-level="12.4" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>12.4</b> Analysis</a></li>
<li class="chapter" data-level="12.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>12.5</b> Results</a></li>
<li class="chapter" data-level="12.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>12.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="12.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>12.7</b> References</a></li>
</ul></li>
<li class="part"><span><b>III Resource management</b></span></li>
<li class="chapter" data-level="13" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>13</b> High-performance computing</a>
<ul>
<li class="chapter" data-level="13.1" data-path="hpc.html"><a href="hpc.html#start-small"><i class="fa fa-check"></i><b>13.1</b> Start small</a></li>
<li class="chapter" data-level="13.2" data-path="hpc.html"><a href="hpc.html#let-make-schedule-your-targets."><i class="fa fa-check"></i><b>13.2</b> Let <code>make()</code> schedule your targets.</a></li>
<li class="chapter" data-level="13.3" data-path="hpc.html"><a href="hpc.html#the-master-process"><i class="fa fa-check"></i><b>13.3</b> The master process</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="hpc.html"><a href="hpc.html#master-on-a-cluster"><i class="fa fa-check"></i><b>13.3.1</b> Master on a cluster</a></li>
<li class="chapter" data-level="13.3.2" data-path="hpc.html"><a href="hpc.html#local-master"><i class="fa fa-check"></i><b>13.3.2</b> Local master</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>13.4</b> Parallel backends</a></li>
<li class="chapter" data-level="13.5" data-path="hpc.html"><a href="hpc.html#the-clustermq-backend"><i class="fa fa-check"></i><b>13.5</b> The <code>clustermq</code> backend</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>13.5.1</b> Persistent workers</a></li>
<li class="chapter" data-level="13.5.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>13.5.2</b> Installation</a></li>
<li class="chapter" data-level="13.5.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine"><i class="fa fa-check"></i><b>13.5.3</b> On your local machine</a></li>
<li class="chapter" data-level="13.5.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster"><i class="fa fa-check"></i><b>13.5.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="hpc.html"><a href="hpc.html#the-future-backend"><i class="fa fa-check"></i><b>13.6</b> The <code>future</code> backend</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>13.6.1</b> Transient workers</a></li>
<li class="chapter" data-level="13.6.2" data-path="hpc.html"><a href="hpc.html#installation-1"><i class="fa fa-check"></i><b>13.6.2</b> Installation</a></li>
<li class="chapter" data-level="13.6.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine-1"><i class="fa fa-check"></i><b>13.6.3</b> On your local machine</a></li>
<li class="chapter" data-level="13.6.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster-1"><i class="fa fa-check"></i><b>13.6.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="hpc.html"><a href="hpc.html#advanced-options"><i class="fa fa-check"></i><b>13.7</b> Advanced options</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="hpc.html"><a href="hpc.html#selectivity"><i class="fa fa-check"></i><b>13.7.1</b> Selectivity</a></li>
<li class="chapter" data-level="13.7.2" data-path="hpc.html"><a href="hpc.html#memory-options"><i class="fa fa-check"></i><b>13.7.2</b> Memory options</a></li>
<li class="chapter" data-level="13.7.3" data-path="hpc.html"><a href="hpc.html#storage-options"><i class="fa fa-check"></i><b>13.7.3</b> Storage options</a></li>
<li class="chapter" data-level="13.7.4" data-path="hpc.html"><a href="hpc.html#the-template-argument-for-persistent-workers"><i class="fa fa-check"></i><b>13.7.4</b> The <code>template</code> argument for persistent workers</a></li>
<li class="chapter" data-level="13.7.5" data-path="hpc.html"><a href="hpc.html#the-resources-column-for-transient-workers"><i class="fa fa-check"></i><b>13.7.5</b> The <code>resources</code> column for transient workers</a></li>
<li class="chapter" data-level="13.7.6" data-path="hpc.html"><a href="hpc.html#parallel-computing-within-targets"><i class="fa fa-check"></i><b>13.7.6</b> Parallel computing <em>within</em> targets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>14</b> Time: speed, time logging, prediction, and strategy</a>
<ul>
<li class="chapter" data-level="14.1" data-path="time.html"><a href="time.html#why-is-drake-so-slow"><i class="fa fa-check"></i><b>14.1</b> Why is <code>drake</code> so slow?</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="time.html"><a href="time.html#help-us-find-out"><i class="fa fa-check"></i><b>14.1.1</b> Help us find out!</a></li>
<li class="chapter" data-level="14.1.2" data-path="time.html"><a href="time.html#too-many-targets"><i class="fa fa-check"></i><b>14.1.2</b> Too many targets?</a></li>
<li class="chapter" data-level="14.1.3" data-path="time.html"><a href="time.html#big-data"><i class="fa fa-check"></i><b>14.1.3</b> Big data?</a></li>
<li class="chapter" data-level="14.1.4" data-path="time.html"><a href="time.html#aggressive-shortcuts"><i class="fa fa-check"></i><b>14.1.4</b> Aggressive shortcuts</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="time.html"><a href="time.html#time-logging"><i class="fa fa-check"></i><b>14.2</b> Time logging</a></li>
<li class="chapter" data-level="14.3" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>14.3</b> Predict total runtime</a></li>
<li class="chapter" data-level="14.4" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>14.4</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>15</b> Memory management</a>
<ul>
<li class="chapter" data-level="15.1" data-path="memory.html"><a href="memory.html#garbage-collection-and-custom-files"><i class="fa fa-check"></i><b>15.1</b> Garbage collection and custom files</a></li>
<li class="chapter" data-level="15.2" data-path="memory.html"><a href="memory.html#memory-strategies"><i class="fa fa-check"></i><b>15.2</b> Memory strategies</a></li>
<li class="chapter" data-level="15.3" data-path="memory.html"><a href="memory.html#data-splitting"><i class="fa fa-check"></i><b>15.3</b> Data splitting</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="storage.html"><a href="storage.html"><i class="fa fa-check"></i><b>16</b> Storage</a>
<ul>
<li class="chapter" data-level="16.1" data-path="storage.html"><a href="storage.html#drakes-cache"><i class="fa fa-check"></i><b>16.1</b> <code>drake</code>’s cache</a></li>
<li class="chapter" data-level="16.2" data-path="storage.html"><a href="storage.html#efficient-target-storage"><i class="fa fa-check"></i><b>16.2</b> Efficient target storage</a></li>
<li class="chapter" data-level="16.3" data-path="storage.html"><a href="storage.html#why-is-my-cache-so-big"><i class="fa fa-check"></i><b>16.3</b> Why is my cache so big?</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="storage.html"><a href="storage.html#old-targets"><i class="fa fa-check"></i><b>16.3.1</b> Old targets</a></li>
<li class="chapter" data-level="16.3.2" data-path="storage.html"><a href="storage.html#garbage-from-interrupted-builds"><i class="fa fa-check"></i><b>16.3.2</b> Garbage from interrupted builds</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="storage.html"><a href="storage.html#interfaces-to-the-cache"><i class="fa fa-check"></i><b>16.4</b> Interfaces to the cache</a></li>
</ul></li>
<li class="part"><span><b>IV Extra features</b></span></li>
<li class="chapter" data-level="17" data-path="visuals.html"><a href="visuals.html"><i class="fa fa-check"></i><b>17</b> Visualization with drake</a>
<ul>
<li class="chapter" data-level="17.1" data-path="visuals.html"><a href="visuals.html#plotting-plans"><i class="fa fa-check"></i><b>17.1</b> Plotting plans</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="visuals.html"><a href="visuals.html#vis_drake_graph"><i class="fa fa-check"></i><b>17.1.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="17.1.2" data-path="visuals.html"><a href="visuals.html#sankey_drake_graph"><i class="fa fa-check"></i><b>17.1.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="17.1.3" data-path="visuals.html"><a href="visuals.html#drake_ggraph"><i class="fa fa-check"></i><b>17.1.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="17.1.4" data-path="visuals.html"><a href="visuals.html#text_drake_graph"><i class="fa fa-check"></i><b>17.1.4</b> <code>text_drake_graph()</code></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="visuals.html"><a href="visuals.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>17.2</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="17.3" data-path="visuals.html"><a href="visuals.html#visualizing-target-status"><i class="fa fa-check"></i><b>17.3</b> Visualizing target status</a></li>
<li class="chapter" data-level="17.4" data-path="visuals.html"><a href="visuals.html#subgraphs"><i class="fa fa-check"></i><b>17.4</b> Subgraphs</a></li>
<li class="chapter" data-level="17.5" data-path="visuals.html"><a href="visuals.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>17.5</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="17.6" data-path="visuals.html"><a href="visuals.html#clusters"><i class="fa fa-check"></i><b>17.6</b> Clusters</a></li>
<li class="chapter" data-level="17.7" data-path="visuals.html"><a href="visuals.html#output-files"><i class="fa fa-check"></i><b>17.7</b> Output files</a></li>
<li class="chapter" data-level="17.8" data-path="visuals.html"><a href="visuals.html#node-selection"><i class="fa fa-check"></i><b>17.8</b> Node Selection</a>
<ul>
<li class="chapter" data-level="17.8.1" data-path="visuals.html"><a href="visuals.html#perform-the-default-action-on-select"><i class="fa fa-check"></i><b>17.8.1</b> Perform the default action on select</a></li>
<li class="chapter" data-level="17.8.2" data-path="visuals.html"><a href="visuals.html#perform-no-action-on-select"><i class="fa fa-check"></i><b>17.8.2</b> Perform no action on select</a></li>
<li class="chapter" data-level="17.8.3" data-path="visuals.html"><a href="visuals.html#customize-the-onselect-event-behaviour"><i class="fa fa-check"></i><b>17.8.3</b> Customize the onSelect event behaviour</a></li>
</ul></li>
<li class="chapter" data-level="17.9" data-path="visuals.html"><a href="visuals.html#enhanced-interactivity"><i class="fa fa-check"></i><b>17.9</b> Enhanced interactivity</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>18</b> Debugging and testing drake projects</a>
<ul>
<li class="chapter" data-level="18.1" data-path="debugging.html"><a href="debugging.html#debugging-failed-targets"><i class="fa fa-check"></i><b>18.1</b> Debugging failed targets</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="debugging.html"><a href="debugging.html#diagnosing-errors"><i class="fa fa-check"></i><b>18.1.1</b> Diagnosing errors</a></li>
<li class="chapter" data-level="18.1.2" data-path="debugging.html"><a href="debugging.html#interactive-debugging"><i class="fa fa-check"></i><b>18.1.2</b> Interactive debugging</a></li>
<li class="chapter" data-level="18.1.3" data-path="debugging.html"><a href="debugging.html#efficient-trial-and-error"><i class="fa fa-check"></i><b>18.1.3</b> Efficient trial and error</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="debugging.html"><a href="debugging.html#why-do-my-targets-keep-rerunning"><i class="fa fa-check"></i><b>18.2</b> Why do my targets keep rerunning?</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="debugging.html"><a href="debugging.html#how-your-workflow-fits-together"><i class="fa fa-check"></i><b>18.2.1</b> How your workflow fits together</a></li>
<li class="chapter" data-level="18.2.2" data-path="debugging.html"><a href="debugging.html#which-targets-are-outdated"><i class="fa fa-check"></i><b>18.2.2</b> Which targets are outdated</a></li>
<li class="chapter" data-level="18.2.3" data-path="debugging.html"><a href="debugging.html#why-your-targets-are-outdated"><i class="fa fa-check"></i><b>18.2.3</b> Why your targets are outdated</a></li>
<li class="chapter" data-level="18.2.4" data-path="debugging.html"><a href="debugging.html#strategies-to-prevent-unexpected-changes-in-the-future"><i class="fa fa-check"></i><b>18.2.4</b> Strategies to prevent unexpected changes in the future</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="debugging.html"><a href="debugging.html#more-help"><i class="fa fa-check"></i><b>18.3</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>19</b> Triggers: decision rules for building targets</a>
<ul>
<li class="chapter" data-level="19.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>19.1</b> What are triggers?</a></li>
<li class="chapter" data-level="19.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>19.2</b> Customization</a></li>
<li class="chapter" data-level="19.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>19.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="19.4" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>19.4</b> A more practical example</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>B</b> Design</a>
<ul>
<li class="chapter" data-level="B.1" data-path="design.html"><a href="design.html#principles"><i class="fa fa-check"></i><b>B.1</b> Principles</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="design.html"><a href="design.html#functions-first"><i class="fa fa-check"></i><b>B.1.1</b> Functions first</a></li>
<li class="chapter" data-level="B.1.2" data-path="design.html"><a href="design.html#light-use-of-traditional-oop"><i class="fa fa-check"></i><b>B.1.2</b> Light use of traditional OOP</a></li>
<li class="chapter" data-level="B.1.3" data-path="design.html"><a href="design.html#high-performant-small-objects"><i class="fa fa-check"></i><b>B.1.3</b> High-performant small objects</a></li>
<li class="chapter" data-level="B.1.4" data-path="design.html"><a href="design.html#fast-iteration-along-aggregated-data"><i class="fa fa-check"></i><b>B.1.4</b> Fast iteration along aggregated data</a></li>
<li class="chapter" data-level="B.1.5" data-path="design.html"><a href="design.html#access-to-information-across-targets"><i class="fa fa-check"></i><b>B.1.5</b> Access to information across targets</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="design.html"><a href="design.html#specific-classes"><i class="fa fa-check"></i><b>B.2</b> Specific classes</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="design.html"><a href="design.html#config"><i class="fa fa-check"></i><b>B.2.1</b> Config</a></li>
<li class="chapter" data-level="B.2.2" data-path="design.html"><a href="design.html#settings"><i class="fa fa-check"></i><b>B.2.2</b> Settings</a></li>
<li class="chapter" data-level="B.2.3" data-path="stan.html"><a href="stan.html#plan"><i class="fa fa-check"></i><b>B.2.3</b> Plan</a></li>
<li class="chapter" data-level="B.2.4" data-path="design.html"><a href="design.html#specification"><i class="fa fa-check"></i><b>B.2.4</b> Specification</a></li>
<li class="chapter" data-level="B.2.5" data-path="design.html"><a href="design.html#graph"><i class="fa fa-check"></i><b>B.2.5</b> Graph</a></li>
<li class="chapter" data-level="B.2.6" data-path="design.html"><a href="design.html#priority-queue"><i class="fa fa-check"></i><b>B.2.6</b> Priority queue</a></li>
<li class="chapter" data-level="B.2.7" data-path="design.html"><a href="design.html#metadata"><i class="fa fa-check"></i><b>B.2.7</b> Metadata</a></li>
<li class="chapter" data-level="B.2.8" data-path="design.html"><a href="design.html#cache"><i class="fa fa-check"></i><b>B.2.8</b> Cache</a></li>
<li class="chapter" data-level="B.2.9" data-path="design.html"><a href="design.html#code-analysis-lists"><i class="fa fa-check"></i><b>B.2.9</b> Code analysis lists</a></li>
<li class="chapter" data-level="B.2.10" data-path="design.html"><a href="design.html#environments"><i class="fa fa-check"></i><b>B.2.10</b> Environments</a></li>
<li class="chapter" data-level="B.2.11" data-path="design.html"><a href="design.html#hash-tables"><i class="fa fa-check"></i><b>B.2.11</b> Hash tables</a></li>
<li class="chapter" data-level="B.2.12" data-path="design.html"><a href="design.html#logger"><i class="fa fa-check"></i><b>B.2.12</b> Logger</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="churn" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Customer churn and deep learning</h1>
<p><a href="https://github.com/ropensci/drake"><code>drake</code></a> is designed for workflows with long runtimes, and a major use case is deep learning. This chapter demonstrates how to leverage <a href="https://github.com/ropensci/drake"><code>drake</code></a> to manage a deep learning workflow. The original example comes from a <a href="https://blogs.rstudio.com/tensorflow/posts/2018-01-11-keras-customer-churn/">blog post by Matt Dancho</a>, and the chapter’s content itself comes directly from <a href="https://github.com/sol-eng/tensorflow-w-r/blob/master/workflow/tensorflow-drake.Rmd">this R notebook</a>, part of an <a href="https://github.com/sol-eng/tensorflow-w-r">RStudio Solutions Engineering example demonstrating TensorFlow in R</a>. The notebook is modified and redistributed under the terms of the <a href="https://github.com/sol-eng/tensorflow-w-r/blob/master/LICENSE">Apache 2.0 license</a>, copyright RStudio (<a href="https://github.com/ropensci-books/drake/blob/master/COPYRIGHT">details here</a>).</p>
<div id="churn-packages" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Churn packages</h2>
<p>First, we load our packages into a fresh R session.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="churn.html#cb136-1" aria-hidden="true"></a><span class="kw">library</span>(drake)</span>
<span id="cb136-2"><a href="churn.html#cb136-2" aria-hidden="true"></a><span class="kw">library</span>(keras)</span>
<span id="cb136-3"><a href="churn.html#cb136-3" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb136-4"><a href="churn.html#cb136-4" aria-hidden="true"></a><span class="kw">library</span>(rsample)</span>
<span id="cb136-5"><a href="churn.html#cb136-5" aria-hidden="true"></a><span class="kw">library</span>(recipes)</span>
<span id="cb136-6"><a href="churn.html#cb136-6" aria-hidden="true"></a><span class="kw">library</span>(yardstick)</span></code></pre></div>
</div>
<div id="churn-functions" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Churn functions</h2>
<p><a href="https://github.com/ropensci/drake"><code>drake</code></a> is R-focused and function-oriented. We create functions to <a href="https://github.com/tidymodels/recipes">preprocess the data</a>,</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="churn.html#cb137-1" aria-hidden="true"></a>prepare_recipe &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb137-2"><a href="churn.html#cb137-2" aria-hidden="true"></a>  data <span class="op">%&gt;%</span></span>
<span id="cb137-3"><a href="churn.html#cb137-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">training</span>() <span class="op">%&gt;%</span></span>
<span id="cb137-4"><a href="churn.html#cb137-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">recipe</span>(Churn <span class="op">~</span><span class="st"> </span>.) <span class="op">%&gt;%</span></span>
<span id="cb137-5"><a href="churn.html#cb137-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">step_rm</span>(customerID) <span class="op">%&gt;%</span></span>
<span id="cb137-6"><a href="churn.html#cb137-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">step_naomit</span>(<span class="kw">all_outcomes</span>(), <span class="kw">all_predictors</span>()) <span class="op">%&gt;%</span></span>
<span id="cb137-7"><a href="churn.html#cb137-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">step_discretize</span>(tenure, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">cuts =</span> <span class="dv">6</span>)) <span class="op">%&gt;%</span></span>
<span id="cb137-8"><a href="churn.html#cb137-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">step_log</span>(TotalCharges) <span class="op">%&gt;%</span></span>
<span id="cb137-9"><a href="churn.html#cb137-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">step_mutate</span>(<span class="dt">Churn =</span> <span class="kw">ifelse</span>(Churn <span class="op">==</span><span class="st"> &quot;Yes&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span></span>
<span id="cb137-10"><a href="churn.html#cb137-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal</span>(), <span class="op">-</span><span class="kw">all_outcomes</span>()) <span class="op">%&gt;%</span></span>
<span id="cb137-11"><a href="churn.html#cb137-11" aria-hidden="true"></a><span class="st">    </span><span class="kw">step_center</span>(<span class="kw">all_predictors</span>(), <span class="op">-</span><span class="kw">all_outcomes</span>()) <span class="op">%&gt;%</span></span>
<span id="cb137-12"><a href="churn.html#cb137-12" aria-hidden="true"></a><span class="st">    </span><span class="kw">step_scale</span>(<span class="kw">all_predictors</span>(), <span class="op">-</span><span class="kw">all_outcomes</span>()) <span class="op">%&gt;%</span></span>
<span id="cb137-13"><a href="churn.html#cb137-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">prep</span>()</span>
<span id="cb137-14"><a href="churn.html#cb137-14" aria-hidden="true"></a>}</span></code></pre></div>
<p>define a <a href="https://github.com/rstudio/keras"><code>keras</code></a> model, exposing arguments to set the dimensionality and activation functions of the layers,</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="churn.html#cb138-1" aria-hidden="true"></a>define_model &lt;-<span class="st"> </span><span class="cf">function</span>(rec, units1, units2, act1, act2, act3) {</span>
<span id="cb138-2"><a href="churn.html#cb138-2" aria-hidden="true"></a>  input_shape &lt;-<span class="st"> </span><span class="kw">ncol</span>(</span>
<span id="cb138-3"><a href="churn.html#cb138-3" aria-hidden="true"></a>    <span class="kw">juice</span>(rec, <span class="kw">all_predictors</span>(), <span class="dt">composition =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb138-4"><a href="churn.html#cb138-4" aria-hidden="true"></a>  )</span>
<span id="cb138-5"><a href="churn.html#cb138-5" aria-hidden="true"></a>  <span class="kw">keras_model_sequential</span>() <span class="op">%&gt;%</span></span>
<span id="cb138-6"><a href="churn.html#cb138-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dense</span>(</span>
<span id="cb138-7"><a href="churn.html#cb138-7" aria-hidden="true"></a>      <span class="dt">units =</span> units1,</span>
<span id="cb138-8"><a href="churn.html#cb138-8" aria-hidden="true"></a>      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</span>
<span id="cb138-9"><a href="churn.html#cb138-9" aria-hidden="true"></a>      <span class="dt">activation =</span> act1,</span>
<span id="cb138-10"><a href="churn.html#cb138-10" aria-hidden="true"></a>      <span class="dt">input_shape =</span> input_shape</span>
<span id="cb138-11"><a href="churn.html#cb138-11" aria-hidden="true"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb138-12"><a href="churn.html#cb138-12" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span> <span class="fl">0.1</span>) <span class="op">%&gt;%</span></span>
<span id="cb138-13"><a href="churn.html#cb138-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dense</span>(</span>
<span id="cb138-14"><a href="churn.html#cb138-14" aria-hidden="true"></a>      <span class="dt">units =</span> units2,</span>
<span id="cb138-15"><a href="churn.html#cb138-15" aria-hidden="true"></a>      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</span>
<span id="cb138-16"><a href="churn.html#cb138-16" aria-hidden="true"></a>      <span class="dt">activation =</span> act2</span>
<span id="cb138-17"><a href="churn.html#cb138-17" aria-hidden="true"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb138-18"><a href="churn.html#cb138-18" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span> <span class="fl">0.1</span>) <span class="op">%&gt;%</span></span>
<span id="cb138-19"><a href="churn.html#cb138-19" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dense</span>(</span>
<span id="cb138-20"><a href="churn.html#cb138-20" aria-hidden="true"></a>      <span class="dt">units =</span> <span class="dv">1</span>,</span>
<span id="cb138-21"><a href="churn.html#cb138-21" aria-hidden="true"></a>      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</span>
<span id="cb138-22"><a href="churn.html#cb138-22" aria-hidden="true"></a>      <span class="dt">activation =</span> act3</span>
<span id="cb138-23"><a href="churn.html#cb138-23" aria-hidden="true"></a>    )</span>
<span id="cb138-24"><a href="churn.html#cb138-24" aria-hidden="true"></a>}</span></code></pre></div>
<p>train a model,</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="churn.html#cb139-1" aria-hidden="true"></a>train_model &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb139-2"><a href="churn.html#cb139-2" aria-hidden="true"></a>  rec,</span>
<span id="cb139-3"><a href="churn.html#cb139-3" aria-hidden="true"></a>  <span class="dt">units1 =</span> <span class="dv">16</span>,</span>
<span id="cb139-4"><a href="churn.html#cb139-4" aria-hidden="true"></a>  <span class="dt">units2 =</span> <span class="dv">16</span>,</span>
<span id="cb139-5"><a href="churn.html#cb139-5" aria-hidden="true"></a>  <span class="dt">act1 =</span> <span class="st">&quot;relu&quot;</span>,</span>
<span id="cb139-6"><a href="churn.html#cb139-6" aria-hidden="true"></a>  <span class="dt">act2 =</span> <span class="st">&quot;relu&quot;</span>,</span>
<span id="cb139-7"><a href="churn.html#cb139-7" aria-hidden="true"></a>  <span class="dt">act3 =</span> <span class="st">&quot;sigmoid&quot;</span></span>
<span id="cb139-8"><a href="churn.html#cb139-8" aria-hidden="true"></a>) {</span>
<span id="cb139-9"><a href="churn.html#cb139-9" aria-hidden="true"></a>  model &lt;-<span class="st"> </span><span class="kw">define_model</span>(</span>
<span id="cb139-10"><a href="churn.html#cb139-10" aria-hidden="true"></a>    <span class="dt">rec =</span> rec,</span>
<span id="cb139-11"><a href="churn.html#cb139-11" aria-hidden="true"></a>    <span class="dt">units1 =</span> units1,</span>
<span id="cb139-12"><a href="churn.html#cb139-12" aria-hidden="true"></a>    <span class="dt">units2 =</span> units2,</span>
<span id="cb139-13"><a href="churn.html#cb139-13" aria-hidden="true"></a>    <span class="dt">act1 =</span> act1,</span>
<span id="cb139-14"><a href="churn.html#cb139-14" aria-hidden="true"></a>    <span class="dt">act2 =</span> act2,</span>
<span id="cb139-15"><a href="churn.html#cb139-15" aria-hidden="true"></a>    <span class="dt">act3 =</span> act3</span>
<span id="cb139-16"><a href="churn.html#cb139-16" aria-hidden="true"></a>  )</span>
<span id="cb139-17"><a href="churn.html#cb139-17" aria-hidden="true"></a>  <span class="kw">compile</span>(</span>
<span id="cb139-18"><a href="churn.html#cb139-18" aria-hidden="true"></a>    model,</span>
<span id="cb139-19"><a href="churn.html#cb139-19" aria-hidden="true"></a>    <span class="dt">optimizer =</span> <span class="st">&quot;adam&quot;</span>,</span>
<span id="cb139-20"><a href="churn.html#cb139-20" aria-hidden="true"></a>    <span class="dt">loss =</span> <span class="st">&quot;binary_crossentropy&quot;</span>,</span>
<span id="cb139-21"><a href="churn.html#cb139-21" aria-hidden="true"></a>    <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb139-22"><a href="churn.html#cb139-22" aria-hidden="true"></a>  )</span>
<span id="cb139-23"><a href="churn.html#cb139-23" aria-hidden="true"></a>  x_train_tbl &lt;-<span class="st"> </span><span class="kw">juice</span>(</span>
<span id="cb139-24"><a href="churn.html#cb139-24" aria-hidden="true"></a>    rec,</span>
<span id="cb139-25"><a href="churn.html#cb139-25" aria-hidden="true"></a>    <span class="kw">all_predictors</span>(),</span>
<span id="cb139-26"><a href="churn.html#cb139-26" aria-hidden="true"></a>    <span class="dt">composition =</span> <span class="st">&quot;matrix&quot;</span></span>
<span id="cb139-27"><a href="churn.html#cb139-27" aria-hidden="true"></a>  )</span>
<span id="cb139-28"><a href="churn.html#cb139-28" aria-hidden="true"></a>  y_train_vec &lt;-<span class="st"> </span><span class="kw">juice</span>(rec, <span class="kw">all_outcomes</span>()) <span class="op">%&gt;%</span></span>
<span id="cb139-29"><a href="churn.html#cb139-29" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>()</span>
<span id="cb139-30"><a href="churn.html#cb139-30" aria-hidden="true"></a>  <span class="kw">fit</span>(</span>
<span id="cb139-31"><a href="churn.html#cb139-31" aria-hidden="true"></a>    <span class="dt">object =</span> model,</span>
<span id="cb139-32"><a href="churn.html#cb139-32" aria-hidden="true"></a>    <span class="dt">x =</span> x_train_tbl,</span>
<span id="cb139-33"><a href="churn.html#cb139-33" aria-hidden="true"></a>    <span class="dt">y =</span> y_train_vec,</span>
<span id="cb139-34"><a href="churn.html#cb139-34" aria-hidden="true"></a>    <span class="dt">batch_size =</span> <span class="dv">32</span>,</span>
<span id="cb139-35"><a href="churn.html#cb139-35" aria-hidden="true"></a>    <span class="dt">epochs =</span> <span class="dv">32</span>,</span>
<span id="cb139-36"><a href="churn.html#cb139-36" aria-hidden="true"></a>    <span class="dt">validation_split =</span> <span class="fl">0.3</span>,</span>
<span id="cb139-37"><a href="churn.html#cb139-37" aria-hidden="true"></a>    <span class="dt">verbose =</span> <span class="dv">0</span></span>
<span id="cb139-38"><a href="churn.html#cb139-38" aria-hidden="true"></a>  )</span>
<span id="cb139-39"><a href="churn.html#cb139-39" aria-hidden="true"></a>  model</span>
<span id="cb139-40"><a href="churn.html#cb139-40" aria-hidden="true"></a>}</span></code></pre></div>
<p>compare predictions against reality,</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="churn.html#cb140-1" aria-hidden="true"></a>confusion_matrix &lt;-<span class="st"> </span><span class="cf">function</span>(data, rec, model) {</span>
<span id="cb140-2"><a href="churn.html#cb140-2" aria-hidden="true"></a>  testing_data &lt;-<span class="st"> </span><span class="kw">bake</span>(rec, <span class="kw">testing</span>(data))</span>
<span id="cb140-3"><a href="churn.html#cb140-3" aria-hidden="true"></a>  x_test_tbl &lt;-<span class="st"> </span>testing_data <span class="op">%&gt;%</span></span>
<span id="cb140-4"><a href="churn.html#cb140-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>Churn) <span class="op">%&gt;%</span></span>
<span id="cb140-5"><a href="churn.html#cb140-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">as.matrix</span>()</span>
<span id="cb140-6"><a href="churn.html#cb140-6" aria-hidden="true"></a>  y_test_vec &lt;-<span class="st"> </span>testing_data <span class="op">%&gt;%</span></span>
<span id="cb140-7"><a href="churn.html#cb140-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">select</span>(Churn) <span class="op">%&gt;%</span></span>
<span id="cb140-8"><a href="churn.html#cb140-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">pull</span>()</span>
<span id="cb140-9"><a href="churn.html#cb140-9" aria-hidden="true"></a>  yhat_keras_class_vec &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span></span>
<span id="cb140-10"><a href="churn.html#cb140-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">predict_classes</span>(x_test_tbl) <span class="op">%&gt;%</span></span>
<span id="cb140-11"><a href="churn.html#cb140-11" aria-hidden="true"></a><span class="st">    </span><span class="kw">as.factor</span>() <span class="op">%&gt;%</span></span>
<span id="cb140-12"><a href="churn.html#cb140-12" aria-hidden="true"></a><span class="st">    </span><span class="kw">fct_recode</span>(<span class="dt">yes =</span> <span class="st">&quot;1&quot;</span>, <span class="dt">no =</span> <span class="st">&quot;0&quot;</span>)</span>
<span id="cb140-13"><a href="churn.html#cb140-13" aria-hidden="true"></a>  yhat_keras_prob_vec &lt;-</span>
<span id="cb140-14"><a href="churn.html#cb140-14" aria-hidden="true"></a><span class="st">    </span>model <span class="op">%&gt;%</span></span>
<span id="cb140-15"><a href="churn.html#cb140-15" aria-hidden="true"></a><span class="st">    </span><span class="kw">predict_proba</span>(x_test_tbl) <span class="op">%&gt;%</span></span>
<span id="cb140-16"><a href="churn.html#cb140-16" aria-hidden="true"></a><span class="st">    </span><span class="kw">as.vector</span>()</span>
<span id="cb140-17"><a href="churn.html#cb140-17" aria-hidden="true"></a>  test_truth &lt;-<span class="st"> </span>y_test_vec <span class="op">%&gt;%</span></span>
<span id="cb140-18"><a href="churn.html#cb140-18" aria-hidden="true"></a><span class="st">    </span><span class="kw">as.factor</span>() <span class="op">%&gt;%</span></span>
<span id="cb140-19"><a href="churn.html#cb140-19" aria-hidden="true"></a><span class="st">    </span><span class="kw">fct_recode</span>(<span class="dt">yes =</span> <span class="st">&quot;1&quot;</span>, <span class="dt">no =</span> <span class="st">&quot;0&quot;</span>)</span>
<span id="cb140-20"><a href="churn.html#cb140-20" aria-hidden="true"></a>  estimates_keras_tbl &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb140-21"><a href="churn.html#cb140-21" aria-hidden="true"></a>    <span class="dt">truth =</span> test_truth,</span>
<span id="cb140-22"><a href="churn.html#cb140-22" aria-hidden="true"></a>    <span class="dt">estimate =</span> yhat_keras_class_vec,</span>
<span id="cb140-23"><a href="churn.html#cb140-23" aria-hidden="true"></a>    <span class="dt">class_prob =</span> yhat_keras_prob_vec</span>
<span id="cb140-24"><a href="churn.html#cb140-24" aria-hidden="true"></a>  )</span>
<span id="cb140-25"><a href="churn.html#cb140-25" aria-hidden="true"></a>  estimates_keras_tbl <span class="op">%&gt;%</span></span>
<span id="cb140-26"><a href="churn.html#cb140-26" aria-hidden="true"></a><span class="st">    </span><span class="kw">conf_mat</span>(truth, estimate)</span>
<span id="cb140-27"><a href="churn.html#cb140-27" aria-hidden="true"></a>}</span></code></pre></div>
<p>and compare the performance of multiple models.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="churn.html#cb141-1" aria-hidden="true"></a>compare_models &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</span>
<span id="cb141-2"><a href="churn.html#cb141-2" aria-hidden="true"></a>  name &lt;-<span class="st"> </span><span class="kw">match.call</span>()[<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb141-3"><a href="churn.html#cb141-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">as.character</span>()</span>
<span id="cb141-4"><a href="churn.html#cb141-4" aria-hidden="true"></a>  df &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="kw">list</span>(...), summary) <span class="op">%&gt;%</span></span>
<span id="cb141-5"><a href="churn.html#cb141-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(.metric <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;sens&quot;</span>, <span class="st">&quot;spec&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb141-6"><a href="churn.html#cb141-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">rep</span>(name, <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(name))) <span class="op">%&gt;%</span></span>
<span id="cb141-7"><a href="churn.html#cb141-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">metric =</span> .metric, <span class="dt">estimate =</span> .estimate)</span>
<span id="cb141-8"><a href="churn.html#cb141-8" aria-hidden="true"></a>  <span class="kw">ggplot</span>(df) <span class="op">+</span></span>
<span id="cb141-9"><a href="churn.html#cb141-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> metric, <span class="dt">y =</span> estimate, <span class="dt">color =</span> name, <span class="dt">group =</span> name)) <span class="op">+</span></span>
<span id="cb141-10"><a href="churn.html#cb141-10" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme_gray</span>(<span class="dv">24</span>)</span>
<span id="cb141-11"><a href="churn.html#cb141-11" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div id="churn-plan" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Churn plan</h2>
<p>Next, we define our workflow in a <a href="https://books.ropensci.org/drake/plans.html"><code>drake</code> plan</a>. We will prepare the data, train different models with different activation functions, and compare the models in terms of performance.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="churn.html#cb142-1" aria-hidden="true"></a>activations &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;relu&quot;</span>, <span class="st">&quot;sigmoid&quot;</span>)</span>
<span id="cb142-2"><a href="churn.html#cb142-2" aria-hidden="true"></a></span>
<span id="cb142-3"><a href="churn.html#cb142-3" aria-hidden="true"></a>plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</span>
<span id="cb142-4"><a href="churn.html#cb142-4" aria-hidden="true"></a>  <span class="dt">data =</span> <span class="kw">read_csv</span>(<span class="kw">file_in</span>(<span class="st">&quot;customer_churn.csv&quot;</span>), <span class="dt">col_types =</span> <span class="kw">cols</span>()) <span class="op">%&gt;%</span></span>
<span id="cb142-5"><a href="churn.html#cb142-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">initial_split</span>(<span class="dt">prop =</span> <span class="fl">0.3</span>),</span>
<span id="cb142-6"><a href="churn.html#cb142-6" aria-hidden="true"></a>  <span class="dt">rec =</span> <span class="kw">prepare_recipe</span>(data),</span>
<span id="cb142-7"><a href="churn.html#cb142-7" aria-hidden="true"></a>  <span class="dt">model =</span> <span class="kw">target</span>(</span>
<span id="cb142-8"><a href="churn.html#cb142-8" aria-hidden="true"></a>    <span class="kw">train_model</span>(rec, <span class="dt">act1 =</span> act),</span>
<span id="cb142-9"><a href="churn.html#cb142-9" aria-hidden="true"></a>    <span class="dt">format =</span> <span class="st">&quot;keras&quot;</span>, <span class="co"># Supported in drake &gt; 7.5.2 to store models properly.</span></span>
<span id="cb142-10"><a href="churn.html#cb142-10" aria-hidden="true"></a>    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">act =</span> <span class="op">!!</span>activations)</span>
<span id="cb142-11"><a href="churn.html#cb142-11" aria-hidden="true"></a>  ),</span>
<span id="cb142-12"><a href="churn.html#cb142-12" aria-hidden="true"></a>  <span class="dt">conf =</span> <span class="kw">target</span>(</span>
<span id="cb142-13"><a href="churn.html#cb142-13" aria-hidden="true"></a>    <span class="kw">confusion_matrix</span>(data, rec, model),</span>
<span id="cb142-14"><a href="churn.html#cb142-14" aria-hidden="true"></a>    <span class="dt">transform =</span> <span class="kw">map</span>(model, <span class="dt">.id =</span> act)</span>
<span id="cb142-15"><a href="churn.html#cb142-15" aria-hidden="true"></a>  ),</span>
<span id="cb142-16"><a href="churn.html#cb142-16" aria-hidden="true"></a>  <span class="dt">metrics =</span> <span class="kw">target</span>(</span>
<span id="cb142-17"><a href="churn.html#cb142-17" aria-hidden="true"></a>    <span class="kw">compare_models</span>(conf),</span>
<span id="cb142-18"><a href="churn.html#cb142-18" aria-hidden="true"></a>    <span class="dt">transform =</span> <span class="kw">combine</span>(conf)</span>
<span id="cb142-19"><a href="churn.html#cb142-19" aria-hidden="true"></a>  )</span>
<span id="cb142-20"><a href="churn.html#cb142-20" aria-hidden="true"></a>)</span></code></pre></div>
<p>The plan is a data frame with the steps we are going to do.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="churn.html#cb143-1" aria-hidden="true"></a>plan</span>
<span id="cb143-2"><a href="churn.html#cb143-2" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 7 x 3</span></span>
<span id="cb143-3"><a href="churn.html#cb143-3" aria-hidden="true"></a><span class="co">#&gt;   target       command                                                    format</span></span>
<span id="cb143-4"><a href="churn.html#cb143-4" aria-hidden="true"></a><span class="co">#&gt;   &lt;chr&gt;        &lt;expr_lst&gt;                                                 &lt;chr&gt; </span></span>
<span id="cb143-5"><a href="churn.html#cb143-5" aria-hidden="true"></a><span class="co">#&gt; 1 conf_relu    confusion_matrix(data, rec, model_relu)                  … &lt;NA&gt;  </span></span>
<span id="cb143-6"><a href="churn.html#cb143-6" aria-hidden="true"></a><span class="co">#&gt; 2 conf_sigmoid confusion_matrix(data, rec, model_sigmoid)               … &lt;NA&gt;  </span></span>
<span id="cb143-7"><a href="churn.html#cb143-7" aria-hidden="true"></a><span class="co">#&gt; 3 data         read_csv(file_in(&quot;customer_churn.csv&quot;), col_types = cols(… &lt;NA&gt;  </span></span>
<span id="cb143-8"><a href="churn.html#cb143-8" aria-hidden="true"></a><span class="co">#&gt; 4 metrics      compare_models(conf_relu, conf_sigmoid)                  … &lt;NA&gt;  </span></span>
<span id="cb143-9"><a href="churn.html#cb143-9" aria-hidden="true"></a><span class="co">#&gt; 5 model_relu   train_model(rec, act1 = &quot;relu&quot;)                          … keras </span></span>
<span id="cb143-10"><a href="churn.html#cb143-10" aria-hidden="true"></a><span class="co">#&gt; 6 model_sigmo… train_model(rec, act1 = &quot;sigmoid&quot;)                       … keras </span></span>
<span id="cb143-11"><a href="churn.html#cb143-11" aria-hidden="true"></a><span class="co">#&gt; 7 rec          prepare_recipe(data)                                     … &lt;NA&gt;</span></span></code></pre></div>
</div>
<div id="churn-dependency-graph" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Churn dependency graph</h2>
<p>The graph visualizes the dependency relationships among the steps of the workflow.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="churn.html#cb144-1" aria-hidden="true"></a><span class="kw">vis_drake_graph</span>(plan)</span></code></pre></div>
<div id="htmlwidget-0477355e43dbf4db128d" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-0477355e43dbf4db128d">{"x":{"nodes":{"id":["confusion_matrix","p-MN2XG5DPNVSXEX3DNB2XE3ROMNZXM","prepare_recipe","compare_models","define_model","data","train_model","rec","model_relu","model_sigmoid","conf_relu","conf_sigmoid","metrics"],"imported":[true,true,true,true,true,false,true,false,false,false,false,false,false],"label":["confusion_matrix","file customer_churn.csv","prepare_recipe","compare_models","define_model","data","train_model","rec","model_relu","model_sigmoid","conf_relu","conf_sigmoid","metrics"],"status":["imported","imported","imported","imported","imported","outdated","imported","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["function","file","function","function","function","object","function","object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#000000","#1874CD","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["triangle","square","triangle","triangle","triangle","dot","triangle","dot","dot","dot","dot","dot","dot"],"level":[1,1,1,1,1,2,2,3,4,4,5,5,6],"x":[-1,-1,-1,-1,-1,-0.6,-0.6,-0.2,0.2,0.2,0.6,0.6,1],"y":[-1,-0.5,2.22044604925031e-16,0.5,1,-0.5,0.5,2.22044604925031e-16,-0.5,0.5,-0.5,0.5,2.22044604925031e-16]},"edges":{"from":["model_relu","rec","rec","rec","rec","confusion_matrix","confusion_matrix","data","data","data","p-MN2XG5DPNVSXEX3DNB2XE3ROMNZXM","train_model","train_model","prepare_recipe","compare_models","define_model","model_sigmoid","conf_sigmoid","conf_relu"],"to":["conf_relu","model_relu","model_sigmoid","conf_sigmoid","conf_relu","conf_sigmoid","conf_relu","rec","conf_sigmoid","conf_relu","data","model_relu","model_sigmoid","rec","metrics","train_model","conf_sigmoid","metrics","metrics"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","File"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,6,8,10,11]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="run-the-keras-models" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Run the Keras models</h2>
<p>Call <a href="https://docs.ropensci.org/drake/reference/make.html"><code>make()</code></a> to actually run the workflow.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="churn.html#cb145-1" aria-hidden="true"></a><span class="kw">make</span>(plan)</span>
<span id="cb145-2"><a href="churn.html#cb145-2" aria-hidden="true"></a><span class="co">#&gt; ▶ target data</span></span>
<span id="cb145-3"><a href="churn.html#cb145-3" aria-hidden="true"></a><span class="co">#&gt; ▶ target rec</span></span>
<span id="cb145-4"><a href="churn.html#cb145-4" aria-hidden="true"></a><span class="co">#&gt; ▶ target model_relu</span></span>
<span id="cb145-5"><a href="churn.html#cb145-5" aria-hidden="true"></a><span class="co">#&gt; ▶ target model_sigmoid</span></span>
<span id="cb145-6"><a href="churn.html#cb145-6" aria-hidden="true"></a><span class="co">#&gt; ▶ target conf_relu</span></span>
<span id="cb145-7"><a href="churn.html#cb145-7" aria-hidden="true"></a><span class="co">#&gt; ▶ target conf_sigmoid</span></span>
<span id="cb145-8"><a href="churn.html#cb145-8" aria-hidden="true"></a><span class="co">#&gt; ▶ target metrics</span></span></code></pre></div>
</div>
<div id="inspect-the-keras-results" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Inspect the Keras results</h2>
<p>The two models performed about the same.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="churn.html#cb146-1" aria-hidden="true"></a><span class="kw">readd</span>(metrics) <span class="co"># see also loadd()</span></span></code></pre></div>
<p><img src="drake-manual_files/figure-html/unnamed-chunk-153-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="add-keras-models" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Add Keras models</h2>
<p>Let’s try the softmax activation function.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="churn.html#cb147-1" aria-hidden="true"></a>activations &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;relu&quot;</span>, <span class="st">&quot;sigmoid&quot;</span>, <span class="st">&quot;softmax&quot;</span>)</span>
<span id="cb147-2"><a href="churn.html#cb147-2" aria-hidden="true"></a></span>
<span id="cb147-3"><a href="churn.html#cb147-3" aria-hidden="true"></a>plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</span>
<span id="cb147-4"><a href="churn.html#cb147-4" aria-hidden="true"></a>  <span class="dt">data =</span> <span class="kw">read_csv</span>(<span class="kw">file_in</span>(<span class="st">&quot;customer_churn.csv&quot;</span>), <span class="dt">col_types =</span> <span class="kw">cols</span>()) <span class="op">%&gt;%</span></span>
<span id="cb147-5"><a href="churn.html#cb147-5" aria-hidden="true"></a><span class="st">    </span><span class="kw">initial_split</span>(<span class="dt">prop =</span> <span class="fl">0.3</span>),</span>
<span id="cb147-6"><a href="churn.html#cb147-6" aria-hidden="true"></a>  <span class="dt">rec =</span> <span class="kw">prepare_recipe</span>(data),</span>
<span id="cb147-7"><a href="churn.html#cb147-7" aria-hidden="true"></a>  <span class="dt">model =</span> <span class="kw">target</span>(</span>
<span id="cb147-8"><a href="churn.html#cb147-8" aria-hidden="true"></a>    <span class="kw">train_model</span>(rec, <span class="dt">act1 =</span> act),</span>
<span id="cb147-9"><a href="churn.html#cb147-9" aria-hidden="true"></a>    <span class="dt">format =</span> <span class="st">&quot;keras&quot;</span>, <span class="co"># Supported in drake &gt; 7.5.2 to store models properly.</span></span>
<span id="cb147-10"><a href="churn.html#cb147-10" aria-hidden="true"></a>    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">act =</span> <span class="op">!!</span>activations)</span>
<span id="cb147-11"><a href="churn.html#cb147-11" aria-hidden="true"></a>  ),</span>
<span id="cb147-12"><a href="churn.html#cb147-12" aria-hidden="true"></a>  <span class="dt">conf =</span> <span class="kw">target</span>(</span>
<span id="cb147-13"><a href="churn.html#cb147-13" aria-hidden="true"></a>    <span class="kw">confusion_matrix</span>(data, rec, model),</span>
<span id="cb147-14"><a href="churn.html#cb147-14" aria-hidden="true"></a>    <span class="dt">transform =</span> <span class="kw">map</span>(model, <span class="dt">.id =</span> act)</span>
<span id="cb147-15"><a href="churn.html#cb147-15" aria-hidden="true"></a>  ),</span>
<span id="cb147-16"><a href="churn.html#cb147-16" aria-hidden="true"></a>  <span class="dt">metrics =</span> <span class="kw">target</span>(</span>
<span id="cb147-17"><a href="churn.html#cb147-17" aria-hidden="true"></a>    <span class="kw">compare_models</span>(conf),</span>
<span id="cb147-18"><a href="churn.html#cb147-18" aria-hidden="true"></a>    <span class="dt">transform =</span> <span class="kw">combine</span>(conf)</span>
<span id="cb147-19"><a href="churn.html#cb147-19" aria-hidden="true"></a>  )</span>
<span id="cb147-20"><a href="churn.html#cb147-20" aria-hidden="true"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="churn.html#cb148-1" aria-hidden="true"></a><span class="kw">vis_drake_graph</span>(plan) <span class="co"># see also outdated() and predict_runtime()</span></span></code></pre></div>
<div id="htmlwidget-f322ade04c57ca073a05" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-f322ade04c57ca073a05">{"x":{"nodes":{"id":["prepare_recipe","confusion_matrix","define_model","p-MN2XG5DPNVSXEX3DNB2XE3ROMNZXM","compare_models","train_model","data","rec","model_relu","model_softmax","model_sigmoid","conf_relu","conf_softmax","conf_sigmoid","metrics"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false,false,false,false],"label":["prepare_recipe","confusion_matrix","define_model","file customer_churn.csv","compare_models","train_model","data\n0.162s","rec\n0.502s","model_relu\n17.747s","model_softmax","model_sigmoid\n4.452s","conf_relu\n0.481s","conf_softmax","conf_sigmoid\n0.513s","metrics\n0.074s"],"status":["imported","imported","imported","imported","imported","imported","up to date","up to date","up to date","outdated","up to date","up to date","outdated","up to date","outdated"],"type":["function","function","function","file","function","function","object","object","object","object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#228B22","#228B22","#228B22","#000000","#228B22","#228B22","#000000","#228B22","#000000"],"shape":["triangle","triangle","triangle","square","triangle","triangle","dot","dot","dot","dot","dot","dot","dot","dot","dot"],"level":[1,1,1,1,1,2,2,3,4,4,4,5,5,5,6],"x":[-1,-1,-1,-1,-1,-0.6,-0.6,-0.2,0.2,0.2,0.2,0.6,0.6,0.6,1],"y":[-1,-0.5,2.22044604925031e-16,0.5,1,-0.5,0.5,2.22044604925031e-16,-0.75,2.22044604925031e-16,0.75,-0.75,2.22044604925031e-16,0.75,2.22044604925031e-16]},"edges":{"from":["prepare_recipe","data","data","data","data","train_model","train_model","train_model","rec","rec","rec","rec","rec","rec","model_relu","confusion_matrix","confusion_matrix","confusion_matrix","define_model","model_softmax","p-MN2XG5DPNVSXEX3DNB2XE3ROMNZXM","model_sigmoid","conf_sigmoid","compare_models","conf_relu","conf_softmax"],"to":["rec","rec","conf_sigmoid","conf_relu","conf_softmax","model_relu","model_softmax","model_sigmoid","model_relu","model_softmax","model_sigmoid","conf_sigmoid","conf_relu","conf_softmax","conf_relu","conf_sigmoid","conf_relu","conf_softmax","train_model","conf_softmax","data","conf_sigmoid","metrics","metrics","metrics","metrics"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","Imported","Object","Function","File"],"color":["#228B22","#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black","black"],"font.size":[20,20,20,20,20,20],"id":[1,2,6,8,10,11]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p><a href="https://docs.ropensci.org/drake/reference/make.html"><code>make()</code></a> skips the relu and sigmoid models because they are already up to date. (Their dependencies did not change.) Only the softmax model needs to run.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="churn.html#cb149-1" aria-hidden="true"></a><span class="kw">make</span>(plan)</span>
<span id="cb149-2"><a href="churn.html#cb149-2" aria-hidden="true"></a><span class="co">#&gt; ▶ target model_softmax</span></span>
<span id="cb149-3"><a href="churn.html#cb149-3" aria-hidden="true"></a><span class="co">#&gt; ▶ target conf_softmax</span></span>
<span id="cb149-4"><a href="churn.html#cb149-4" aria-hidden="true"></a><span class="co">#&gt; ▶ target metrics</span></span></code></pre></div>
</div>
<div id="inspect-the-churn-results-again" class="section level2" number="9.8">
<h2><span class="header-section-number">9.8</span> Inspect the Churn results again</h2>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="churn.html#cb150-1" aria-hidden="true"></a><span class="kw">readd</span>(metrics) <span class="co"># see also loadd()</span></span></code></pre></div>
<p><img src="drake-manual_files/figure-html/unnamed-chunk-157-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="update-the-churn-code" class="section level2" number="9.9">
<h2><span class="header-section-number">9.9</span> Update the Churn code</h2>
<p>If you change upstream functions, even nested ones, <code>drake</code> automatically refits the affected models. Let’s increase dropout in both layers.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="churn.html#cb151-1" aria-hidden="true"></a>define_model &lt;-<span class="st"> </span><span class="cf">function</span>(rec, units1, units2, act1, act2, act3) {</span>
<span id="cb151-2"><a href="churn.html#cb151-2" aria-hidden="true"></a>  input_shape &lt;-<span class="st"> </span><span class="kw">ncol</span>(</span>
<span id="cb151-3"><a href="churn.html#cb151-3" aria-hidden="true"></a>    <span class="kw">juice</span>(rec, <span class="kw">all_predictors</span>(), <span class="dt">composition =</span> <span class="st">&quot;matrix&quot;</span>)</span>
<span id="cb151-4"><a href="churn.html#cb151-4" aria-hidden="true"></a>  )</span>
<span id="cb151-5"><a href="churn.html#cb151-5" aria-hidden="true"></a>  <span class="kw">keras_model_sequential</span>() <span class="op">%&gt;%</span></span>
<span id="cb151-6"><a href="churn.html#cb151-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dense</span>(</span>
<span id="cb151-7"><a href="churn.html#cb151-7" aria-hidden="true"></a>      <span class="dt">units =</span> units1,</span>
<span id="cb151-8"><a href="churn.html#cb151-8" aria-hidden="true"></a>      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</span>
<span id="cb151-9"><a href="churn.html#cb151-9" aria-hidden="true"></a>      <span class="dt">activation =</span> act1,</span>
<span id="cb151-10"><a href="churn.html#cb151-10" aria-hidden="true"></a>      <span class="dt">input_shape =</span> input_shape</span>
<span id="cb151-11"><a href="churn.html#cb151-11" aria-hidden="true"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb151-12"><a href="churn.html#cb151-12" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span> <span class="fl">0.15</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Changed from 0.1 to 0.15.</span></span>
<span id="cb151-13"><a href="churn.html#cb151-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dense</span>(</span>
<span id="cb151-14"><a href="churn.html#cb151-14" aria-hidden="true"></a>      <span class="dt">units =</span> units2,</span>
<span id="cb151-15"><a href="churn.html#cb151-15" aria-hidden="true"></a>      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</span>
<span id="cb151-16"><a href="churn.html#cb151-16" aria-hidden="true"></a>      <span class="dt">activation =</span> act2</span>
<span id="cb151-17"><a href="churn.html#cb151-17" aria-hidden="true"></a>    ) <span class="op">%&gt;%</span></span>
<span id="cb151-18"><a href="churn.html#cb151-18" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span> <span class="fl">0.15</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Changed from 0.1 to 0.15.</span></span>
<span id="cb151-19"><a href="churn.html#cb151-19" aria-hidden="true"></a><span class="st">    </span><span class="kw">layer_dense</span>(</span>
<span id="cb151-20"><a href="churn.html#cb151-20" aria-hidden="true"></a>      <span class="dt">units =</span> <span class="dv">1</span>,</span>
<span id="cb151-21"><a href="churn.html#cb151-21" aria-hidden="true"></a>      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</span>
<span id="cb151-22"><a href="churn.html#cb151-22" aria-hidden="true"></a>      <span class="dt">activation =</span> act3</span>
<span id="cb151-23"><a href="churn.html#cb151-23" aria-hidden="true"></a>    )</span>
<span id="cb151-24"><a href="churn.html#cb151-24" aria-hidden="true"></a>}</span></code></pre></div>
<p>All the models and downstream results are affected.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="churn.html#cb152-1" aria-hidden="true"></a><span class="kw">make</span>(plan)</span>
<span id="cb152-2"><a href="churn.html#cb152-2" aria-hidden="true"></a><span class="co">#&gt; ▶ target model_relu</span></span>
<span id="cb152-3"><a href="churn.html#cb152-3" aria-hidden="true"></a><span class="co">#&gt; ▶ target model_softmax</span></span>
<span id="cb152-4"><a href="churn.html#cb152-4" aria-hidden="true"></a><span class="co">#&gt; ▶ target model_sigmoid</span></span>
<span id="cb152-5"><a href="churn.html#cb152-5" aria-hidden="true"></a><span class="co">#&gt; ▶ target conf_relu</span></span>
<span id="cb152-6"><a href="churn.html#cb152-6" aria-hidden="true"></a><span class="co">#&gt; ▶ target conf_softmax</span></span>
<span id="cb152-7"><a href="churn.html#cb152-7" aria-hidden="true"></a><span class="co">#&gt; ▶ target conf_sigmoid</span></span>
<span id="cb152-8"><a href="churn.html#cb152-8" aria-hidden="true"></a><span class="co">#&gt; ▶ target metrics</span></span></code></pre></div>
</div>
<div id="churn-history-and-provenance" class="section level2" number="9.10">
<h2><span class="header-section-number">9.10</span> Churn history and provenance</h2>
<p><code>drake</code> tracks history and provenance. You can see which models you ran, when you ran them, how long they took, and which settings you tried (i.e. named arguments to function calls in your commands).</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="churn.html#cb153-1" aria-hidden="true"></a>history &lt;-<span class="st"> </span><span class="kw">drake_history</span>()</span>
<span id="cb153-2"><a href="churn.html#cb153-2" aria-hidden="true"></a>history</span>
<span id="cb153-3"><a href="churn.html#cb153-3" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 17 x 10</span></span>
<span id="cb153-4"><a href="churn.html#cb153-4" aria-hidden="true"></a><span class="co">#&gt;    target  current built    exists hash  command        seed runtime  prop act1 </span></span>
<span id="cb153-5"><a href="churn.html#cb153-5" aria-hidden="true"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;lgl&gt;   &lt;chr&gt;    &lt;lgl&gt;  &lt;chr&gt; &lt;chr&gt;         &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb153-6"><a href="churn.html#cb153-6" aria-hidden="true"></a><span class="co">#&gt;  1 conf_r… FALSE   2020-08… TRUE   0d6e… &quot;confusion_… 4.05e8  0.434   NA   &lt;NA&gt; </span></span>
<span id="cb153-7"><a href="churn.html#cb153-7" aria-hidden="true"></a><span class="co">#&gt;  2 conf_r… TRUE    2020-08… TRUE   0593… &quot;confusion_… 4.05e8  0.418   NA   &lt;NA&gt; </span></span>
<span id="cb153-8"><a href="churn.html#cb153-8" aria-hidden="true"></a><span class="co">#&gt;  3 conf_s… FALSE   2020-08… TRUE   114b… &quot;confusion_… 1.93e9  0.508   NA   &lt;NA&gt; </span></span>
<span id="cb153-9"><a href="churn.html#cb153-9" aria-hidden="true"></a><span class="co">#&gt;  4 conf_s… TRUE    2020-08… TRUE   4c6e… &quot;confusion_… 1.93e9  0.469   NA   &lt;NA&gt; </span></span>
<span id="cb153-10"><a href="churn.html#cb153-10" aria-hidden="true"></a><span class="co">#&gt;  5 conf_s… FALSE   2020-08… TRUE   8108… &quot;confusion_… 1.80e9  0.442   NA   &lt;NA&gt; </span></span>
<span id="cb153-11"><a href="churn.html#cb153-11" aria-hidden="true"></a><span class="co">#&gt;  6 conf_s… TRUE    2020-08… TRUE   be3e… &quot;confusion_… 1.80e9  0.424   NA   &lt;NA&gt; </span></span>
<span id="cb153-12"><a href="churn.html#cb153-12" aria-hidden="true"></a><span class="co">#&gt;  7 data    TRUE    2020-08… TRUE   ca84… &quot;read_csv(f… 1.29e9  0.0650   0.3 &lt;NA&gt; </span></span>
<span id="cb153-13"><a href="churn.html#cb153-13" aria-hidden="true"></a><span class="co">#&gt;  8 metrics FALSE   2020-08… TRUE   c349… &quot;compare_mo… 1.21e9  0.055   NA   &lt;NA&gt; </span></span>
<span id="cb153-14"><a href="churn.html#cb153-14" aria-hidden="true"></a><span class="co">#&gt;  9 metrics FALSE   2020-08… TRUE   b3fa… &quot;compare_mo… 1.21e9  0.0790  NA   &lt;NA&gt; </span></span>
<span id="cb153-15"><a href="churn.html#cb153-15" aria-hidden="true"></a><span class="co">#&gt; 10 metrics TRUE    2020-08… TRUE   bc5a… &quot;compare_mo… 1.21e9  0.0630  NA   &lt;NA&gt; </span></span>
<span id="cb153-16"><a href="churn.html#cb153-16" aria-hidden="true"></a><span class="co">#&gt; 11 model_… FALSE   2020-08… TRUE   5838… &quot;train_mode… 1.47e9 17.7     NA   relu </span></span>
<span id="cb153-17"><a href="churn.html#cb153-17" aria-hidden="true"></a><span class="co">#&gt; 12 model_… TRUE    2020-08… TRUE   dec1… &quot;train_mode… 1.47e9  4.52    NA   relu </span></span>
<span id="cb153-18"><a href="churn.html#cb153-18" aria-hidden="true"></a><span class="co">#&gt; 13 model_… FALSE   2020-08… TRUE   55a6… &quot;train_mode… 1.26e9  4.42    NA   sigm…</span></span>
<span id="cb153-19"><a href="churn.html#cb153-19" aria-hidden="true"></a><span class="co">#&gt; 14 model_… TRUE    2020-08… TRUE   93c5… &quot;train_mode… 1.26e9  4.52    NA   sigm…</span></span>
<span id="cb153-20"><a href="churn.html#cb153-20" aria-hidden="true"></a><span class="co">#&gt; 15 model_… FALSE   2020-08… TRUE   17ac… &quot;train_mode… 8.05e8  4.54    NA   soft…</span></span>
<span id="cb153-21"><a href="churn.html#cb153-21" aria-hidden="true"></a><span class="co">#&gt; 16 model_… TRUE    2020-08… TRUE   9add… &quot;train_mode… 8.05e8  4.43    NA   soft…</span></span>
<span id="cb153-22"><a href="churn.html#cb153-22" aria-hidden="true"></a><span class="co">#&gt; 17 rec     TRUE    2020-08… TRUE   4a87… &quot;prepare_re… 6.29e8  0.308   NA   &lt;NA&gt;</span></span></code></pre></div>
<p>And as long as you did not run <code>clean(garbage_collection = TRUE)</code>, you can get the old data back. Let’s find the oldest run of the relu model.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="churn.html#cb154-1" aria-hidden="true"></a>hash &lt;-<span class="st"> </span>history <span class="op">%&gt;%</span></span>
<span id="cb154-2"><a href="churn.html#cb154-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(act1 <span class="op">==</span><span class="st"> &quot;relu&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb154-3"><a href="churn.html#cb154-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull</span>(hash) <span class="op">%&gt;%</span></span>
<span id="cb154-4"><a href="churn.html#cb154-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">1</span>)</span>
<span id="cb154-5"><a href="churn.html#cb154-5" aria-hidden="true"></a><span class="kw">drake_cache</span>()<span class="op">$</span><span class="kw">get_value</span>(hash)</span>
<span id="cb154-6"><a href="churn.html#cb154-6" aria-hidden="true"></a><span class="co">#&gt; Model</span></span>
<span id="cb154-7"><a href="churn.html#cb154-7" aria-hidden="true"></a><span class="co">#&gt; Model: &quot;sequential&quot;</span></span>
<span id="cb154-8"><a href="churn.html#cb154-8" aria-hidden="true"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb154-9"><a href="churn.html#cb154-9" aria-hidden="true"></a><span class="co">#&gt; Layer (type)                        Output Shape                    Param #     </span></span>
<span id="cb154-10"><a href="churn.html#cb154-10" aria-hidden="true"></a><span class="co">#&gt; ================================================================================</span></span>
<span id="cb154-11"><a href="churn.html#cb154-11" aria-hidden="true"></a><span class="co">#&gt; dense (Dense)                       (None, 16)                      576         </span></span>
<span id="cb154-12"><a href="churn.html#cb154-12" aria-hidden="true"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb154-13"><a href="churn.html#cb154-13" aria-hidden="true"></a><span class="co">#&gt; dropout (Dropout)                   (None, 16)                      0           </span></span>
<span id="cb154-14"><a href="churn.html#cb154-14" aria-hidden="true"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb154-15"><a href="churn.html#cb154-15" aria-hidden="true"></a><span class="co">#&gt; dense_1 (Dense)                     (None, 16)                      272         </span></span>
<span id="cb154-16"><a href="churn.html#cb154-16" aria-hidden="true"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb154-17"><a href="churn.html#cb154-17" aria-hidden="true"></a><span class="co">#&gt; dropout_1 (Dropout)                 (None, 16)                      0           </span></span>
<span id="cb154-18"><a href="churn.html#cb154-18" aria-hidden="true"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb154-19"><a href="churn.html#cb154-19" aria-hidden="true"></a><span class="co">#&gt; dense_2 (Dense)                     (None, 1)                       17          </span></span>
<span id="cb154-20"><a href="churn.html#cb154-20" aria-hidden="true"></a><span class="co">#&gt; ================================================================================</span></span>
<span id="cb154-21"><a href="churn.html#cb154-21" aria-hidden="true"></a><span class="co">#&gt; Total params: 865</span></span>
<span id="cb154-22"><a href="churn.html#cb154-22" aria-hidden="true"></a><span class="co">#&gt; Trainable params: 865</span></span>
<span id="cb154-23"><a href="churn.html#cb154-23" aria-hidden="true"></a><span class="co">#&gt; Non-trainable params: 0</span></span>
<span id="cb154-24"><a href="churn.html#cb154-24" aria-hidden="true"></a><span class="co">#&gt; ________________________________________________________________________________</span></span></code></pre></div>

</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scripts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stan.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropensci-books/drake/edit/master/churn.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropensci-books/drake/commits/master/churn.Rmd",
"text": "Chapter edit history"
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
