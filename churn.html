<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Customer churn and deep learning | The drake R Package User Manual</title>
  <meta name="description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Customer churn and deep learning | The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://books.ropensci.org/drake/" />
  <meta property="og:image" content="https://books.ropensci.org/drake//images/logo.png" />
  <meta property="og:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="github-repo" content="ropensci-books/drake" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Customer churn and deep learning | The drake R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="twitter:image" content="https://books.ropensci.org/drake//images/logo.png" />

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert, Ellis Hughes, Matthew Mark Strasiotto" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="scripts.html"/>
<link rel="next" href="packages.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150843595-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150843595-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="https://ropensci.github.io/dev_guide/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The drake R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#short-version"><i class="fa fa-check"></i><b>1.1</b> Short version</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#long-version"><i class="fa fa-check"></i><b>1.2</b> Long version</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.3</b> The drake R package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.4</b> Installation</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.5</b> Why drake?</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.5.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.5.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#scale-up-and-out."><i class="fa fa-check"></i><b>1.5.3</b> Scale up and out.</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#with-docker"><i class="fa fa-check"></i><b>1.6</b> With Docker</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.7</b> Documentation</a><ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.7.1</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.7.2</b> Function reference</a></li>
<li class="chapter" data-level="1.7.3" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.7.3</b> Tutorials</a></li>
<li class="chapter" data-level="1.7.4" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.7.4</b> Examples</a></li>
<li class="chapter" data-level="1.7.5" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.7.5</b> Presentations</a></li>
<li class="chapter" data-level="1.7.6" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.7.6</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.8</b> Help and troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="similar-work.html"><a href="similar-work.html"><i class="fa fa-check"></i><b>2</b> Similar work</a><ul>
<li class="chapter" data-level="2.1" data-path="similar-work.html"><a href="similar-work.html#pipeline-tools"><i class="fa fa-check"></i><b>2.1</b> Pipeline tools</a><ul>
<li class="chapter" data-level="2.1.1" data-path="similar-work.html"><a href="similar-work.html#gnu-make"><i class="fa fa-check"></i><b>2.1.1</b> GNU Make</a></li>
<li class="chapter" data-level="2.1.2" data-path="similar-work.html"><a href="similar-work.html#remake"><i class="fa fa-check"></i><b>2.1.2</b> Remake</a></li>
<li class="chapter" data-level="2.1.3" data-path="similar-work.html"><a href="similar-work.html#factuals-drake"><i class="fa fa-check"></i><b>2.1.3</b> Factual’s Drake</a></li>
<li class="chapter" data-level="2.1.4" data-path="similar-work.html"><a href="similar-work.html#other-pipeline-tools"><i class="fa fa-check"></i><b>2.1.4</b> Other pipeline tools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="similar-work.html"><a href="similar-work.html#memoization"><i class="fa fa-check"></i><b>2.2</b> Memoization</a></li>
<li class="chapter" data-level="2.3" data-path="similar-work.html"><a href="similar-work.html#literate-programming"><i class="fa fa-check"></i><b>2.3</b> Literate programming</a><ul>
<li class="chapter" data-level="2.3.1" data-path="similar-work.html"><a href="similar-work.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>2.3.1</b> knitr and R Markdown</a></li>
<li class="chapter" data-level="2.3.2" data-path="similar-work.html"><a href="similar-work.html#version-control"><i class="fa fa-check"></i><b>2.3.2</b> Version control</a></li>
<li class="chapter" data-level="2.3.3" data-path="similar-work.html"><a href="similar-work.html#containerization-and-r-package-environments"><i class="fa fa-check"></i><b>2.3.3</b> Containerization and R package environments</a></li>
<li class="chapter" data-level="2.3.4" data-path="similar-work.html"><a href="similar-work.html#workflowr"><i class="fa fa-check"></i><b>2.3.4</b> workflowr</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="similar-work.html"><a href="similar-work.html#acknowledgements"><i class="fa fa-check"></i><b>2.4</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="3" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>3</b> Walkthrough</a><ul>
<li class="chapter" data-level="3.1" data-path="walkthrough.html"><a href="walkthrough.html#set-the-stage."><i class="fa fa-check"></i><b>3.1</b> Set the stage.</a></li>
<li class="chapter" data-level="3.2" data-path="walkthrough.html"><a href="walkthrough.html#make-your-results."><i class="fa fa-check"></i><b>3.2</b> Make your results.</a></li>
<li class="chapter" data-level="3.3" data-path="walkthrough.html"><a href="walkthrough.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>3.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="3.4" data-path="walkthrough.html"><a href="walkthrough.html#history-and-provenance"><i class="fa fa-check"></i><b>3.4</b> History and provenance</a></li>
<li class="chapter" data-level="3.5" data-path="walkthrough.html"><a href="walkthrough.html#reproducible-data-recovery-and-renaming"><i class="fa fa-check"></i><b>3.5</b> Reproducible data recovery and renaming</a><ul>
<li class="chapter" data-level="3.5.1" data-path="walkthrough.html"><a href="walkthrough.html#undoing-clean"><i class="fa fa-check"></i><b>3.5.1</b> Undoing <code>clean()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="walkthrough.html"><a href="walkthrough.html#renaming"><i class="fa fa-check"></i><b>3.5.2</b> Renaming</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="walkthrough.html"><a href="walkthrough.html#try-the-code-yourself"><i class="fa fa-check"></i><b>3.6</b> Try the code yourself!</a></li>
<li class="chapter" data-level="3.7" data-path="walkthrough.html"><a href="walkthrough.html#thanks"><i class="fa fa-check"></i><b>3.7</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>4</b> <code>drake</code> plans</a><ul>
<li class="chapter" data-level="4.1" data-path="plans.html"><a href="plans.html#functions"><i class="fa fa-check"></i><b>4.1</b> Functions</a></li>
<li class="chapter" data-level="4.2" data-path="plans.html"><a href="plans.html#intro-to-plans"><i class="fa fa-check"></i><b>4.2</b> Intro to plans</a></li>
<li class="chapter" data-level="4.3" data-path="plans.html"><a href="plans.html#how-to-choose-good-targets"><i class="fa fa-check"></i><b>4.3</b> How to choose good targets</a></li>
<li class="chapter" data-level="4.4" data-path="plans.html"><a href="plans.html#special-data-formats-for-targets"><i class="fa fa-check"></i><b>4.4</b> Special data formats for targets</a></li>
<li class="chapter" data-level="4.5" data-path="plans.html"><a href="plans.html#special-columns"><i class="fa fa-check"></i><b>4.5</b> Special columns</a></li>
<li class="chapter" data-level="4.6" data-path="plans.html"><a href="plans.html#external-files"><i class="fa fa-check"></i><b>4.6</b> External files</a><ul>
<li class="chapter" data-level="4.6.1" data-path="plans.html"><a href="plans.html#urls"><i class="fa fa-check"></i><b>4.6.1</b> URLs</a></li>
<li class="chapter" data-level="4.6.2" data-path="plans.html"><a href="plans.html#limitations-of-file-tracking"><i class="fa fa-check"></i><b>4.6.2</b> Limitations of file tracking</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="plans.html"><a href="plans.html#large-plans"><i class="fa fa-check"></i><b>4.7</b> Large plans</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="static.html"><a href="static.html"><i class="fa fa-check"></i><b>5</b> Static branching</a><ul>
<li class="chapter" data-level="5.1" data-path="static.html"><a href="static.html#why-static-branching"><i class="fa fa-check"></i><b>5.1</b> Why static branching?</a></li>
<li class="chapter" data-level="5.2" data-path="static.html"><a href="static.html#grouping-variables-and-the-trace"><i class="fa fa-check"></i><b>5.2</b> Grouping variables and the trace</a></li>
<li class="chapter" data-level="5.3" data-path="static.html"><a href="static.html#tidy-evaluation"><i class="fa fa-check"></i><b>5.3</b> Tidy evaluation</a></li>
<li class="chapter" data-level="5.4" data-path="static.html"><a href="static.html#static-transformations"><i class="fa fa-check"></i><b>5.4</b> Static transformations</a><ul>
<li class="chapter" data-level="5.4.1" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>5.4.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="5.4.2" data-path="static.html"><a href="static.html#cross"><i class="fa fa-check"></i><b>5.4.2</b> <code>cross()</code></a></li>
<li class="chapter" data-level="5.4.3" data-path="static.html"><a href="static.html#split"><i class="fa fa-check"></i><b>5.4.3</b> <code>split()</code></a></li>
<li class="chapter" data-level="5.4.4" data-path="static.html"><a href="static.html#combine"><i class="fa fa-check"></i><b>5.4.4</b> <code>combine()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="static.html"><a href="static.html#tags"><i class="fa fa-check"></i><b>5.5</b> Tags</a><ul>
<li class="chapter" data-level="5.5.1" data-path="static.html"><a href="static.html#target-names"><i class="fa fa-check"></i><b>5.5.1</b> Target names</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>6</b> Dynamic branching</a><ul>
<li class="chapter" data-level="6.1" data-path="dynamic.html"><a href="dynamic.html#a-note-about-versions"><i class="fa fa-check"></i><b>6.1</b> A note about versions</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic.html"><a href="dynamic.html#motivation"><i class="fa fa-check"></i><b>6.2</b> Motivation</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic.html"><a href="dynamic.html#which-kind-of-branching-should-i-use"><i class="fa fa-check"></i><b>6.3</b> Which kind of branching should I use?</a></li>
<li class="chapter" data-level="6.4" data-path="dynamic.html"><a href="dynamic.html#dynamic-targets"><i class="fa fa-check"></i><b>6.4</b> Dynamic targets</a></li>
<li class="chapter" data-level="6.5" data-path="dynamic.html"><a href="dynamic.html#dynamic-transformations"><i class="fa fa-check"></i><b>6.5</b> Dynamic transformations</a><ul>
<li class="chapter" data-level="6.5.1" data-path="dynamic.html"><a href="dynamic.html#map-1"><i class="fa fa-check"></i><b>6.5.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="dynamic.html"><a href="dynamic.html#cross-1"><i class="fa fa-check"></i><b>6.5.2</b> <code>cross()</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="dynamic.html"><a href="dynamic.html#group"><i class="fa fa-check"></i><b>6.5.3</b> <code>group()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="dynamic.html"><a href="dynamic.html#trace"><i class="fa fa-check"></i><b>6.6</b> Trace</a></li>
<li class="chapter" data-level="6.7" data-path="dynamic.html"><a href="dynamic.html#max_expand"><i class="fa fa-check"></i><b>6.7</b> <code>max_expand</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>7</b> <code>drake</code> projects</a><ul>
<li class="chapter" data-level="7.1" data-path="projects.html"><a href="projects.html#code-files"><i class="fa fa-check"></i><b>7.1</b> Code files</a></li>
<li class="chapter" data-level="7.2" data-path="projects.html"><a href="projects.html#safer-interactivity"><i class="fa fa-check"></i><b>7.2</b> Safer interactivity</a><ul>
<li class="chapter" data-level="7.2.1" data-path="projects.html"><a href="projects.html#motivation-1"><i class="fa fa-check"></i><b>7.2.1</b> Motivation</a></li>
<li class="chapter" data-level="7.2.2" data-path="projects.html"><a href="projects.html#usage"><i class="fa fa-check"></i><b>7.2.2</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="projects.html"><a href="projects.html#script-file-pitfalls"><i class="fa fa-check"></i><b>7.3</b> Script file pitfalls</a></li>
<li class="chapter" data-level="7.4" data-path="projects.html"><a href="projects.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>7.4</b> Workflows as R packages</a></li>
<li class="chapter" data-level="7.5" data-path="projects.html"><a href="projects.html#other-tools"><i class="fa fa-check"></i><b>7.5</b> Other tools</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="scripts.html"><a href="scripts.html"><i class="fa fa-check"></i><b>8</b> Script-based workflows</a><ul>
<li class="chapter" data-level="8.1" data-path="scripts.html"><a href="scripts.html#function-oriented-workflows"><i class="fa fa-check"></i><b>8.1</b> Function-oriented workflows</a></li>
<li class="chapter" data-level="8.2" data-path="scripts.html"><a href="scripts.html#traditional-and-legacy-workflows"><i class="fa fa-check"></i><b>8.2</b> Traditional and legacy workflows</a></li>
<li class="chapter" data-level="8.3" data-path="scripts.html"><a href="scripts.html#overcoming-technical-debt"><i class="fa fa-check"></i><b>8.3</b> Overcoming Technical Debt</a></li>
<li class="chapter" data-level="8.4" data-path="scripts.html"><a href="scripts.html#dependencies"><i class="fa fa-check"></i><b>8.4</b> Dependencies</a></li>
<li class="chapter" data-level="8.5" data-path="scripts.html"><a href="scripts.html#building-the-connections"><i class="fa fa-check"></i><b>8.5</b> Building the connections</a></li>
<li class="chapter" data-level="8.6" data-path="scripts.html"><a href="scripts.html#run-the-workflow"><i class="fa fa-check"></i><b>8.6</b> Run the workflow</a></li>
<li class="chapter" data-level="8.7" data-path="scripts.html"><a href="scripts.html#keeping-the-results-up-to-date"><i class="fa fa-check"></i><b>8.7</b> Keeping the results up to date</a></li>
<li class="chapter" data-level="8.8" data-path="scripts.html"><a href="scripts.html#final-thoughts"><i class="fa fa-check"></i><b>8.8</b> Final thoughts</a></li>
</ul></li>
<li class="part"><span><b>II Examples</b></span></li>
<li class="chapter" data-level="9" data-path="churn.html"><a href="churn.html"><i class="fa fa-check"></i><b>9</b> Customer churn and deep learning</a><ul>
<li class="chapter" data-level="9.1" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>9.1</b> Packages</a></li>
<li class="chapter" data-level="9.2" data-path="churn.html"><a href="churn.html#functions-1"><i class="fa fa-check"></i><b>9.2</b> Functions</a></li>
<li class="chapter" data-level="9.3" data-path="churn.html"><a href="churn.html#plan"><i class="fa fa-check"></i><b>9.3</b> Plan</a></li>
<li class="chapter" data-level="9.4" data-path="churn.html"><a href="churn.html#dependency-graph"><i class="fa fa-check"></i><b>9.4</b> Dependency graph</a></li>
<li class="chapter" data-level="9.5" data-path="churn.html"><a href="churn.html#run-the-models"><i class="fa fa-check"></i><b>9.5</b> Run the models</a></li>
<li class="chapter" data-level="9.6" data-path="churn.html"><a href="churn.html#inspect-the-results"><i class="fa fa-check"></i><b>9.6</b> Inspect the results</a></li>
<li class="chapter" data-level="9.7" data-path="churn.html"><a href="churn.html#add-models"><i class="fa fa-check"></i><b>9.7</b> Add models</a></li>
<li class="chapter" data-level="9.8" data-path="churn.html"><a href="churn.html#inspect-the-results-again"><i class="fa fa-check"></i><b>9.8</b> Inspect the results again</a></li>
<li class="chapter" data-level="9.9" data-path="churn.html"><a href="churn.html#update-your-code"><i class="fa fa-check"></i><b>9.9</b> Update your code</a></li>
<li class="chapter" data-level="9.10" data-path="churn.html"><a href="churn.html#history-and-provenance-1"><i class="fa fa-check"></i><b>9.10</b> History and provenance</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>10</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="10.1" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>10.1</b> Get the code.</a></li>
<li class="chapter" data-level="10.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>10.2</b> Overview</a></li>
<li class="chapter" data-level="10.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>10.3</b> Analysis</a></li>
<li class="chapter" data-level="10.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>10.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>11</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="11.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>11.1</b> Get the code.</a></li>
<li class="chapter" data-level="11.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>11.2</b> Objective and methods</a></li>
<li class="chapter" data-level="11.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>11.3</b> Data</a></li>
<li class="chapter" data-level="11.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>11.4</b> Analysis</a></li>
<li class="chapter" data-level="11.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>11.5</b> Results</a></li>
<li class="chapter" data-level="11.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>11.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="11.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>11.7</b> References</a></li>
</ul></li>
<li class="part"><span><b>III Resource management</b></span></li>
<li class="chapter" data-level="12" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>12</b> High-performance computing</a><ul>
<li class="chapter" data-level="12.1" data-path="hpc.html"><a href="hpc.html#start-small"><i class="fa fa-check"></i><b>12.1</b> Start small</a></li>
<li class="chapter" data-level="12.2" data-path="hpc.html"><a href="hpc.html#let-make-schedule-your-targets."><i class="fa fa-check"></i><b>12.2</b> Let <code>make()</code> schedule your targets.</a></li>
<li class="chapter" data-level="12.3" data-path="hpc.html"><a href="hpc.html#the-master-process"><i class="fa fa-check"></i><b>12.3</b> The master process</a><ul>
<li class="chapter" data-level="12.3.1" data-path="hpc.html"><a href="hpc.html#master-on-a-cluster"><i class="fa fa-check"></i><b>12.3.1</b> Master on a cluster</a></li>
<li class="chapter" data-level="12.3.2" data-path="hpc.html"><a href="hpc.html#local-master"><i class="fa fa-check"></i><b>12.3.2</b> Local master</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>12.4</b> Parallel backends</a></li>
<li class="chapter" data-level="12.5" data-path="hpc.html"><a href="hpc.html#the-clustermq-backend"><i class="fa fa-check"></i><b>12.5</b> The <code>clustermq</code> backend</a><ul>
<li class="chapter" data-level="12.5.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>12.5.1</b> Persistent workers</a></li>
<li class="chapter" data-level="12.5.2" data-path="hpc.html"><a href="hpc.html#installation-1"><i class="fa fa-check"></i><b>12.5.2</b> Installation</a></li>
<li class="chapter" data-level="12.5.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine"><i class="fa fa-check"></i><b>12.5.3</b> On your local machine</a></li>
<li class="chapter" data-level="12.5.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster"><i class="fa fa-check"></i><b>12.5.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="hpc.html"><a href="hpc.html#the-future-backend"><i class="fa fa-check"></i><b>12.6</b> The <code>future</code> backend</a><ul>
<li class="chapter" data-level="12.6.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>12.6.1</b> Transient workers</a></li>
<li class="chapter" data-level="12.6.2" data-path="hpc.html"><a href="hpc.html#installation-2"><i class="fa fa-check"></i><b>12.6.2</b> Installation</a></li>
<li class="chapter" data-level="12.6.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine-1"><i class="fa fa-check"></i><b>12.6.3</b> On your local machine</a></li>
<li class="chapter" data-level="12.6.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster-1"><i class="fa fa-check"></i><b>12.6.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="hpc.html"><a href="hpc.html#advanced-options"><i class="fa fa-check"></i><b>12.7</b> Advanced options</a><ul>
<li class="chapter" data-level="12.7.1" data-path="hpc.html"><a href="hpc.html#selectivity"><i class="fa fa-check"></i><b>12.7.1</b> Selectivity</a></li>
<li class="chapter" data-level="12.7.2" data-path="hpc.html"><a href="hpc.html#memory-options"><i class="fa fa-check"></i><b>12.7.2</b> Memory options</a></li>
<li class="chapter" data-level="12.7.3" data-path="hpc.html"><a href="hpc.html#storage-options"><i class="fa fa-check"></i><b>12.7.3</b> Storage options</a></li>
<li class="chapter" data-level="12.7.4" data-path="hpc.html"><a href="hpc.html#the-template-argument-for-persistent-workers"><i class="fa fa-check"></i><b>12.7.4</b> The <code>template</code> argument for persistent workers</a></li>
<li class="chapter" data-level="12.7.5" data-path="hpc.html"><a href="hpc.html#the-resources-column-for-transient-workers"><i class="fa fa-check"></i><b>12.7.5</b> The <code>resources</code> column for transient workers</a></li>
<li class="chapter" data-level="12.7.6" data-path="hpc.html"><a href="hpc.html#parallel-computing-within-targets"><i class="fa fa-check"></i><b>12.7.6</b> Parallel computing <em>within</em> targets</a></li>
<li class="chapter" data-level="12.7.7" data-path="hpc.html"><a href="hpc.html#custom-job-schedulers"><i class="fa fa-check"></i><b>12.7.7</b> Custom job schedulers</a></li>
<li class="chapter" data-level="12.7.8" data-path="hpc.html"><a href="hpc.html#hasty-mode"><i class="fa fa-check"></i><b>12.7.8</b> Hasty mode</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>13</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="13.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>13.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="13.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>13.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>14</b> Memory management</a><ul>
<li class="chapter" data-level="14.1" data-path="memory.html"><a href="memory.html#garbage-collection-and-custom-files"><i class="fa fa-check"></i><b>14.1</b> Garbage collection and custom files</a></li>
<li class="chapter" data-level="14.2" data-path="memory.html"><a href="memory.html#memory-strategies"><i class="fa fa-check"></i><b>14.2</b> Memory strategies</a></li>
<li class="chapter" data-level="14.3" data-path="memory.html"><a href="memory.html#data-splitting"><i class="fa fa-check"></i><b>14.3</b> Data splitting</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="storage.html"><a href="storage.html"><i class="fa fa-check"></i><b>15</b> Storage</a><ul>
<li class="chapter" data-level="15.1" data-path="storage.html"><a href="storage.html#special-data-formats-for-targets-1"><i class="fa fa-check"></i><b>15.1</b> Special data formats for targets</a></li>
<li class="chapter" data-level="15.2" data-path="storage.html"><a href="storage.html#cache-management"><i class="fa fa-check"></i><b>15.2</b> Cache management</a></li>
<li class="chapter" data-level="15.3" data-path="storage.html"><a href="storage.html#cache-formats"><i class="fa fa-check"></i><b>15.3</b> Cache formats</a><ul>
<li class="chapter" data-level="15.3.1" data-path="storage.html"><a href="storage.html#rds-caches"><i class="fa fa-check"></i><b>15.3.1</b> RDS caches</a></li>
<li class="chapter" data-level="15.3.2" data-path="storage.html"><a href="storage.html#database-caches"><i class="fa fa-check"></i><b>15.3.2</b> Database caches</a></li>
<li class="chapter" data-level="15.3.3" data-path="storage.html"><a href="storage.html#environment-caches"><i class="fa fa-check"></i><b>15.3.3</b> Environment caches</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="storage.html"><a href="storage.html#hash-algorithms"><i class="fa fa-check"></i><b>15.4</b> Hash algorithms</a></li>
</ul></li>
<li class="part"><span><b>IV Extra features</b></span></li>
<li class="chapter" data-level="16" data-path="visuals.html"><a href="visuals.html"><i class="fa fa-check"></i><b>16</b> Visualization with drake</a><ul>
<li class="chapter" data-level="16.1" data-path="visuals.html"><a href="visuals.html#plotting-plans"><i class="fa fa-check"></i><b>16.1</b> Plotting plans</a><ul>
<li class="chapter" data-level="16.1.1" data-path="visuals.html"><a href="visuals.html#vis_drake_graph"><i class="fa fa-check"></i><b>16.1.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="16.1.2" data-path="visuals.html"><a href="visuals.html#sankey_drake_graph"><i class="fa fa-check"></i><b>16.1.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="16.1.3" data-path="visuals.html"><a href="visuals.html#drake_ggraph"><i class="fa fa-check"></i><b>16.1.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="16.1.4" data-path="visuals.html"><a href="visuals.html#text_drake_graph"><i class="fa fa-check"></i><b>16.1.4</b> <code>text_drake_graph()</code></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="visuals.html"><a href="visuals.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>16.2</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="16.3" data-path="visuals.html"><a href="visuals.html#visualizing-target-status"><i class="fa fa-check"></i><b>16.3</b> Visualizing target status</a></li>
<li class="chapter" data-level="16.4" data-path="visuals.html"><a href="visuals.html#subgraphs"><i class="fa fa-check"></i><b>16.4</b> Subgraphs</a></li>
<li class="chapter" data-level="16.5" data-path="visuals.html"><a href="visuals.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>16.5</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="16.6" data-path="visuals.html"><a href="visuals.html#clusters"><i class="fa fa-check"></i><b>16.6</b> Clusters</a></li>
<li class="chapter" data-level="16.7" data-path="visuals.html"><a href="visuals.html#output-files"><i class="fa fa-check"></i><b>16.7</b> Output files</a></li>
<li class="chapter" data-level="16.8" data-path="visuals.html"><a href="visuals.html#node-selection"><i class="fa fa-check"></i><b>16.8</b> Node Selection</a><ul>
<li class="chapter" data-level="16.8.1" data-path="visuals.html"><a href="visuals.html#perform-the-default-action-on-select"><i class="fa fa-check"></i><b>16.8.1</b> Perform the default action on select</a></li>
<li class="chapter" data-level="16.8.2" data-path="visuals.html"><a href="visuals.html#perform-no-action-on-select"><i class="fa fa-check"></i><b>16.8.2</b> Perform no action on select</a></li>
<li class="chapter" data-level="16.8.3" data-path="visuals.html"><a href="visuals.html#customize-the-onselect-event-behaviour"><i class="fa fa-check"></i><b>16.8.3</b> Customize the onSelect event behaviour</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>17</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="17.0.1" data-path="debugging.html"><a href="debugging.html#start-small-1"><i class="fa fa-check"></i><b>17.0.1</b> Start small</a></li>
<li class="chapter" data-level="17.1" data-path="debugging.html"><a href="debugging.html#dependencies-1"><i class="fa fa-check"></i><b>17.1</b> Dependencies</a><ul>
<li class="chapter" data-level="17.1.1" data-path="debugging.html"><a href="debugging.html#visualize-your-dependency-graph."><i class="fa fa-check"></i><b>17.1.1</b> Visualize your dependency graph.</a></li>
<li class="chapter" data-level="17.1.2" data-path="debugging.html"><a href="debugging.html#check-specific-dependency-information."><i class="fa fa-check"></i><b>17.1.2</b> Check specific dependency information.</a></li>
<li class="chapter" data-level="17.1.3" data-path="debugging.html"><a href="debugging.html#outdated-targets-and-missing-dependencies"><i class="fa fa-check"></i><b>17.1.3</b> Outdated targets and missing dependencies</a></li>
<li class="chapter" data-level="17.1.4" data-path="debugging.html"><a href="debugging.html#but-why-are-my-targets-out-of-date"><i class="fa fa-check"></i><b>17.1.4</b> But <em>why</em> are my targets out of date?</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="debugging.html"><a href="debugging.html#diagnose-failures."><i class="fa fa-check"></i><b>17.2</b> Diagnose failures.</a></li>
<li class="chapter" data-level="17.3" data-path="debugging.html"><a href="debugging.html#timeouts-and-retries"><i class="fa fa-check"></i><b>17.3</b> Timeouts and retries</a></li>
<li class="chapter" data-level="17.4" data-path="debugging.html"><a href="debugging.html#more-help"><i class="fa fa-check"></i><b>17.4</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>18</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="18.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>18.1</b> What are triggers?</a></li>
<li class="chapter" data-level="18.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>18.2</b> Customization</a></li>
<li class="chapter" data-level="18.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>18.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="18.4" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>18.4</b> A more practical example</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>B</b> Cautionary notes</a><ul>
<li class="chapter" data-level="B.1" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>B.1</b> Workflow plans</a><ul>
<li class="chapter" data-level="B.1.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>B.1.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="B.1.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>B.1.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>B.2</b> Execution</a><ul>
<li class="chapter" data-level="B.2.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>B.2.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="B.2.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>B.2.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="B.2.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>B.2.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="B.2.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>B.2.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="B.2.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>B.2.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="B.2.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>B.2.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="B.2.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>B.2.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="B.2.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>B.2.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="caution.html"><a href="caution.html#dependencies-2"><i class="fa fa-check"></i><b>B.3</b> Dependencies</a><ul>
<li class="chapter" data-level="B.3.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-rebuild-too-often"><i class="fa fa-check"></i><b>B.3.1</b> Objects that contain functions may rebuild too often</a></li>
<li class="chapter" data-level="B.3.2" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>B.3.2</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="B.3.3" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>B.3.3</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="B.3.4" data-path="caution.html"><a href="caution.html#s3-and-generic-methods"><i class="fa fa-check"></i><b>B.3.4</b> S3 and generic methods</a></li>
<li class="chapter" data-level="B.3.5" data-path="caution.html"><a href="caution.html#file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>B.3.5</b> File outputs in imported functions.</a></li>
<li class="chapter" data-level="B.3.6" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>B.3.6</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="B.3.7" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.7</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.8" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.8</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.9" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>B.3.9</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>B.4</b> High-performance computing</a><ul>
<li class="chapter" data-level="B.4.1" data-path="caution.html"><a href="caution.html#calling-mclapply-within-targets"><i class="fa fa-check"></i><b>B.4.1</b> Calling <code>mclapply()</code> <em>within</em> targets</a></li>
<li class="chapter" data-level="B.4.2" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>B.4.2</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="caution.html"><a href="caution.html#storage-1"><i class="fa fa-check"></i><b>B.5</b> Storage</a><ul>
<li class="chapter" data-level="B.5.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>B.5.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="B.5.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>B.5.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="B.5.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>B.5.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="churn" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Customer churn and deep learning</h1>
<p><a href="https://github.com/ropensci/drake"><code>drake</code></a> is designed for workflows with long runtimes, and a major use case is deep learning. This chapter demonstrates how to leverage <a href="https://github.com/ropensci/drake"><code>drake</code></a> to manage a deep learning workflow. The original example comes from a <a href="https://blogs.rstudio.com/tensorflow/posts/2018-01-11-keras-customer-churn/">blog post by Matt Dancho</a>, and the chapter’s content itself comes directly from <a href="https://github.com/sol-eng/tensorflow-w-r/blob/master/workflow/tensorflow-drake.Rmd">this R notebook</a>, part of an <a href="https://github.com/sol-eng/tensorflow-w-r">RStudio Solutions Engineering example demonstrating TensorFlow in R</a>. The notebook is modified and redistributed under the terms of the <a href="https://github.com/sol-eng/tensorflow-w-r/blob/master/LICENSE">Apache 2.0 license</a>, copyright RStudio (<a href="https://github.com/ropensci-books/drake/blob/master/COPYRIGHT">details here</a>).</p>
<div id="packages" class="section level2">
<h2><span class="header-section-number">9.1</span> Packages</h2>
<p>First, we load our packages into a fresh R session.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw">library</span>(drake)</a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="kw">library</span>(keras)</a>
<a class="sourceLine" id="cb121-3" data-line-number="3"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb121-4" data-line-number="4"><span class="kw">library</span>(rsample)</a>
<a class="sourceLine" id="cb121-5" data-line-number="5"><span class="kw">library</span>(recipes)</a>
<a class="sourceLine" id="cb121-6" data-line-number="6"><span class="kw">library</span>(yardstick)</a></code></pre></div>
</div>
<div id="functions-1" class="section level2">
<h2><span class="header-section-number">9.2</span> Functions</h2>
<p><a href="https://github.com/ropensci/drake"><code>drake</code></a> is R-focused and function-oriented. We create functions to <a href="https://github.com/tidymodels/recipes">preprocess the data</a>,</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">prepare_recipe &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb122-2" data-line-number="2">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-3" data-line-number="3"><span class="st">    </span><span class="kw">training</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-4" data-line-number="4"><span class="st">    </span><span class="kw">recipe</span>(Churn <span class="op">~</span><span class="st"> </span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-5" data-line-number="5"><span class="st">    </span><span class="kw">step_rm</span>(customerID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-6" data-line-number="6"><span class="st">    </span><span class="kw">step_naomit</span>(<span class="kw">all_outcomes</span>(), <span class="kw">all_predictors</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-7" data-line-number="7"><span class="st">    </span><span class="kw">step_discretize</span>(tenure, <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">cuts =</span> <span class="dv">6</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-8" data-line-number="8"><span class="st">    </span><span class="kw">step_log</span>(TotalCharges) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-9" data-line-number="9"><span class="st">    </span><span class="kw">step_mutate</span>(<span class="dt">Churn =</span> <span class="kw">ifelse</span>(Churn <span class="op">==</span><span class="st"> &quot;Yes&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-10" data-line-number="10"><span class="st">    </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal</span>(), <span class="op">-</span><span class="kw">all_outcomes</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-11" data-line-number="11"><span class="st">    </span><span class="kw">step_center</span>(<span class="kw">all_predictors</span>(), <span class="op">-</span><span class="kw">all_outcomes</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-12" data-line-number="12"><span class="st">    </span><span class="kw">step_scale</span>(<span class="kw">all_predictors</span>(), <span class="op">-</span><span class="kw">all_outcomes</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-13" data-line-number="13"><span class="st">    </span><span class="kw">prep</span>()</a>
<a class="sourceLine" id="cb122-14" data-line-number="14">}</a></code></pre></div>
<p>define a <a href="https://github.com/rstudio/keras"><code>keras</code></a> model, exposing arguments to set the dimensionality and activation functions of the layers,</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">define_model &lt;-<span class="st"> </span><span class="cf">function</span>(rec, units1, units2, act1, act2, act3) {</a>
<a class="sourceLine" id="cb123-2" data-line-number="2">  input_shape &lt;-<span class="st"> </span><span class="kw">ncol</span>(</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">    <span class="kw">juice</span>(rec, <span class="kw">all_predictors</span>(), <span class="dt">composition =</span> <span class="st">&quot;matrix&quot;</span>)</a>
<a class="sourceLine" id="cb123-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb123-5" data-line-number="5">  <span class="kw">keras_model_sequential</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-6" data-line-number="6"><span class="st">    </span><span class="kw">layer_dense</span>(</a>
<a class="sourceLine" id="cb123-7" data-line-number="7">      <span class="dt">units =</span> units1,</a>
<a class="sourceLine" id="cb123-8" data-line-number="8">      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</a>
<a class="sourceLine" id="cb123-9" data-line-number="9">      <span class="dt">activation =</span> act1,</a>
<a class="sourceLine" id="cb123-10" data-line-number="10">      <span class="dt">input_shape =</span> input_shape</a>
<a class="sourceLine" id="cb123-11" data-line-number="11">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-12" data-line-number="12"><span class="st">    </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span> <span class="fl">0.1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-13" data-line-number="13"><span class="st">    </span><span class="kw">layer_dense</span>(</a>
<a class="sourceLine" id="cb123-14" data-line-number="14">      <span class="dt">units =</span> units2,</a>
<a class="sourceLine" id="cb123-15" data-line-number="15">      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</a>
<a class="sourceLine" id="cb123-16" data-line-number="16">      <span class="dt">activation =</span> act2</a>
<a class="sourceLine" id="cb123-17" data-line-number="17">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-18" data-line-number="18"><span class="st">    </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span> <span class="fl">0.1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-19" data-line-number="19"><span class="st">    </span><span class="kw">layer_dense</span>(</a>
<a class="sourceLine" id="cb123-20" data-line-number="20">      <span class="dt">units =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb123-21" data-line-number="21">      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</a>
<a class="sourceLine" id="cb123-22" data-line-number="22">      <span class="dt">activation =</span> act3</a>
<a class="sourceLine" id="cb123-23" data-line-number="23">    )</a>
<a class="sourceLine" id="cb123-24" data-line-number="24">}</a></code></pre></div>
<p>train a model,</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">train_model &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb124-2" data-line-number="2">  rec,</a>
<a class="sourceLine" id="cb124-3" data-line-number="3">  <span class="dt">units1 =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb124-4" data-line-number="4">  <span class="dt">units2 =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb124-5" data-line-number="5">  <span class="dt">act1 =</span> <span class="st">&quot;relu&quot;</span>,</a>
<a class="sourceLine" id="cb124-6" data-line-number="6">  <span class="dt">act2 =</span> <span class="st">&quot;relu&quot;</span>,</a>
<a class="sourceLine" id="cb124-7" data-line-number="7">  <span class="dt">act3 =</span> <span class="st">&quot;sigmoid&quot;</span></a>
<a class="sourceLine" id="cb124-8" data-line-number="8">) {</a>
<a class="sourceLine" id="cb124-9" data-line-number="9">  model &lt;-<span class="st"> </span><span class="kw">define_model</span>(</a>
<a class="sourceLine" id="cb124-10" data-line-number="10">    <span class="dt">rec =</span> rec,</a>
<a class="sourceLine" id="cb124-11" data-line-number="11">    <span class="dt">units1 =</span> units1,</a>
<a class="sourceLine" id="cb124-12" data-line-number="12">    <span class="dt">units2 =</span> units2,</a>
<a class="sourceLine" id="cb124-13" data-line-number="13">    <span class="dt">act1 =</span> act1,</a>
<a class="sourceLine" id="cb124-14" data-line-number="14">    <span class="dt">act2 =</span> act2,</a>
<a class="sourceLine" id="cb124-15" data-line-number="15">    <span class="dt">act3 =</span> act3</a>
<a class="sourceLine" id="cb124-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb124-17" data-line-number="17">  <span class="kw">compile</span>(</a>
<a class="sourceLine" id="cb124-18" data-line-number="18">    model,</a>
<a class="sourceLine" id="cb124-19" data-line-number="19">    <span class="dt">optimizer =</span> <span class="st">&quot;adam&quot;</span>,</a>
<a class="sourceLine" id="cb124-20" data-line-number="20">    <span class="dt">loss =</span> <span class="st">&quot;binary_crossentropy&quot;</span>,</a>
<a class="sourceLine" id="cb124-21" data-line-number="21">    <span class="dt">metrics =</span> <span class="kw">c</span>(<span class="st">&quot;accuracy&quot;</span>)</a>
<a class="sourceLine" id="cb124-22" data-line-number="22">  )</a>
<a class="sourceLine" id="cb124-23" data-line-number="23">  x_train_tbl &lt;-<span class="st"> </span><span class="kw">juice</span>(</a>
<a class="sourceLine" id="cb124-24" data-line-number="24">    rec,</a>
<a class="sourceLine" id="cb124-25" data-line-number="25">    <span class="kw">all_predictors</span>(),</a>
<a class="sourceLine" id="cb124-26" data-line-number="26">    <span class="dt">composition =</span> <span class="st">&quot;matrix&quot;</span></a>
<a class="sourceLine" id="cb124-27" data-line-number="27">  )</a>
<a class="sourceLine" id="cb124-28" data-line-number="28">  y_train_vec &lt;-<span class="st"> </span><span class="kw">juice</span>(rec, <span class="kw">all_outcomes</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-29" data-line-number="29"><span class="st">    </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb124-30" data-line-number="30">  <span class="kw">fit</span>(</a>
<a class="sourceLine" id="cb124-31" data-line-number="31">    <span class="dt">object =</span> model,</a>
<a class="sourceLine" id="cb124-32" data-line-number="32">    <span class="dt">x =</span> x_train_tbl,</a>
<a class="sourceLine" id="cb124-33" data-line-number="33">    <span class="dt">y =</span> y_train_vec,</a>
<a class="sourceLine" id="cb124-34" data-line-number="34">    <span class="dt">batch_size =</span> <span class="dv">32</span>,</a>
<a class="sourceLine" id="cb124-35" data-line-number="35">    <span class="dt">epochs =</span> <span class="dv">32</span>,</a>
<a class="sourceLine" id="cb124-36" data-line-number="36">    <span class="dt">validation_split =</span> <span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb124-37" data-line-number="37">    <span class="dt">verbose =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb124-38" data-line-number="38">  )</a>
<a class="sourceLine" id="cb124-39" data-line-number="39">  model</a>
<a class="sourceLine" id="cb124-40" data-line-number="40">}</a></code></pre></div>
<p>compare predictions against reality,</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">confusion_matrix &lt;-<span class="st"> </span><span class="cf">function</span>(data, rec, model) {</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">  testing_data &lt;-<span class="st"> </span><span class="kw">bake</span>(rec, <span class="kw">testing</span>(data))</a>
<a class="sourceLine" id="cb125-3" data-line-number="3">  x_test_tbl &lt;-<span class="st"> </span>testing_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-4" data-line-number="4"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>Churn) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-5" data-line-number="5"><span class="st">    </span><span class="kw">as.matrix</span>()</a>
<a class="sourceLine" id="cb125-6" data-line-number="6">  y_test_vec &lt;-<span class="st"> </span>testing_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-7" data-line-number="7"><span class="st">    </span><span class="kw">select</span>(Churn) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-8" data-line-number="8"><span class="st">    </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb125-9" data-line-number="9">  yhat_keras_class_vec &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-10" data-line-number="10"><span class="st">    </span><span class="kw">predict_classes</span>(x_test_tbl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-11" data-line-number="11"><span class="st">    </span><span class="kw">as.factor</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-12" data-line-number="12"><span class="st">    </span><span class="kw">fct_recode</span>(<span class="dt">yes =</span> <span class="st">&quot;1&quot;</span>, <span class="dt">no =</span> <span class="st">&quot;0&quot;</span>)</a>
<a class="sourceLine" id="cb125-13" data-line-number="13">  yhat_keras_prob_vec &lt;-</a>
<a class="sourceLine" id="cb125-14" data-line-number="14"><span class="st">    </span>model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-15" data-line-number="15"><span class="st">    </span><span class="kw">predict_proba</span>(x_test_tbl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-16" data-line-number="16"><span class="st">    </span><span class="kw">as.vector</span>()</a>
<a class="sourceLine" id="cb125-17" data-line-number="17">  test_truth &lt;-<span class="st"> </span>y_test_vec <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-18" data-line-number="18"><span class="st">    </span><span class="kw">as.factor</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-19" data-line-number="19"><span class="st">    </span><span class="kw">fct_recode</span>(<span class="dt">yes =</span> <span class="st">&quot;1&quot;</span>, <span class="dt">no =</span> <span class="st">&quot;0&quot;</span>)</a>
<a class="sourceLine" id="cb125-20" data-line-number="20">  estimates_keras_tbl &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb125-21" data-line-number="21">    <span class="dt">truth =</span> test_truth,</a>
<a class="sourceLine" id="cb125-22" data-line-number="22">    <span class="dt">estimate =</span> yhat_keras_class_vec,</a>
<a class="sourceLine" id="cb125-23" data-line-number="23">    <span class="dt">class_prob =</span> yhat_keras_prob_vec</a>
<a class="sourceLine" id="cb125-24" data-line-number="24">  )</a>
<a class="sourceLine" id="cb125-25" data-line-number="25">  estimates_keras_tbl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-26" data-line-number="26"><span class="st">    </span><span class="kw">conf_mat</span>(truth, estimate)</a>
<a class="sourceLine" id="cb125-27" data-line-number="27">}</a></code></pre></div>
<p>and compare the performance of multiple models.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1">compare_models &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb126-2" data-line-number="2">  name &lt;-<span class="st"> </span><span class="kw">match.call</span>()[<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-3" data-line-number="3"><span class="st">    </span><span class="kw">as.character</span>()</a>
<a class="sourceLine" id="cb126-4" data-line-number="4">  df &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="kw">list</span>(...), summary) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-5" data-line-number="5"><span class="st">    </span><span class="kw">filter</span>(.metric <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;sens&quot;</span>, <span class="st">&quot;spec&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-6" data-line-number="6"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">rep</span>(name, <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(name))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-7" data-line-number="7"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">metric =</span> .metric, <span class="dt">estimate =</span> .estimate)</a>
<a class="sourceLine" id="cb126-8" data-line-number="8">  <span class="kw">ggplot</span>(df) <span class="op">+</span></a>
<a class="sourceLine" id="cb126-9" data-line-number="9"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> metric, <span class="dt">y =</span> estimate, <span class="dt">color =</span> name, <span class="dt">group =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb126-10" data-line-number="10"><span class="st">    </span><span class="kw">theme_gray</span>(<span class="dv">24</span>)</a>
<a class="sourceLine" id="cb126-11" data-line-number="11">}</a></code></pre></div>
</div>
<div id="plan" class="section level2">
<h2><span class="header-section-number">9.3</span> Plan</h2>
<p>Next, we define our workflow in a <a href="https://books.ropensci.org/drake/plans.html"><code>drake</code> plan</a>. We will prepare the data, train different models with different activation functions, and compare the models in terms of performance.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">activations &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;relu&quot;</span>, <span class="st">&quot;sigmoid&quot;</span>)</a>
<a class="sourceLine" id="cb127-2" data-line-number="2"></a>
<a class="sourceLine" id="cb127-3" data-line-number="3">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb127-4" data-line-number="4">  <span class="dt">data =</span> <span class="kw">read_csv</span>(<span class="kw">file_in</span>(<span class="st">&quot;customer_churn.csv&quot;</span>), <span class="dt">col_types =</span> <span class="kw">cols</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-5" data-line-number="5"><span class="st">    </span><span class="kw">initial_split</span>(<span class="dt">prop =</span> <span class="fl">0.3</span>),</a>
<a class="sourceLine" id="cb127-6" data-line-number="6">  <span class="dt">rec =</span> <span class="kw">prepare_recipe</span>(data),</a>
<a class="sourceLine" id="cb127-7" data-line-number="7">  <span class="dt">model =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb127-8" data-line-number="8">    <span class="kw">train_model</span>(rec, <span class="dt">act1 =</span> act),</a>
<a class="sourceLine" id="cb127-9" data-line-number="9">    <span class="dt">format =</span> <span class="st">&quot;keras&quot;</span>, <span class="co"># Supported in drake &gt; 7.5.2 to store models properly.</span></a>
<a class="sourceLine" id="cb127-10" data-line-number="10">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">act =</span> <span class="op">!!</span>activations)</a>
<a class="sourceLine" id="cb127-11" data-line-number="11">  ),</a>
<a class="sourceLine" id="cb127-12" data-line-number="12">  <span class="dt">conf =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb127-13" data-line-number="13">    <span class="kw">confusion_matrix</span>(data, rec, model),</a>
<a class="sourceLine" id="cb127-14" data-line-number="14">    <span class="dt">transform =</span> <span class="kw">map</span>(model, <span class="dt">.id =</span> act)</a>
<a class="sourceLine" id="cb127-15" data-line-number="15">  ),</a>
<a class="sourceLine" id="cb127-16" data-line-number="16">  <span class="dt">metrics =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb127-17" data-line-number="17">    <span class="kw">compare_models</span>(conf),</a>
<a class="sourceLine" id="cb127-18" data-line-number="18">    <span class="dt">transform =</span> <span class="kw">combine</span>(conf)</a>
<a class="sourceLine" id="cb127-19" data-line-number="19">  )</a>
<a class="sourceLine" id="cb127-20" data-line-number="20">)</a></code></pre></div>
<p>The plan is a data frame with the steps we are going to do.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1">plan</a>
<a class="sourceLine" id="cb128-2" data-line-number="2"><span class="co">#&gt; # A tibble: 7 x 3</span></a>
<a class="sourceLine" id="cb128-3" data-line-number="3"><span class="co">#&gt;   target       command                                                    format</span></a>
<a class="sourceLine" id="cb128-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;        &lt;expr&gt;                                                     &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb128-5" data-line-number="5"><span class="co">#&gt; 1 data         read_csv(file_in(&quot;customer_churn.csv&quot;), col_types = cols(… &lt;NA&gt;  </span></a>
<a class="sourceLine" id="cb128-6" data-line-number="6"><span class="co">#&gt; 2 rec          prepare_recipe(data)                                     … &lt;NA&gt;  </span></a>
<a class="sourceLine" id="cb128-7" data-line-number="7"><span class="co">#&gt; 3 model_relu   train_model(rec, act1 = &quot;relu&quot;)                          … keras </span></a>
<a class="sourceLine" id="cb128-8" data-line-number="8"><span class="co">#&gt; 4 model_sigmo… train_model(rec, act1 = &quot;sigmoid&quot;)                       … keras </span></a>
<a class="sourceLine" id="cb128-9" data-line-number="9"><span class="co">#&gt; 5 conf_relu    confusion_matrix(data, rec, model_relu)                  … &lt;NA&gt;  </span></a>
<a class="sourceLine" id="cb128-10" data-line-number="10"><span class="co">#&gt; 6 conf_sigmoid confusion_matrix(data, rec, model_sigmoid)               … &lt;NA&gt;  </span></a>
<a class="sourceLine" id="cb128-11" data-line-number="11"><span class="co">#&gt; 7 metrics      compare_models(conf_relu, conf_sigmoid)                  … &lt;NA&gt;</span></a></code></pre></div>
</div>
<div id="dependency-graph" class="section level2">
<h2><span class="header-section-number">9.4</span> Dependency graph</h2>
<p>The graph visualizes the dependency relationships among the steps of the workflow.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb129-2" data-line-number="2"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-da4198830feeec77f806" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-da4198830feeec77f806">{"x":{"nodes":{"id":["confusion_matrix","p-MN2XG5DPNVSXEX3DNB2XE3ROMNZXM","prepare_recipe","compare_models","define_model","data","train_model","rec","model_relu","model_sigmoid","conf_relu","conf_sigmoid","metrics"],"imported":[true,true,true,true,true,false,true,false,false,false,false,false,false],"label":["confusion_matrix","file customer_churn.csv","prepare_recipe","compare_models","define_model","data","train_model","rec","model_relu","model_sigmoid","conf_relu","conf_sigmoid","metrics"],"status":["imported","imported","imported","imported","imported","outdated","imported","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["function","file","function","function","function","object","function","object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#000000","#1874CD","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["triangle","square","triangle","triangle","triangle","dot","triangle","dot","dot","dot","dot","dot","dot"],"level":[1,1,1,1,1,2,2,3,4,4,5,5,6],"x":[-1,-1,-1,-1,-1,-0.6,-0.6,-0.2,0.2,0.2,0.6,0.6,1],"y":[-1,-0.5,2.22044604925031e-16,0.5,1,-0.5,0.5,2.22044604925031e-16,-0.5,0.5,-0.5,0.5,2.22044604925031e-16]},"edges":{"from":["model_relu","rec","rec","rec","rec","confusion_matrix","confusion_matrix","data","data","data","p-MN2XG5DPNVSXEX3DNB2XE3ROMNZXM","train_model","train_model","prepare_recipe","compare_models","define_model","model_sigmoid","conf_sigmoid","conf_relu"],"to":["conf_relu","model_relu","model_sigmoid","conf_sigmoid","conf_relu","conf_sigmoid","conf_relu","rec","conf_sigmoid","conf_relu","data","model_relu","model_sigmoid","rec","metrics","train_model","conf_sigmoid","metrics","metrics"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","File"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,5,7,9,10]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="run-the-models" class="section level2">
<h2><span class="header-section-number">9.5</span> Run the models</h2>
<p>Call <a href="https://docs.ropensci.org/drake/reference/make.html"><code>make()</code></a> to actually run the workflow.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb130-2" data-line-number="2"><span class="co">#&gt; target data</span></a>
<a class="sourceLine" id="cb130-3" data-line-number="3"><span class="co">#&gt; target rec</span></a>
<a class="sourceLine" id="cb130-4" data-line-number="4"><span class="co">#&gt; target model_relu</span></a>
<a class="sourceLine" id="cb130-5" data-line-number="5"><span class="co">#&gt; target model_sigmoid</span></a>
<a class="sourceLine" id="cb130-6" data-line-number="6"><span class="co">#&gt; target conf_relu</span></a>
<a class="sourceLine" id="cb130-7" data-line-number="7"><span class="co">#&gt; target conf_sigmoid</span></a>
<a class="sourceLine" id="cb130-8" data-line-number="8"><span class="co">#&gt; target metrics</span></a></code></pre></div>
</div>
<div id="inspect-the-results" class="section level2">
<h2><span class="header-section-number">9.6</span> Inspect the results</h2>
<p>The two models performed about the same.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="kw">readd</span>(metrics) <span class="co"># see also loadd()</span></a></code></pre></div>
<p><img src="drake-manual_files/figure-html/unnamed-chunk-138-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="add-models" class="section level2">
<h2><span class="header-section-number">9.7</span> Add models</h2>
<p>Let’s try the softmax activation function.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">activations &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;relu&quot;</span>, <span class="st">&quot;sigmoid&quot;</span>, <span class="st">&quot;softmax&quot;</span>)</a>
<a class="sourceLine" id="cb132-2" data-line-number="2"></a>
<a class="sourceLine" id="cb132-3" data-line-number="3">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb132-4" data-line-number="4">  <span class="dt">data =</span> <span class="kw">read_csv</span>(<span class="kw">file_in</span>(<span class="st">&quot;customer_churn.csv&quot;</span>), <span class="dt">col_types =</span> <span class="kw">cols</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-5" data-line-number="5"><span class="st">    </span><span class="kw">initial_split</span>(<span class="dt">prop =</span> <span class="fl">0.3</span>),</a>
<a class="sourceLine" id="cb132-6" data-line-number="6">  <span class="dt">rec =</span> <span class="kw">prepare_recipe</span>(data),</a>
<a class="sourceLine" id="cb132-7" data-line-number="7">  <span class="dt">model =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb132-8" data-line-number="8">    <span class="kw">train_model</span>(rec, <span class="dt">act1 =</span> act),</a>
<a class="sourceLine" id="cb132-9" data-line-number="9">    <span class="dt">format =</span> <span class="st">&quot;keras&quot;</span>, <span class="co"># Supported in drake &gt; 7.5.2 to store models properly.</span></a>
<a class="sourceLine" id="cb132-10" data-line-number="10">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">act =</span> <span class="op">!!</span>activations)</a>
<a class="sourceLine" id="cb132-11" data-line-number="11">  ),</a>
<a class="sourceLine" id="cb132-12" data-line-number="12">  <span class="dt">conf =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb132-13" data-line-number="13">    <span class="kw">confusion_matrix</span>(data, rec, model),</a>
<a class="sourceLine" id="cb132-14" data-line-number="14">    <span class="dt">transform =</span> <span class="kw">map</span>(model, <span class="dt">.id =</span> act)</a>
<a class="sourceLine" id="cb132-15" data-line-number="15">  ),</a>
<a class="sourceLine" id="cb132-16" data-line-number="16">  <span class="dt">metrics =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb132-17" data-line-number="17">    <span class="kw">compare_models</span>(conf),</a>
<a class="sourceLine" id="cb132-18" data-line-number="18">    <span class="dt">transform =</span> <span class="kw">combine</span>(conf)</a>
<a class="sourceLine" id="cb132-19" data-line-number="19">  )</a>
<a class="sourceLine" id="cb132-20" data-line-number="20">)</a></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="kw">vis_drake_graph</span>(config) <span class="co"># see also outdated() and predict_runtime()</span></a></code></pre></div>
<div id="htmlwidget-c8516da0fd67d2a7be16" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-c8516da0fd67d2a7be16">{"x":{"nodes":{"id":["prepare_recipe","confusion_matrix","define_model","p-MN2XG5DPNVSXEX3DNB2XE3ROMNZXM","compare_models","train_model","data","rec","model_relu","model_softmax","model_sigmoid","conf_relu","conf_softmax","conf_sigmoid","metrics"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false,false,false,false],"label":["prepare_recipe","confusion_matrix","define_model","file customer_churn.csv","compare_models","train_model","data\n0.186s","rec\n0.406s","model_relu\n7.88s","model_softmax","model_sigmoid\n5.793s","conf_relu\n0.882s","conf_softmax","conf_sigmoid\n0.494s","metrics\n0.057s"],"status":["imported","imported","imported","imported","imported","imported","up to date","up to date","up to date","outdated","up to date","up to date","outdated","up to date","outdated"],"type":["function","function","function","file","function","function","object","object","object","object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#228B22","#228B22","#228B22","#000000","#228B22","#228B22","#000000","#228B22","#000000"],"shape":["triangle","triangle","triangle","square","triangle","triangle","dot","dot","dot","dot","dot","dot","dot","dot","dot"],"level":[1,1,1,1,1,2,2,3,4,4,4,5,5,5,6],"x":[-1,-1,-1,-1,-1,-0.6,-0.6,-0.2,0.2,0.2,0.2,0.6,0.6,0.6,1],"y":[-1,-0.5,2.22044604925031e-16,0.5,1,-0.5,0.5,2.22044604925031e-16,-0.75,2.22044604925031e-16,0.75,-0.75,2.22044604925031e-16,0.75,2.22044604925031e-16]},"edges":{"from":["prepare_recipe","data","data","data","data","train_model","train_model","train_model","rec","rec","rec","rec","rec","rec","model_relu","confusion_matrix","confusion_matrix","confusion_matrix","define_model","model_softmax","p-MN2XG5DPNVSXEX3DNB2XE3ROMNZXM","model_sigmoid","conf_sigmoid","compare_models","conf_relu","conf_softmax"],"to":["rec","rec","conf_sigmoid","conf_relu","conf_softmax","model_relu","model_softmax","model_sigmoid","model_relu","model_softmax","model_sigmoid","conf_sigmoid","conf_relu","conf_softmax","conf_relu","conf_sigmoid","conf_relu","conf_softmax","train_model","conf_softmax","data","conf_sigmoid","metrics","metrics","metrics","metrics"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","Imported","Object","Function","File"],"color":["#228B22","#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black","black"],"font.size":[20,20,20,20,20,20],"id":[1,2,5,7,9,10]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
<p><a href="https://docs.ropensci.org/drake/reference/make.html"><code>make()</code></a> skips the relu and sigmoid models because they are already up to date. (Their dependencies did not change.) Only the softmax model needs to run.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="co">#&gt; target model_softmax</span></a>
<a class="sourceLine" id="cb134-3" data-line-number="3"><span class="co">#&gt; target conf_softmax</span></a>
<a class="sourceLine" id="cb134-4" data-line-number="4"><span class="co">#&gt; target metrics</span></a></code></pre></div>
</div>
<div id="inspect-the-results-again" class="section level2">
<h2><span class="header-section-number">9.8</span> Inspect the results again</h2>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw">readd</span>(metrics) <span class="co"># see also loadd()</span></a></code></pre></div>
<p><img src="drake-manual_files/figure-html/unnamed-chunk-142-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="update-your-code" class="section level2">
<h2><span class="header-section-number">9.9</span> Update your code</h2>
<p>If you change upstream functions, even nested ones, <code>drake</code> automatically refits the affected models. Let’s increase dropout in both layers.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1">define_model &lt;-<span class="st"> </span><span class="cf">function</span>(rec, units1, units2, act1, act2, act3) {</a>
<a class="sourceLine" id="cb136-2" data-line-number="2">  input_shape &lt;-<span class="st"> </span><span class="kw">ncol</span>(</a>
<a class="sourceLine" id="cb136-3" data-line-number="3">    <span class="kw">juice</span>(rec, <span class="kw">all_predictors</span>(), <span class="dt">composition =</span> <span class="st">&quot;matrix&quot;</span>)</a>
<a class="sourceLine" id="cb136-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb136-5" data-line-number="5">  <span class="kw">keras_model_sequential</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-6" data-line-number="6"><span class="st">    </span><span class="kw">layer_dense</span>(</a>
<a class="sourceLine" id="cb136-7" data-line-number="7">      <span class="dt">units =</span> units1,</a>
<a class="sourceLine" id="cb136-8" data-line-number="8">      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</a>
<a class="sourceLine" id="cb136-9" data-line-number="9">      <span class="dt">activation =</span> act1,</a>
<a class="sourceLine" id="cb136-10" data-line-number="10">      <span class="dt">input_shape =</span> input_shape</a>
<a class="sourceLine" id="cb136-11" data-line-number="11">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-12" data-line-number="12"><span class="st">    </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span> <span class="fl">0.15</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Changed from 0.1 to 0.15.</span></a>
<a class="sourceLine" id="cb136-13" data-line-number="13"><span class="st">    </span><span class="kw">layer_dense</span>(</a>
<a class="sourceLine" id="cb136-14" data-line-number="14">      <span class="dt">units =</span> units2,</a>
<a class="sourceLine" id="cb136-15" data-line-number="15">      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</a>
<a class="sourceLine" id="cb136-16" data-line-number="16">      <span class="dt">activation =</span> act2</a>
<a class="sourceLine" id="cb136-17" data-line-number="17">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-18" data-line-number="18"><span class="st">    </span><span class="kw">layer_dropout</span>(<span class="dt">rate =</span> <span class="fl">0.15</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Changed from 0.1 to 0.15.</span></a>
<a class="sourceLine" id="cb136-19" data-line-number="19"><span class="st">    </span><span class="kw">layer_dense</span>(</a>
<a class="sourceLine" id="cb136-20" data-line-number="20">      <span class="dt">units =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb136-21" data-line-number="21">      <span class="dt">kernel_initializer =</span> <span class="st">&quot;uniform&quot;</span>,</a>
<a class="sourceLine" id="cb136-22" data-line-number="22">      <span class="dt">activation =</span> act3</a>
<a class="sourceLine" id="cb136-23" data-line-number="23">    )</a>
<a class="sourceLine" id="cb136-24" data-line-number="24">}</a></code></pre></div>
<p>All the models and downstream results are affected.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb137-2" data-line-number="2"><span class="co">#&gt; target model_relu</span></a>
<a class="sourceLine" id="cb137-3" data-line-number="3"><span class="co">#&gt; target model_softmax</span></a>
<a class="sourceLine" id="cb137-4" data-line-number="4"><span class="co">#&gt; target model_sigmoid</span></a>
<a class="sourceLine" id="cb137-5" data-line-number="5"><span class="co">#&gt; target conf_relu</span></a>
<a class="sourceLine" id="cb137-6" data-line-number="6"><span class="co">#&gt; target conf_softmax</span></a>
<a class="sourceLine" id="cb137-7" data-line-number="7"><span class="co">#&gt; target conf_sigmoid</span></a>
<a class="sourceLine" id="cb137-8" data-line-number="8"><span class="co">#&gt; target metrics</span></a></code></pre></div>
</div>
<div id="history-and-provenance-1" class="section level2">
<h2><span class="header-section-number">9.10</span> History and provenance</h2>
<p><code>drake</code> version 7.5.0 and above tracks history and provenance. You can see which models you ran, when you ran them, how long they took, and which settings you tried (i.e. named arguments to function calls in your commands).</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1">history &lt;-<span class="st"> </span><span class="kw">drake_history</span>()</a>
<a class="sourceLine" id="cb138-2" data-line-number="2">history</a>
<a class="sourceLine" id="cb138-3" data-line-number="3"><span class="co">#&gt; # A tibble: 17 x 10</span></a>
<a class="sourceLine" id="cb138-4" data-line-number="4"><span class="co">#&gt;    target  current built    exists hash  command        seed runtime  prop act1 </span></a>
<a class="sourceLine" id="cb138-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt;   &lt;lgl&gt;   &lt;chr&gt;    &lt;lgl&gt;  &lt;chr&gt; &lt;chr&gt;         &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb138-6" data-line-number="6"><span class="co">#&gt;  1 conf_r… FALSE   2019-12… TRUE   16dd… confusion_m… 4.05e8  0.877   NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-7" data-line-number="7"><span class="co">#&gt;  2 conf_r… TRUE    2019-12… TRUE   39f0… confusion_m… 4.05e8  0.501   NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-8" data-line-number="8"><span class="co">#&gt;  3 conf_s… FALSE   2019-12… TRUE   0cec… confusion_m… 1.93e9  0.49    NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-9" data-line-number="9"><span class="co">#&gt;  4 conf_s… TRUE    2019-12… TRUE   3641… confusion_m… 1.93e9  0.469   NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-10" data-line-number="10"><span class="co">#&gt;  5 conf_s… FALSE   2019-12… TRUE   3bce… confusion_m… 1.80e9  0.477   NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-11" data-line-number="11"><span class="co">#&gt;  6 conf_s… TRUE    2019-12… TRUE   3ea7… confusion_m… 1.80e9  0.782   NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-12" data-line-number="12"><span class="co">#&gt;  7 data    TRUE    2019-12… TRUE   ca84… &quot;read_csv(f… 1.29e9  0.123    0.3 &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-13" data-line-number="13"><span class="co">#&gt;  8 metrics FALSE   2019-12… TRUE   9362… compare_mod… 1.21e9  0.029   NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-14" data-line-number="14"><span class="co">#&gt;  9 metrics FALSE   2019-12… TRUE   50d5… compare_mod… 1.21e9  0.0420  NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-15" data-line-number="15"><span class="co">#&gt; 10 metrics TRUE    2019-12… TRUE   0caf… compare_mod… 1.21e9  0.03    NA   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb138-16" data-line-number="16"><span class="co">#&gt; 11 model_… FALSE   2019-12… TRUE   71f3… &quot;train_mode… 1.47e9  7.86    NA   relu </span></a>
<a class="sourceLine" id="cb138-17" data-line-number="17"><span class="co">#&gt; 12 model_… TRUE    2019-12… TRUE   22c8… &quot;train_mode… 1.47e9  5.93    NA   relu </span></a>
<a class="sourceLine" id="cb138-18" data-line-number="18"><span class="co">#&gt; 13 model_… FALSE   2019-12… TRUE   fff6… &quot;train_mode… 1.26e9  5.77    NA   sigm…</span></a>
<a class="sourceLine" id="cb138-19" data-line-number="19"><span class="co">#&gt; 14 model_… TRUE    2019-12… TRUE   8baa… &quot;train_mode… 1.26e9  5.92    NA   sigm…</span></a>
<a class="sourceLine" id="cb138-20" data-line-number="20"><span class="co">#&gt; 15 model_… FALSE   2019-12… TRUE   b65a… &quot;train_mode… 8.05e8  5.70    NA   soft…</span></a>
<a class="sourceLine" id="cb138-21" data-line-number="21"><span class="co">#&gt; 16 model_… TRUE    2019-12… TRUE   58e9… &quot;train_mode… 8.05e8  5.80    NA   soft…</span></a>
<a class="sourceLine" id="cb138-22" data-line-number="22"><span class="co">#&gt; 17 rec     TRUE    2019-12… TRUE   eae9… prepare_rec… 6.29e8  0.191   NA   &lt;NA&gt;</span></a></code></pre></div>
<p>And as long as you did not run <code>clean(garbage_collection = TRUE)</code>, you can get the old data back. Let’s find the oldest run of the relu model.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">hash &lt;-<span class="st"> </span>history <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(act1 <span class="op">==</span><span class="st"> &quot;relu&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-3" data-line-number="3"><span class="st">  </span><span class="kw">pull</span>(hash) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb139-5" data-line-number="5"><span class="kw">drake_cache</span>()<span class="op">$</span><span class="kw">get_value</span>(hash)</a>
<a class="sourceLine" id="cb139-6" data-line-number="6"><span class="co">#&gt; Model</span></a>
<a class="sourceLine" id="cb139-7" data-line-number="7"><span class="co">#&gt; Model: &quot;sequential&quot;</span></a>
<a class="sourceLine" id="cb139-8" data-line-number="8"><span class="co">#&gt; ________________________________________________________________________________</span></a>
<a class="sourceLine" id="cb139-9" data-line-number="9"><span class="co">#&gt; Layer (type)                        Output Shape                    Param #     </span></a>
<a class="sourceLine" id="cb139-10" data-line-number="10"><span class="co">#&gt; ================================================================================</span></a>
<a class="sourceLine" id="cb139-11" data-line-number="11"><span class="co">#&gt; dense (Dense)                       (None, 16)                      576         </span></a>
<a class="sourceLine" id="cb139-12" data-line-number="12"><span class="co">#&gt; ________________________________________________________________________________</span></a>
<a class="sourceLine" id="cb139-13" data-line-number="13"><span class="co">#&gt; dropout (Dropout)                   (None, 16)                      0           </span></a>
<a class="sourceLine" id="cb139-14" data-line-number="14"><span class="co">#&gt; ________________________________________________________________________________</span></a>
<a class="sourceLine" id="cb139-15" data-line-number="15"><span class="co">#&gt; dense_1 (Dense)                     (None, 16)                      272         </span></a>
<a class="sourceLine" id="cb139-16" data-line-number="16"><span class="co">#&gt; ________________________________________________________________________________</span></a>
<a class="sourceLine" id="cb139-17" data-line-number="17"><span class="co">#&gt; dropout_1 (Dropout)                 (None, 16)                      0           </span></a>
<a class="sourceLine" id="cb139-18" data-line-number="18"><span class="co">#&gt; ________________________________________________________________________________</span></a>
<a class="sourceLine" id="cb139-19" data-line-number="19"><span class="co">#&gt; dense_2 (Dense)                     (None, 1)                       17          </span></a>
<a class="sourceLine" id="cb139-20" data-line-number="20"><span class="co">#&gt; ================================================================================</span></a>
<a class="sourceLine" id="cb139-21" data-line-number="21"><span class="co">#&gt; Total params: 865</span></a>
<a class="sourceLine" id="cb139-22" data-line-number="22"><span class="co">#&gt; Trainable params: 865</span></a>
<a class="sourceLine" id="cb139-23" data-line-number="23"><span class="co">#&gt; Non-trainable params: 0</span></a>
<a class="sourceLine" id="cb139-24" data-line-number="24"><span class="co">#&gt; ________________________________________________________________________________</span></a></code></pre></div>

</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scripts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropensci-books/drake/edit/master/churn.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropensci-books/drake/commits/master/churn.Rmd",
"text": "Chapter edit history"
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
