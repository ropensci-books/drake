<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 An analysis of R package download trends | The drake R Package User Manual</title>
  <meta name="description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 An analysis of R package download trends | The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ropenscilabs.github.io/drake-manual" />
  <meta property="og:image" content="https://ropenscilabs.github.io/drake-manual/images/logo.png" />
  <meta property="og:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="github-repo" content="ropenscilabs/drake-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 An analysis of R package download trends | The drake R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="twitter:image" content="https://ropenscilabs.github.io/drake-manual/images/logo.png" />

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="churn.html"/>
<link rel="next" href="gsp.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.8/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="https://ropensci.github.io/dev_guide/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The drake R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#short-version"><i class="fa fa-check"></i><b>1.1</b> Short version</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#long-version"><i class="fa fa-check"></i><b>1.2</b> Long version</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.3</b> The drake R package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.4</b> Installation</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.5</b> Why drake?</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.5.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.5.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#scale-up-and-out."><i class="fa fa-check"></i><b>1.5.3</b> Scale up and out.</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#with-docker"><i class="fa fa-check"></i><b>1.6</b> With Docker</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.7</b> Documentation</a><ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.7.1</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.7.2</b> Function reference</a></li>
<li class="chapter" data-level="1.7.3" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.7.3</b> Tutorials</a></li>
<li class="chapter" data-level="1.7.4" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.7.4</b> Examples</a></li>
<li class="chapter" data-level="1.7.5" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.7.5</b> Presentations</a></li>
<li class="chapter" data-level="1.7.6" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.7.6</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.8</b> Help and troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="similar-work.html"><a href="similar-work.html"><i class="fa fa-check"></i><b>2</b> Similar work</a><ul>
<li class="chapter" data-level="2.1" data-path="similar-work.html"><a href="similar-work.html#pipeline-tools"><i class="fa fa-check"></i><b>2.1</b> Pipeline tools</a><ul>
<li class="chapter" data-level="2.1.1" data-path="similar-work.html"><a href="similar-work.html#gnu-make"><i class="fa fa-check"></i><b>2.1.1</b> GNU Make</a></li>
<li class="chapter" data-level="2.1.2" data-path="similar-work.html"><a href="similar-work.html#remake"><i class="fa fa-check"></i><b>2.1.2</b> Remake</a></li>
<li class="chapter" data-level="2.1.3" data-path="similar-work.html"><a href="similar-work.html#factuals-drake"><i class="fa fa-check"></i><b>2.1.3</b> Factual’s Drake</a></li>
<li class="chapter" data-level="2.1.4" data-path="similar-work.html"><a href="similar-work.html#other-pipeline-tools"><i class="fa fa-check"></i><b>2.1.4</b> Other pipeline tools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="similar-work.html"><a href="similar-work.html#memoization"><i class="fa fa-check"></i><b>2.2</b> Memoization</a></li>
<li class="chapter" data-level="2.3" data-path="similar-work.html"><a href="similar-work.html#literate-programming"><i class="fa fa-check"></i><b>2.3</b> Literate programming</a><ul>
<li class="chapter" data-level="2.3.1" data-path="similar-work.html"><a href="similar-work.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>2.3.1</b> knitr and R Markdown</a></li>
<li class="chapter" data-level="2.3.2" data-path="similar-work.html"><a href="similar-work.html#version-control"><i class="fa fa-check"></i><b>2.3.2</b> Version control</a></li>
<li class="chapter" data-level="2.3.3" data-path="similar-work.html"><a href="similar-work.html#containerization-and-r-package-environments"><i class="fa fa-check"></i><b>2.3.3</b> Containerization and R package environments</a></li>
<li class="chapter" data-level="2.3.4" data-path="similar-work.html"><a href="similar-work.html#workflowr"><i class="fa fa-check"></i><b>2.3.4</b> workflowr</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="similar-work.html"><a href="similar-work.html#acknowledgements"><i class="fa fa-check"></i><b>2.4</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="3" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>3</b> Walkthrough</a><ul>
<li class="chapter" data-level="3.1" data-path="walkthrough.html"><a href="walkthrough.html#set-the-stage."><i class="fa fa-check"></i><b>3.1</b> Set the stage.</a></li>
<li class="chapter" data-level="3.2" data-path="walkthrough.html"><a href="walkthrough.html#make-your-results."><i class="fa fa-check"></i><b>3.2</b> Make your results.</a></li>
<li class="chapter" data-level="3.3" data-path="walkthrough.html"><a href="walkthrough.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>3.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="3.4" data-path="walkthrough.html"><a href="walkthrough.html#history-and-provenance"><i class="fa fa-check"></i><b>3.4</b> History and provenance</a></li>
<li class="chapter" data-level="3.5" data-path="walkthrough.html"><a href="walkthrough.html#reproducible-data-recovery-and-renaming"><i class="fa fa-check"></i><b>3.5</b> Reproducible data recovery and renaming</a><ul>
<li class="chapter" data-level="3.5.1" data-path="walkthrough.html"><a href="walkthrough.html#undoing-clean"><i class="fa fa-check"></i><b>3.5.1</b> Undoing <code>clean()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="walkthrough.html"><a href="walkthrough.html#renaming"><i class="fa fa-check"></i><b>3.5.2</b> Renaming</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="walkthrough.html"><a href="walkthrough.html#try-the-code-yourself"><i class="fa fa-check"></i><b>3.6</b> Try the code yourself!</a></li>
<li class="chapter" data-level="3.7" data-path="walkthrough.html"><a href="walkthrough.html#thanks"><i class="fa fa-check"></i><b>3.7</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>4</b> <code>drake</code> plans</a><ul>
<li class="chapter" data-level="4.1" data-path="plans.html"><a href="plans.html#what-is-a-drake-plan"><i class="fa fa-check"></i><b>4.1</b> What is a <code>drake</code> plan?</a></li>
<li class="chapter" data-level="4.2" data-path="plans.html"><a href="plans.html#plans-are-similar-to-r-scripts."><i class="fa fa-check"></i><b>4.2</b> Plans are similar to R scripts.</a></li>
<li class="chapter" data-level="4.3" data-path="plans.html"><a href="plans.html#so-why-do-we-use-plans"><i class="fa fa-check"></i><b>4.3</b> So why do we use plans?</a><ul>
<li class="chapter" data-level="4.3.1" data-path="plans.html"><a href="plans.html#plans-chop-up-the-work-into-pieces."><i class="fa fa-check"></i><b>4.3.1</b> Plans chop up the work into pieces.</a></li>
<li class="chapter" data-level="4.3.2" data-path="plans.html"><a href="plans.html#drake-uses-plans-to-schedule-you-work."><i class="fa fa-check"></i><b>4.3.2</b> <code>drake</code> uses plans to schedule you work.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="plans.html"><a href="plans.html#special-custom-columns-in-your-plan"><i class="fa fa-check"></i><b>4.4</b> Special custom columns in your plan</a></li>
<li class="chapter" data-level="4.5" data-path="plans.html"><a href="plans.html#large-plans"><i class="fa fa-check"></i><b>4.5</b> Large plans</a><ul>
<li class="chapter" data-level="4.5.1" data-path="plans.html"><a href="plans.html#how-to-create-large-plans"><i class="fa fa-check"></i><b>4.5.1</b> How to create large plans</a></li>
<li class="chapter" data-level="4.5.2" data-path="plans.html"><a href="plans.html#start-small"><i class="fa fa-check"></i><b>4.5.2</b> Start small</a></li>
<li class="chapter" data-level="4.5.3" data-path="plans.html"><a href="plans.html#the-types-of-transformations"><i class="fa fa-check"></i><b>4.5.3</b> The types of transformations</a></li>
<li class="chapter" data-level="4.5.4" data-path="plans.html"><a href="plans.html#grouping-variables"><i class="fa fa-check"></i><b>4.5.4</b> Grouping variables</a></li>
<li class="chapter" data-level="4.5.5" data-path="plans.html"><a href="plans.html#tags"><i class="fa fa-check"></i><b>4.5.5</b> Tags</a></li>
<li class="chapter" data-level="4.5.6" data-path="plans.html"><a href="plans.html#target-names"><i class="fa fa-check"></i><b>4.5.6</b> Target names</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>5</b> <code>drake</code> projects</a><ul>
<li class="chapter" data-level="5.1" data-path="projects.html"><a href="projects.html#code-files"><i class="fa fa-check"></i><b>5.1</b> Code files</a></li>
<li class="chapter" data-level="5.2" data-path="projects.html"><a href="projects.html#safer-interactivity"><i class="fa fa-check"></i><b>5.2</b> Safer interactivity</a><ul>
<li class="chapter" data-level="5.2.1" data-path="projects.html"><a href="projects.html#motivation"><i class="fa fa-check"></i><b>5.2.1</b> Motivation</a></li>
<li class="chapter" data-level="5.2.2" data-path="projects.html"><a href="projects.html#usage"><i class="fa fa-check"></i><b>5.2.2</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="projects.html"><a href="projects.html#script-file-pitfalls"><i class="fa fa-check"></i><b>5.3</b> Script file pitfalls</a></li>
<li class="chapter" data-level="5.4" data-path="projects.html"><a href="projects.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>5.4</b> Workflows as R packages</a></li>
<li class="chapter" data-level="5.5" data-path="projects.html"><a href="projects.html#other-tools"><i class="fa fa-check"></i><b>5.5</b> Other tools</a></li>
</ul></li>
<li class="part"><span><b>II Examples</b></span></li>
<li class="chapter" data-level="6" data-path="churn.html"><a href="churn.html"><i class="fa fa-check"></i><b>6</b> Customer churn and deep learning</a><ul>
<li class="chapter" data-level="6.1" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>6.1</b> Packages</a></li>
<li class="chapter" data-level="6.2" data-path="churn.html"><a href="churn.html#functions"><i class="fa fa-check"></i><b>6.2</b> Functions</a></li>
<li class="chapter" data-level="6.3" data-path="churn.html"><a href="churn.html#plan"><i class="fa fa-check"></i><b>6.3</b> Plan</a></li>
<li class="chapter" data-level="6.4" data-path="churn.html"><a href="churn.html#dependency-graph"><i class="fa fa-check"></i><b>6.4</b> Dependency graph</a></li>
<li class="chapter" data-level="6.5" data-path="churn.html"><a href="churn.html#run-the-models"><i class="fa fa-check"></i><b>6.5</b> Run the models</a></li>
<li class="chapter" data-level="6.6" data-path="churn.html"><a href="churn.html#inspect-the-results"><i class="fa fa-check"></i><b>6.6</b> Inspect the results</a></li>
<li class="chapter" data-level="6.7" data-path="churn.html"><a href="churn.html#add-models"><i class="fa fa-check"></i><b>6.7</b> Add models</a></li>
<li class="chapter" data-level="6.8" data-path="churn.html"><a href="churn.html#inspect-the-results-again"><i class="fa fa-check"></i><b>6.8</b> Inspect the results again</a></li>
<li class="chapter" data-level="6.9" data-path="churn.html"><a href="churn.html#update-your-code"><i class="fa fa-check"></i><b>6.9</b> Update your code</a></li>
<li class="chapter" data-level="6.10" data-path="churn.html"><a href="churn.html#history-and-provenance-1"><i class="fa fa-check"></i><b>6.10</b> History and provenance</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>7</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="7.1" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>7.1</b> Get the code.</a></li>
<li class="chapter" data-level="7.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>7.2</b> Overview</a></li>
<li class="chapter" data-level="7.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>7.3</b> Analysis</a></li>
<li class="chapter" data-level="7.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>7.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>8</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="8.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>8.1</b> Get the code.</a></li>
<li class="chapter" data-level="8.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>8.2</b> Objective and methods</a></li>
<li class="chapter" data-level="8.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>8.3</b> Data</a></li>
<li class="chapter" data-level="8.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>8.4</b> Analysis</a></li>
<li class="chapter" data-level="8.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>8.5</b> Results</a></li>
<li class="chapter" data-level="8.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>8.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="8.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>8.7</b> References</a></li>
</ul></li>
<li class="part"><span><b>III Resource management</b></span></li>
<li class="chapter" data-level="9" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>9</b> High-performance computing</a><ul>
<li class="chapter" data-level="9.1" data-path="hpc.html"><a href="hpc.html#start-small-1"><i class="fa fa-check"></i><b>9.1</b> Start small</a></li>
<li class="chapter" data-level="9.2" data-path="hpc.html"><a href="hpc.html#let-make-schedule-your-targets."><i class="fa fa-check"></i><b>9.2</b> Let <code>make()</code> schedule your targets.</a></li>
<li class="chapter" data-level="9.3" data-path="hpc.html"><a href="hpc.html#the-master-process"><i class="fa fa-check"></i><b>9.3</b> The master process</a><ul>
<li class="chapter" data-level="9.3.1" data-path="hpc.html"><a href="hpc.html#master-on-a-cluster"><i class="fa fa-check"></i><b>9.3.1</b> Master on a cluster</a></li>
<li class="chapter" data-level="9.3.2" data-path="hpc.html"><a href="hpc.html#local-master"><i class="fa fa-check"></i><b>9.3.2</b> Local master</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>9.4</b> Parallel backends</a></li>
<li class="chapter" data-level="9.5" data-path="hpc.html"><a href="hpc.html#the-clustermq-backend"><i class="fa fa-check"></i><b>9.5</b> The <code>clustermq</code> backend</a><ul>
<li class="chapter" data-level="9.5.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>9.5.1</b> Persistent workers</a></li>
<li class="chapter" data-level="9.5.2" data-path="hpc.html"><a href="hpc.html#installation-1"><i class="fa fa-check"></i><b>9.5.2</b> Installation</a></li>
<li class="chapter" data-level="9.5.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine"><i class="fa fa-check"></i><b>9.5.3</b> On your local machine</a></li>
<li class="chapter" data-level="9.5.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster"><i class="fa fa-check"></i><b>9.5.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="hpc.html"><a href="hpc.html#the-future-backend"><i class="fa fa-check"></i><b>9.6</b> The <code>future</code> backend</a><ul>
<li class="chapter" data-level="9.6.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>9.6.1</b> Transient workers</a></li>
<li class="chapter" data-level="9.6.2" data-path="hpc.html"><a href="hpc.html#installation-2"><i class="fa fa-check"></i><b>9.6.2</b> Installation</a></li>
<li class="chapter" data-level="9.6.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine-1"><i class="fa fa-check"></i><b>9.6.3</b> On your local machine</a></li>
<li class="chapter" data-level="9.6.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster-1"><i class="fa fa-check"></i><b>9.6.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="hpc.html"><a href="hpc.html#advanced-options"><i class="fa fa-check"></i><b>9.7</b> Advanced options</a><ul>
<li class="chapter" data-level="9.7.1" data-path="hpc.html"><a href="hpc.html#selectivity"><i class="fa fa-check"></i><b>9.7.1</b> Selectivity</a></li>
<li class="chapter" data-level="9.7.2" data-path="hpc.html"><a href="hpc.html#memory-options"><i class="fa fa-check"></i><b>9.7.2</b> Memory options</a></li>
<li class="chapter" data-level="9.7.3" data-path="hpc.html"><a href="hpc.html#storage-options"><i class="fa fa-check"></i><b>9.7.3</b> Storage options</a></li>
<li class="chapter" data-level="9.7.4" data-path="hpc.html"><a href="hpc.html#the-template-argument-for-persistent-workers"><i class="fa fa-check"></i><b>9.7.4</b> The <code>template</code> argument for persistent workers</a></li>
<li class="chapter" data-level="9.7.5" data-path="hpc.html"><a href="hpc.html#the-resources-column-for-transient-workers"><i class="fa fa-check"></i><b>9.7.5</b> The <code>resources</code> column for transient workers</a></li>
<li class="chapter" data-level="9.7.6" data-path="hpc.html"><a href="hpc.html#parallel-computing-within-targets"><i class="fa fa-check"></i><b>9.7.6</b> Parallel computing <em>within</em> targets</a></li>
<li class="chapter" data-level="9.7.7" data-path="hpc.html"><a href="hpc.html#custom-job-schedulers"><i class="fa fa-check"></i><b>9.7.7</b> Custom job schedulers</a></li>
<li class="chapter" data-level="9.7.8" data-path="hpc.html"><a href="hpc.html#hasty-mode"><i class="fa fa-check"></i><b>9.7.8</b> Hasty mode</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>10</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="10.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>10.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="10.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>10.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>11</b> Memory management</a><ul>
<li class="chapter" data-level="11.1" data-path="memory.html"><a href="memory.html#garbage-collection-and-custom-files"><i class="fa fa-check"></i><b>11.1</b> Garbage collection and custom files</a></li>
<li class="chapter" data-level="11.2" data-path="memory.html"><a href="memory.html#memory-strategies"><i class="fa fa-check"></i><b>11.2</b> Memory strategies</a></li>
<li class="chapter" data-level="11.3" data-path="memory.html"><a href="memory.html#data-splitting"><i class="fa fa-check"></i><b>11.3</b> Data splitting</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="storage.html"><a href="storage.html"><i class="fa fa-check"></i><b>12</b> Storage</a><ul>
<li class="chapter" data-level="12.1" data-path="storage.html"><a href="storage.html#cache-formats"><i class="fa fa-check"></i><b>12.1</b> Cache formats</a><ul>
<li class="chapter" data-level="12.1.1" data-path="storage.html"><a href="storage.html#rds-caches"><i class="fa fa-check"></i><b>12.1.1</b> RDS caches</a></li>
<li class="chapter" data-level="12.1.2" data-path="storage.html"><a href="storage.html#database-caches"><i class="fa fa-check"></i><b>12.1.2</b> Database caches</a></li>
<li class="chapter" data-level="12.1.3" data-path="storage.html"><a href="storage.html#environment-caches"><i class="fa fa-check"></i><b>12.1.3</b> Environment caches</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="storage.html"><a href="storage.html#hash-algorithms"><i class="fa fa-check"></i><b>12.2</b> Hash algorithms</a></li>
</ul></li>
<li class="part"><span><b>IV Extra features</b></span></li>
<li class="chapter" data-level="13" data-path="visuals.html"><a href="visuals.html"><i class="fa fa-check"></i><b>13</b> Visualization with drake</a><ul>
<li class="chapter" data-level="13.0.1" data-path="visuals.html"><a href="visuals.html#vis_drake_graph"><i class="fa fa-check"></i><b>13.0.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="13.0.2" data-path="visuals.html"><a href="visuals.html#sankey_drake_graph"><i class="fa fa-check"></i><b>13.0.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="13.0.3" data-path="visuals.html"><a href="visuals.html#drake_ggraph"><i class="fa fa-check"></i><b>13.0.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="13.0.4" data-path="visuals.html"><a href="visuals.html#text_drake_graph"><i class="fa fa-check"></i><b>13.0.4</b> <code>text_drake_graph()</code></a></li>
<li class="chapter" data-level="13.1" data-path="visuals.html"><a href="visuals.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>13.1</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="13.2" data-path="visuals.html"><a href="visuals.html#visualizing-target-status"><i class="fa fa-check"></i><b>13.2</b> Visualizing target status</a></li>
<li class="chapter" data-level="13.3" data-path="visuals.html"><a href="visuals.html#subgraphs"><i class="fa fa-check"></i><b>13.3</b> Subgraphs</a></li>
<li class="chapter" data-level="13.4" data-path="visuals.html"><a href="visuals.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>13.4</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="13.5" data-path="visuals.html"><a href="visuals.html#clusters"><i class="fa fa-check"></i><b>13.5</b> Clusters</a></li>
<li class="chapter" data-level="13.6" data-path="visuals.html"><a href="visuals.html#output-files"><i class="fa fa-check"></i><b>13.6</b> Output files</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>14</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="14.0.1" data-path="debugging.html"><a href="debugging.html#start-small-2"><i class="fa fa-check"></i><b>14.0.1</b> Start small</a></li>
<li class="chapter" data-level="14.1" data-path="debugging.html"><a href="debugging.html#dependencies"><i class="fa fa-check"></i><b>14.1</b> Dependencies</a><ul>
<li class="chapter" data-level="14.1.1" data-path="debugging.html"><a href="debugging.html#visualize-your-dependency-graph."><i class="fa fa-check"></i><b>14.1.1</b> Visualize your dependency graph.</a></li>
<li class="chapter" data-level="14.1.2" data-path="debugging.html"><a href="debugging.html#check-specific-dependency-information."><i class="fa fa-check"></i><b>14.1.2</b> Check specific dependency information.</a></li>
<li class="chapter" data-level="14.1.3" data-path="debugging.html"><a href="debugging.html#outdated-targets-and-missing-dependencies"><i class="fa fa-check"></i><b>14.1.3</b> Outdated targets and missing dependencies</a></li>
<li class="chapter" data-level="14.1.4" data-path="debugging.html"><a href="debugging.html#but-why-are-my-targets-out-of-date"><i class="fa fa-check"></i><b>14.1.4</b> But <em>why</em> are my targets out of date?</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="debugging.html"><a href="debugging.html#diagnose-failures."><i class="fa fa-check"></i><b>14.2</b> Diagnose failures.</a></li>
<li class="chapter" data-level="14.3" data-path="debugging.html"><a href="debugging.html#timeouts-and-retries"><i class="fa fa-check"></i><b>14.3</b> Timeouts and retries</a></li>
<li class="chapter" data-level="14.4" data-path="debugging.html"><a href="debugging.html#more-help"><i class="fa fa-check"></i><b>14.4</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>15</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="15.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>15.1</b> What are triggers?</a></li>
<li class="chapter" data-level="15.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>15.2</b> Customization</a></li>
<li class="chapter" data-level="15.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>15.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="15.4" data-path="triggers.html"><a href="triggers.html#consider-hasty-mode"><i class="fa fa-check"></i><b>15.4</b> Consider hasty mode</a></li>
<li class="chapter" data-level="15.5" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>15.5</b> A more practical example</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>B</b> Cautionary notes</a><ul>
<li class="chapter" data-level="B.1" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>B.1</b> Workflow plans</a><ul>
<li class="chapter" data-level="B.1.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>B.1.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="B.1.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>B.1.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>B.2</b> Execution</a><ul>
<li class="chapter" data-level="B.2.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>B.2.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="B.2.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>B.2.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="B.2.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>B.2.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="B.2.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>B.2.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="B.2.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>B.2.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="B.2.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>B.2.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="B.2.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>B.2.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="B.2.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>B.2.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="caution.html"><a href="caution.html#dependencies-1"><i class="fa fa-check"></i><b>B.3</b> Dependencies</a><ul>
<li class="chapter" data-level="B.3.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-rebuild-too-often"><i class="fa fa-check"></i><b>B.3.1</b> Objects that contain functions may rebuild too often</a></li>
<li class="chapter" data-level="B.3.2" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>B.3.2</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="B.3.3" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>B.3.3</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="B.3.4" data-path="caution.html"><a href="caution.html#s3-and-generic-methods"><i class="fa fa-check"></i><b>B.3.4</b> S3 and generic methods</a></li>
<li class="chapter" data-level="B.3.5" data-path="caution.html"><a href="caution.html#file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>B.3.5</b> File outputs in imported functions.</a></li>
<li class="chapter" data-level="B.3.6" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>B.3.6</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="B.3.7" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.7</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.8" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.8</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.9" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>B.3.9</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>B.4</b> High-performance computing</a><ul>
<li class="chapter" data-level="B.4.1" data-path="caution.html"><a href="caution.html#calling-mclapply-within-targets"><i class="fa fa-check"></i><b>B.4.1</b> Calling <code>mclapply()</code> <em>within</em> targets</a></li>
<li class="chapter" data-level="B.4.2" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>B.4.2</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="caution.html"><a href="caution.html#storage-1"><i class="fa fa-check"></i><b>B.5</b> Storage</a><ul>
<li class="chapter" data-level="B.5.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>B.5.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="B.5.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>B.5.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="B.5.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>B.5.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="packages" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> An analysis of R package download trends</h1>
<p>This chapter explores R package download trends using the <code>cranlogs</code> package, and it shows how <code>drake</code>’s custom triggers can help with workflows with remote data sources.</p>
<div id="get-the-code." class="section level2">
<h2><span class="header-section-number">7.1</span> Get the code.</h2>
<p>Write the code files to your workspace.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">drake_example</span>(<span class="st">&quot;packages&quot;</span>)</a></code></pre></div>
<p>The new <code>packages</code> folder now includes a file structure of a serious <code>drake</code> project, plus an <code>interactive-tutorial.R</code> to narrate the example. The code is also <a href="https://github.com/wlandau/drake-examples/tree/master/packages">online here</a>.</p>
</div>
<div id="overview" class="section level2">
<h2><span class="header-section-number">7.2</span> Overview</h2>
<p>This small data analysis project explores some trends in R package downloads over time. The datasets are downloaded using the <a href="https://github.com/metacran/cranlogs">cranlogs package</a>.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">library</span>(cranlogs)</a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="kw">cran_downloads</span>(<span class="dt">packages =</span> <span class="st">&quot;dplyr&quot;</span>, <span class="dt">when =</span> <span class="st">&quot;last-week&quot;</span>)</a>
<a class="sourceLine" id="cb110-3" data-line-number="3"><span class="co">#&gt;         date count package</span></a>
<a class="sourceLine" id="cb110-4" data-line-number="4"><span class="co">#&gt; 1 2019-10-09 44250   dplyr</span></a>
<a class="sourceLine" id="cb110-5" data-line-number="5"><span class="co">#&gt; 2 2019-10-10 43030   dplyr</span></a>
<a class="sourceLine" id="cb110-6" data-line-number="6"><span class="co">#&gt; 3 2019-10-11 38447   dplyr</span></a>
<a class="sourceLine" id="cb110-7" data-line-number="7"><span class="co">#&gt; 4 2019-10-12 25433   dplyr</span></a>
<a class="sourceLine" id="cb110-8" data-line-number="8"><span class="co">#&gt; 5 2019-10-13 25546   dplyr</span></a>
<a class="sourceLine" id="cb110-9" data-line-number="9"><span class="co">#&gt; 6 2019-10-14 42364   dplyr</span></a>
<a class="sourceLine" id="cb110-10" data-line-number="10"><span class="co">#&gt; 7 2019-10-15 44412   dplyr</span></a></code></pre></div>
<p>Above, each count is the number of times <code>dplyr</code> was downloaded from the RStudio CRAN mirror on the given day. To stay up to date with the latest download statistics, we need to refresh the data frequently. With <code>drake</code>, we can bring all our work up to date without restarting everything from scratch.</p>
</div>
<div id="analysis" class="section level2">
<h2><span class="header-section-number">7.3</span> Analysis</h2>
<p>First, we load the required packages. <code>drake</code> detects the packages you install and load.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw">library</span>(cranlogs)</a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="kw">library</span>(drake)</a>
<a class="sourceLine" id="cb111-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb111-4" data-line-number="4"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb111-5" data-line-number="5"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb111-6" data-line-number="6"><span class="kw">library</span>(rvest)</a></code></pre></div>
<p>We will want custom functions to summarize the CRAN logs we download.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">make_my_table &lt;-<span class="st"> </span><span class="cf">function</span>(downloads){</a>
<a class="sourceLine" id="cb112-2" data-line-number="2">  <span class="kw">group_by</span>(downloads, package) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb112-3" data-line-number="3"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_downloads =</span> <span class="kw">mean</span>(count))</a>
<a class="sourceLine" id="cb112-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb112-5" data-line-number="5"></a>
<a class="sourceLine" id="cb112-6" data-line-number="6">make_my_plot &lt;-<span class="st"> </span><span class="cf">function</span>(downloads){</a>
<a class="sourceLine" id="cb112-7" data-line-number="7">  <span class="kw">ggplot</span>(downloads) <span class="op">+</span></a>
<a class="sourceLine" id="cb112-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> count, <span class="dt">group =</span> package, <span class="dt">color =</span> package))</a>
<a class="sourceLine" id="cb112-9" data-line-number="9">}</a></code></pre></div>
<p>Next, we generate the plan.</p>
<p>We want to explore the daily downloads from the <code>knitr</code>, <code>Rcpp</code>, and <code>ggplot2</code> packages. We will use the <a href="https://github.com/metacran/cranlogs"><code>cranlogs</code> package</a> to get daily logs of package downloads from RStudio’s CRAN mirror. In our <code>drake_plan()</code>, we declare targets <code>older</code> and <code>recent</code> to contain snapshots of the logs.</p>
<p>The following <code>drake_plan()</code> syntax is described <a href="https://ropenscilabs.github.io/drake-manual/plans.html#create-large-plans-the-easy-way">here</a>, which is supported in <code>drake</code> 7.0.0 and above (and the <a href="https://github.com/ropensci/drake">current development version</a>).</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb113-2" data-line-number="2">  <span class="dt">older =</span> <span class="kw">cran_downloads</span>(</a>
<a class="sourceLine" id="cb113-3" data-line-number="3">    <span class="dt">packages =</span> <span class="kw">c</span>(<span class="st">&quot;knitr&quot;</span>, <span class="st">&quot;Rcpp&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>),</a>
<a class="sourceLine" id="cb113-4" data-line-number="4">    <span class="dt">from =</span> <span class="st">&quot;2016-11-01&quot;</span>,</a>
<a class="sourceLine" id="cb113-5" data-line-number="5">    <span class="dt">to =</span> <span class="st">&quot;2016-12-01&quot;</span>,</a>
<a class="sourceLine" id="cb113-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb113-7" data-line-number="7">  <span class="dt">recent =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb113-8" data-line-number="8">    <span class="dt">command =</span> <span class="kw">cran_downloads</span>(</a>
<a class="sourceLine" id="cb113-9" data-line-number="9">      <span class="dt">packages =</span> <span class="kw">c</span>(<span class="st">&quot;knitr&quot;</span>, <span class="st">&quot;Rcpp&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>),</a>
<a class="sourceLine" id="cb113-10" data-line-number="10">      <span class="dt">when =</span> <span class="st">&quot;last-month&quot;</span>),</a>
<a class="sourceLine" id="cb113-11" data-line-number="11">    <span class="dt">trigger =</span> <span class="kw">trigger</span>(<span class="dt">change =</span> <span class="kw">latest_log_date</span>())</a>
<a class="sourceLine" id="cb113-12" data-line-number="12">  ),</a>
<a class="sourceLine" id="cb113-13" data-line-number="13">  <span class="dt">averages =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb113-14" data-line-number="14">    <span class="kw">make_my_table</span>(data),</a>
<a class="sourceLine" id="cb113-15" data-line-number="15">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">data =</span> <span class="kw">c</span>(older, recent))</a>
<a class="sourceLine" id="cb113-16" data-line-number="16">  ),</a>
<a class="sourceLine" id="cb113-17" data-line-number="17">  <span class="dt">plot =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb113-18" data-line-number="18">    <span class="kw">make_my_plot</span>(data),</a>
<a class="sourceLine" id="cb113-19" data-line-number="19">    <span class="dt">transform =</span> <span class="kw">map</span>(data)</a>
<a class="sourceLine" id="cb113-20" data-line-number="20">  ),</a>
<a class="sourceLine" id="cb113-21" data-line-number="21">  <span class="dt">report =</span> <span class="kw">knit</span>(</a>
<a class="sourceLine" id="cb113-22" data-line-number="22">    <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>),</a>
<a class="sourceLine" id="cb113-23" data-line-number="23">    <span class="kw">file_out</span>(<span class="st">&quot;report.md&quot;</span>),</a>
<a class="sourceLine" id="cb113-24" data-line-number="24">    <span class="dt">quiet =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb113-25" data-line-number="25">  )</a>
<a class="sourceLine" id="cb113-26" data-line-number="26">)</a></code></pre></div>
<p>Notice the custom trigger for the target <code>recent</code>. Here, we are telling <code>drake</code> to rebuild <code>recent</code> whenever a new day’s log is uploaded to <a href="http://cran-logs.rstudio.com" class="uri">http://cran-logs.rstudio.com</a>. In other words, <code>drake</code> keeps track of the return value of <code>latest_log_date()</code> and recomputes <code>recent</code> (during <code>make()</code>) if that value changed since the last <code>make()</code>. Here, <code>latest_log_date()</code> is one of our custom imported functions. We use it to scrape <a href="http://cran-logs.rstudio.com" class="uri">http://cran-logs.rstudio.com</a> using the <a href="https://github.com/hadley/rvest"><code>rvest</code></a> package.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">latest_log_date &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb114-2" data-line-number="2">  <span class="kw">read_html</span>(<span class="st">&quot;http://cran-logs.rstudio.com/&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-3" data-line-number="3"><span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;li:last-of-type&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-4" data-line-number="4"><span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;a:last-of-type&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-5" data-line-number="5"><span class="st">    </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-6" data-line-number="6"><span class="st">    </span>max</a>
<a class="sourceLine" id="cb114-7" data-line-number="7">}</a></code></pre></div>
<p>Now, we run the project to download the data and analyze it.
The results will be summarized in the knitted report, <code>report.md</code>,
but you can also read the results directly from the cache.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="co">#&gt; target older</span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="co">#&gt; target recent</span></a>
<a class="sourceLine" id="cb115-4" data-line-number="4"><span class="co">#&gt; target averages_older</span></a>
<a class="sourceLine" id="cb115-5" data-line-number="5"><span class="co">#&gt; target plot_older</span></a>
<a class="sourceLine" id="cb115-6" data-line-number="6"><span class="co">#&gt; target averages_recent</span></a>
<a class="sourceLine" id="cb115-7" data-line-number="7"><span class="co">#&gt; target plot_recent</span></a>
<a class="sourceLine" id="cb115-8" data-line-number="8"><span class="co">#&gt; target report</span></a>
<a class="sourceLine" id="cb115-9" data-line-number="9"></a>
<a class="sourceLine" id="cb115-10" data-line-number="10"><span class="kw">readd</span>(averages_recent)</a>
<a class="sourceLine" id="cb115-11" data-line-number="11"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb115-12" data-line-number="12"><span class="co">#&gt;   package mean_downloads</span></a>
<a class="sourceLine" id="cb115-13" data-line-number="13"><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb115-14" data-line-number="14"><span class="co">#&gt; 1 ggplot2         33978.</span></a>
<a class="sourceLine" id="cb115-15" data-line-number="15"><span class="co">#&gt; 2 knitr           23332 </span></a>
<a class="sourceLine" id="cb115-16" data-line-number="16"><span class="co">#&gt; 3 Rcpp            36378.</span></a>
<a class="sourceLine" id="cb115-17" data-line-number="17"></a>
<a class="sourceLine" id="cb115-18" data-line-number="18"><span class="kw">readd</span>(averages_older)</a>
<a class="sourceLine" id="cb115-19" data-line-number="19"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb115-20" data-line-number="20"><span class="co">#&gt;   package mean_downloads</span></a>
<a class="sourceLine" id="cb115-21" data-line-number="21"><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb115-22" data-line-number="22"><span class="co">#&gt; 1 ggplot2         14641.</span></a>
<a class="sourceLine" id="cb115-23" data-line-number="23"><span class="co">#&gt; 2 knitr            9069.</span></a>
<a class="sourceLine" id="cb115-24" data-line-number="24"><span class="co">#&gt; 3 Rcpp            14408.</span></a>
<a class="sourceLine" id="cb115-25" data-line-number="25"></a>
<a class="sourceLine" id="cb115-26" data-line-number="26"><span class="kw">readd</span>(plot_recent)</a></code></pre></div>
<p><img src="drake-manual_files/figure-html/unnamed-chunk-120-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1"></a>
<a class="sourceLine" id="cb116-2" data-line-number="2"><span class="kw">readd</span>(plot_older)</a></code></pre></div>
<p><img src="drake-manual_files/figure-html/unnamed-chunk-120-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>If we run <code>make()</code> again right away, we see that everything is up to date. But if we wait until a new day’s log is uploaded, <code>make()</code> will update <code>recent</code> and everything that depends on it.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb117-2" data-line-number="2"><span class="co">#&gt; All targets are already up to date.</span></a></code></pre></div>
<p>To visualize the build behavior, you can plot the dependency network.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb118-2" data-line-number="2"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-aa0f842c976f36455530" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-aa0f842c976f36455530">{"x":{"nodes":{"id":["make_my_table","latest_log_date","make_my_plot","older","p-OJSXA33SOQXFE3LE","recent","averages_older","plot_older","averages_recent","plot_recent","report","p-OJSXA33SOQXG2ZA"],"imported":[true,true,true,false,true,false,false,false,false,false,false,false],"label":["make_my_table","latest_log_date","make_my_plot","older\n0.5s","file report.Rmd","recent\n0.619s","averages_older\n0.005s","plot_older\n0.025s","averages_recent\n0.009s","plot_recent\n0.028s","report\n1.255s","file report.md"],"status":["imported","imported","imported","up to date","imported","up to date","up to date","up to date","up to date","up to date","up to date","up to date"],"type":["function","function","function","object","file","object","object","object","object","object","object","file"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#228B22","#1874CD","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22"],"shape":["triangle","triangle","triangle","dot","square","dot","dot","dot","dot","dot","dot","square"],"level":[1,1,1,1,1,2,2,2,3,3,4,5],"x":[-1,-1,-1,-1,-1,-0.5,-0.5,-0.5,0,0,0.5,1],"y":[-1,-0.5,2.22044604925031e-16,0.5,1,-0.75,2.22044604925031e-16,0.75,-0.5,0.5,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["make_my_table","make_my_table","latest_log_date","make_my_plot","make_my_plot","older","older","recent","recent","averages_recent","averages_older","plot_recent","plot_older","p-OJSXA33SOQXFE3LE","report"],"to":["averages_recent","averages_older","recent","plot_recent","plot_older","averages_older","plot_older","averages_recent","plot_recent","report","report","report","report","report","p-OJSXA33SOQXG2ZA"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Imported","Object","Function","File"],"color":["#228B22","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[1,5,7,8,9]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="other-ways-to-trigger-downloads" class="section level2">
<h2><span class="header-section-number">7.4</span> Other ways to trigger downloads</h2>
<p>Sometimes, our remote data sources get revised, and web scraping may not be the best way to detect changes. We may want to look at our remote dataset’s modification time or HTTP ETag. To see how this works, consider the CRAN log file from February 9, 2018.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">url &lt;-<span class="st"> &quot;http://cran-logs.rstudio.com/2018/2018-02-09-r.csv.gz&quot;</span></a></code></pre></div>
<p>We can track the modification date using the <a href="https://github.com/r-lib/httr"><code>httr</code></a> package.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="kw">library</span>(httr)    <span class="co"># For querying websites.</span></a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="kw">HEAD</span>(url)<span class="op">$</span>headers[[<span class="st">&quot;last-modified&quot;</span>]]</a>
<a class="sourceLine" id="cb120-3" data-line-number="3"><span class="co">#&gt; [1] &quot;Mon, 12 Feb 2018 16:34:48 GMT&quot;</span></a></code></pre></div>
<p>In our <code>drake</code> plan, we can track this timestamp and trigger a download whenever it changes.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb121-2" data-line-number="2">  <span class="dt">logs =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb121-3" data-line-number="3">    <span class="kw">get_logs</span>(url),</a>
<a class="sourceLine" id="cb121-4" data-line-number="4">    <span class="dt">trigger =</span> <span class="kw">trigger</span>(<span class="dt">change =</span> <span class="kw">HEAD</span>(url)<span class="op">$</span>headers[[<span class="st">&quot;last-modified&quot;</span>]])</a>
<a class="sourceLine" id="cb121-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb121-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb121-7" data-line-number="7">plan</a>
<a class="sourceLine" id="cb121-8" data-line-number="8"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb121-9" data-line-number="9"><span class="co">#&gt;   target command       trigger                                             </span></a>
<a class="sourceLine" id="cb121-10" data-line-number="10"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;        &lt;expr&gt;                                              </span></a>
<a class="sourceLine" id="cb121-11" data-line-number="11"><span class="co">#&gt; 1 logs   get_logs(url) trigger(change = HEAD(url)$headers[[&quot;last-modified&quot;…</span></a></code></pre></div>
<p>where</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="kw">library</span>(R.utils) <span class="co"># For unzipping the files we download.</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="kw">library</span>(curl)    <span class="co"># For downloading data.</span></a>
<a class="sourceLine" id="cb122-3" data-line-number="3">get_logs &lt;-<span class="st"> </span><span class="cf">function</span>(url){</a>
<a class="sourceLine" id="cb122-4" data-line-number="4">  <span class="kw">curl_download</span>(url, <span class="st">&quot;logs.csv.gz&quot;</span>)       <span class="co"># Get a big file.</span></a>
<a class="sourceLine" id="cb122-5" data-line-number="5">  <span class="kw">gunzip</span>(<span class="st">&quot;logs.csv.gz&quot;</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>) <span class="co"># Unzip it.</span></a>
<a class="sourceLine" id="cb122-6" data-line-number="6">  out &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;logs.csv&quot;</span>, <span class="dt">nrows =</span> <span class="dv">4</span>)  <span class="co"># Extract the data you need.</span></a>
<a class="sourceLine" id="cb122-7" data-line-number="7">  <span class="kw">unlink</span>(<span class="kw">c</span>(<span class="st">&quot;logs.csv.gz&quot;</span>, <span class="st">&quot;logs.csv&quot;</span>))    <span class="co"># Remove the big files</span></a>
<a class="sourceLine" id="cb122-8" data-line-number="8">  out                                     <span class="co"># Value of the target.</span></a>
<a class="sourceLine" id="cb122-9" data-line-number="9">}</a></code></pre></div>
<p>When we are ready, we run the workflow.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="co">#&gt; target logs</span></a>
<a class="sourceLine" id="cb123-3" data-line-number="3"></a>
<a class="sourceLine" id="cb123-4" data-line-number="4"><span class="kw">readd</span>(logs)</a>
<a class="sourceLine" id="cb123-5" data-line-number="5"><span class="co">#&gt;         date     time     size version  os country ip_id</span></a>
<a class="sourceLine" id="cb123-6" data-line-number="6"><span class="co">#&gt; 1 2018-02-09 13:01:13 82375220   3.4.3 win      RO     1</span></a>
<a class="sourceLine" id="cb123-7" data-line-number="7"><span class="co">#&gt; 2 2018-02-09 13:02:06 74286541   3.3.3 win      US     2</span></a>
<a class="sourceLine" id="cb123-8" data-line-number="8"><span class="co">#&gt; 3 2018-02-09 13:02:10 82375216   3.4.3 win      US     3</span></a>
<a class="sourceLine" id="cb123-9" data-line-number="9"><span class="co">#&gt; 4 2018-02-09 13:03:30 82375220   3.4.3 win      IS     4</span></a></code></pre></div>
<p>If the log file at the <code>url</code> ever changes, the timestamp will update remotely, and <code>make()</code> will download the file again.</p>

</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="churn.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="gsp.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropenscilabs/drake-manual/edit/master/packages.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropenscilabs/drake-manual/commits/master/packages.Rmd",
"text": "Chapter edit history"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
