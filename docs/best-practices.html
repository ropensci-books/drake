<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>The User Manual of the drake R Package</title>
  <meta name="description" content="The User Manual of the drake R Package">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="The User Manual of the drake R Package" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The User Manual of the drake R Package" />
  
  
  

<meta name="author" content="Will Landau">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="mtcars.html">
<link rel="next" href="debug.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.4/visNetwork.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.1</b> The drake R package</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.3</b> Why drake?</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.3.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.3.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#aggressively-scale-up."><i class="fa fa-check"></i><b>1.3.3</b> Aggressively scale up.</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.4</b> Documentation</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#cheat-sheet"><i class="fa fa-check"></i><b>1.4.1</b> Cheat sheet</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.4.2</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.4.3</b> Function reference</a></li>
<li class="chapter" data-level="1.4.4" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.4.4</b> Tutorials</a></li>
<li class="chapter" data-level="1.4.5" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.4.5</b> Examples</a></li>
<li class="chapter" data-level="1.4.6" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.4.6</b> Presentations</a></li>
<li class="chapter" data-level="1.4.7" data-path="index.html"><a href="index.html#real-example-projects"><i class="fa fa-check"></i><b>1.4.7</b> Real example projects</a></li>
<li class="chapter" data-level="1.4.8" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.4.8</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.5</b> Help and troubleshooting</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#similar-work"><i class="fa fa-check"></i><b>1.6</b> Similar work</a><ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#gnu-make"><i class="fa fa-check"></i><b>1.6.1</b> GNU Make</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="index.html#remake"><i class="fa fa-check"></i><b>1.6.2</b> Remake</a></li>
<li class="chapter" data-level="1.6.3" data-path="index.html"><a href="index.html#memoise"><i class="fa fa-check"></i><b>1.6.3</b> Memoise</a></li>
<li class="chapter" data-level="1.6.4" data-path="index.html"><a href="index.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>1.6.4</b> Knitr and R Markdown</a></li>
<li class="chapter" data-level="1.6.5" data-path="index.html"><a href="index.html#factuals-drake"><i class="fa fa-check"></i><b>1.6.5</b> Factual’s Drake</a></li>
<li class="chapter" data-level="1.6.6" data-path="index.html"><a href="index.html#other-pipeline-toolkits"><i class="fa fa-check"></i><b>1.6.6</b> Other pipeline toolkits</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-main.html"><a href="example-main.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="example-main.html"><a href="example-main.html#set-the-stage."><i class="fa fa-check"></i><b>2.1</b> Set the stage.</a></li>
<li class="chapter" data-level="2.2" data-path="example-main.html"><a href="example-main.html#make-your-results."><i class="fa fa-check"></i><b>2.2</b> Make your results.</a></li>
<li class="chapter" data-level="2.3" data-path="example-main.html"><a href="example-main.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>2.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="2.4" data-path="example-main.html"><a href="example-main.html#try-it-yourself"><i class="fa fa-check"></i><b>2.4</b> Try it yourself!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="example-packages.html"><a href="example-packages.html"><i class="fa fa-check"></i><b>3</b> Example: R package download trends</a><ul>
<li class="chapter" data-level="3.1" data-path="example-packages.html"><a href="example-packages.html#get-the-code."><i class="fa fa-check"></i><b>3.1</b> Get the code.</a></li>
<li class="chapter" data-level="3.2" data-path="example-packages.html"><a href="example-packages.html#overview"><i class="fa fa-check"></i><b>3.2</b> Overview</a></li>
<li class="chapter" data-level="3.3" data-path="example-packages.html"><a href="example-packages.html#analysis"><i class="fa fa-check"></i><b>3.3</b> Analysis</a></li>
<li class="chapter" data-level="3.4" data-path="example-packages.html"><a href="example-packages.html#what-remote-data-sources-in-general"><i class="fa fa-check"></i><b>3.4</b> What remote data sources in general?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="example-gsp.html"><a href="example-gsp.html"><i class="fa fa-check"></i><b>4</b> Example: gross state products</a><ul>
<li class="chapter" data-level="4.1" data-path="example-gsp.html"><a href="example-gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>4.1</b> Get the code.</a></li>
<li class="chapter" data-level="4.2" data-path="example-gsp.html"><a href="example-gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>4.2</b> Objective and methods</a></li>
<li class="chapter" data-level="4.3" data-path="example-gsp.html"><a href="example-gsp.html#data"><i class="fa fa-check"></i><b>4.3</b> Data</a></li>
<li class="chapter" data-level="4.4" data-path="example-gsp.html"><a href="example-gsp.html#analysis-1"><i class="fa fa-check"></i><b>4.4</b> Analysis</a></li>
<li class="chapter" data-level="4.5" data-path="example-gsp.html"><a href="example-gsp.html#results"><i class="fa fa-check"></i><b>4.5</b> Results</a></li>
<li class="chapter" data-level="4.6" data-path="example-gsp.html"><a href="example-gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>4.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="4.7" data-path="example-gsp.html"><a href="example-gsp.html#references"><i class="fa fa-check"></i><b>4.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mtcars.html"><a href="mtcars.html"><i class="fa fa-check"></i><b>5</b> The mtcars example and workflow plan generation</a><ul>
<li class="chapter" data-level="5.1" data-path="mtcars.html"><a href="mtcars.html#get-the-code.-2"><i class="fa fa-check"></i><b>5.1</b> Get the code.</a></li>
<li class="chapter" data-level="5.2" data-path="mtcars.html"><a href="mtcars.html#quick-examples"><i class="fa fa-check"></i><b>5.2</b> Quick examples</a></li>
<li class="chapter" data-level="5.3" data-path="mtcars.html"><a href="mtcars.html#the-motivation-of-the-mtcars-example"><i class="fa fa-check"></i><b>5.3</b> The motivation of the mtcars example</a></li>
<li class="chapter" data-level="5.4" data-path="mtcars.html"><a href="mtcars.html#set-up-the-mtcars-example"><i class="fa fa-check"></i><b>5.4</b> Set up the mtcars example</a></li>
<li class="chapter" data-level="5.5" data-path="mtcars.html"><a href="mtcars.html#the-workflow-plan-data-frame"><i class="fa fa-check"></i><b>5.5</b> The workflow plan data frame</a></li>
<li class="chapter" data-level="5.6" data-path="mtcars.html"><a href="mtcars.html#generate-the-workflow-plan"><i class="fa fa-check"></i><b>5.6</b> Generate the workflow plan</a></li>
<li class="chapter" data-level="5.7" data-path="mtcars.html"><a href="mtcars.html#flexible-workflow-plan-generation"><i class="fa fa-check"></i><b>5.7</b> Flexible workflow plan generation</a></li>
<li class="chapter" data-level="5.8" data-path="mtcars.html"><a href="mtcars.html#run-the-workflow"><i class="fa fa-check"></i><b>5.8</b> Run the workflow</a></li>
<li class="chapter" data-level="5.9" data-path="mtcars.html"><a href="mtcars.html#automatic-watching-for-changed-dependencies"><i class="fa fa-check"></i><b>5.9</b> Automatic watching for changed dependencies</a></li>
<li class="chapter" data-level="5.10" data-path="mtcars.html"><a href="mtcars.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>5.10</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="5.11" data-path="mtcars.html"><a href="mtcars.html#need-more-speed"><i class="fa fa-check"></i><b>5.11</b> Need more speed?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="best-practices.html"><a href="best-practices.html"><i class="fa fa-check"></i><b>6</b> General best practices for drake projects</a><ul>
<li class="chapter" data-level="6.1" data-path="best-practices.html"><a href="best-practices.html#how-to-organize-your-files"><i class="fa fa-check"></i><b>6.1</b> How to organize your files</a><ul>
<li class="chapter" data-level="6.1.1" data-path="best-practices.html"><a href="best-practices.html#examples-1"><i class="fa fa-check"></i><b>6.1.1</b> Examples</a></li>
<li class="chapter" data-level="6.1.2" data-path="best-practices.html"><a href="best-practices.html#where-do-you-put-your-code"><i class="fa fa-check"></i><b>6.1.2</b> Where do you put your code?</a></li>
<li class="chapter" data-level="6.1.3" data-path="best-practices.html"><a href="best-practices.html#remember-your-commands-are-code-chunks-not-r-scripts"><i class="fa fa-check"></i><b>6.1.3</b> Remember: your commands are code chunks, not R scripts</a></li>
<li class="chapter" data-level="6.1.4" data-path="best-practices.html"><a href="best-practices.html#file-output-targets"><i class="fa fa-check"></i><b>6.1.4</b> File output targets</a></li>
<li class="chapter" data-level="6.1.5" data-path="best-practices.html"><a href="best-practices.html#r-markdown-and-knitr-reports"><i class="fa fa-check"></i><b>6.1.5</b> R Markdown and knitr reports</a></li>
<li class="chapter" data-level="6.1.6" data-path="best-practices.html"><a href="best-practices.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>6.1.6</b> Workflows as R packages</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="best-practices.html"><a href="best-practices.html#generating-workflow-plan-data-frames"><i class="fa fa-check"></i><b>6.2</b> Generating workflow plan data frames</a></li>
<li class="chapter" data-level="6.3" data-path="best-practices.html"><a href="best-practices.html#remote-data-sources"><i class="fa fa-check"></i><b>6.3</b> Remote data sources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="debug.html"><a href="debug.html"><i class="fa fa-check"></i><b>7</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="7.1" data-path="debug.html"><a href="debug.html#the-configuration-list"><i class="fa fa-check"></i><b>7.1</b> The configuration list</a></li>
<li class="chapter" data-level="7.2" data-path="debug.html"><a href="debug.html#plan-your-work."><i class="fa fa-check"></i><b>7.2</b> Plan your work.</a><ul>
<li class="chapter" data-level="7.2.1" data-path="debug.html"><a href="debug.html#workflow-plan-data-frames"><i class="fa fa-check"></i><b>7.2.1</b> Workflow plan data frames</a></li>
<li class="chapter" data-level="7.2.2" data-path="debug.html"><a href="debug.html#visualize-your-workflow."><i class="fa fa-check"></i><b>7.2.2</b> Visualize your workflow.</a></li>
<li class="chapter" data-level="7.2.3" data-path="debug.html"><a href="debug.html#check-dependency-relationships."><i class="fa fa-check"></i><b>7.2.3</b> Check dependency relationships.</a></li>
<li class="chapter" data-level="7.2.4" data-path="debug.html"><a href="debug.html#outdated-up-to-date-and-missing-items"><i class="fa fa-check"></i><b>7.2.4</b> Outdated, up to date, and missing items</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="debug.html"><a href="debug.html#test-with-triggers."><i class="fa fa-check"></i><b>7.3</b> Test with triggers.</a></li>
<li class="chapter" data-level="7.4" data-path="debug.html"><a href="debug.html#skipping-imports"><i class="fa fa-check"></i><b>7.4</b> Skipping imports</a></li>
<li class="chapter" data-level="7.5" data-path="debug.html"><a href="debug.html#impose-timeouts-and-retries"><i class="fa fa-check"></i><b>7.5</b> Impose timeouts and retries</a></li>
<li class="chapter" data-level="7.6" data-path="debug.html"><a href="debug.html#diagnose-failures."><i class="fa fa-check"></i><b>7.6</b> Diagnose failures.</a><ul>
<li class="chapter" data-level="7.6.1" data-path="debug.html"><a href="debug.html#tidy-evaluation-a-caveat-to-diagnosing-interactively"><i class="fa fa-check"></i><b>7.6.1</b> Tidy evaluation: a caveat to diagnosing interactively</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="debug.html"><a href="debug.html#debrief-a-build-session."><i class="fa fa-check"></i><b>7.7</b> Debrief a build session.</a></li>
<li class="chapter" data-level="7.8" data-path="debug.html"><a href="debug.html#start-tinkering."><i class="fa fa-check"></i><b>7.8</b> Start tinkering.</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="vis.html"><a href="vis.html"><i class="fa fa-check"></i><b>8</b> Visualization with drake</a><ul>
<li class="chapter" data-level="8.1" data-path="vis.html"><a href="vis.html#dependency-reactivity"><i class="fa fa-check"></i><b>8.1</b> Dependency reactivity</a></li>
<li class="chapter" data-level="8.2" data-path="vis.html"><a href="vis.html#subgraphs"><i class="fa fa-check"></i><b>8.2</b> Subgraphs</a></li>
<li class="chapter" data-level="8.3" data-path="vis.html"><a href="vis.html#control-the-legend."><i class="fa fa-check"></i><b>8.3</b> Control the legend.</a></li>
<li class="chapter" data-level="8.4" data-path="vis.html"><a href="vis.html#more-flexibility"><i class="fa fa-check"></i><b>8.4</b> More flexibility</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>9</b> High-performance computing with drake</a><ul>
<li class="chapter" data-level="9.1" data-path="hpc.html"><a href="hpc.html#batch-mode-for-long-workflows"><i class="fa fa-check"></i><b>9.1</b> Batch mode for long workflows</a></li>
<li class="chapter" data-level="9.2" data-path="hpc.html"><a href="hpc.html#let-drake-schedule-your-targets."><i class="fa fa-check"></i><b>9.2</b> Let drake schedule your targets.</a></li>
<li class="chapter" data-level="9.3" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>9.3</b> Parallel backends</a></li>
<li class="chapter" data-level="9.4" data-path="hpc.html"><a href="hpc.html#local-workers"><i class="fa fa-check"></i><b>9.4</b> Local workers</a></li>
<li class="chapter" data-level="9.5" data-path="hpc.html"><a href="hpc.html#remote-workers"><i class="fa fa-check"></i><b>9.5</b> Remote workers</a><ul>
<li class="chapter" data-level="9.5.1" data-path="hpc.html"><a href="hpc.html#future-and-future_lapply"><i class="fa fa-check"></i><b>9.5.1</b> <code>&quot;future&quot;</code> and <code>&quot;future_lapply&quot;</code></a></li>
<li class="chapter" data-level="9.5.2" data-path="hpc.html"><a href="hpc.html#makefile"><i class="fa fa-check"></i><b>9.5.2</b> <code>&quot;Makefile&quot;</code></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="hpc.html"><a href="hpc.html#scheduling-algorithms"><i class="fa fa-check"></i><b>9.6</b> Scheduling algorithms</a><ul>
<li class="chapter" data-level="9.6.1" data-path="hpc.html"><a href="hpc.html#persistent-scheduling"><i class="fa fa-check"></i><b>9.6.1</b> Persistent scheduling</a></li>
<li class="chapter" data-level="9.6.2" data-path="hpc.html"><a href="hpc.html#transient-scheduling"><i class="fa fa-check"></i><b>9.6.2</b> Transient scheduling</a></li>
<li class="chapter" data-level="9.6.3" data-path="hpc.html"><a href="hpc.html#staged-scheduling"><i class="fa fa-check"></i><b>9.6.3</b> Staged scheduling</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="hpc.html"><a href="hpc.html#final-thoughts"><i class="fa fa-check"></i><b>9.7</b> Final thoughts</a><ul>
<li class="chapter" data-level="9.7.1" data-path="hpc.html"><a href="hpc.html#debugging"><i class="fa fa-check"></i><b>9.7.1</b> Debugging</a></li>
<li class="chapter" data-level="9.7.2" data-path="hpc.html"><a href="hpc.html#drake-as-an-ordinary-job-scheduler"><i class="fa fa-check"></i><b>9.7.2</b> Drake as an ordinary job scheduler</a></li>
<li class="chapter" data-level="9.7.3" data-path="hpc.html"><a href="hpc.html#more-resources"><i class="fa fa-check"></i><b>9.7.3</b> More resources</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="hpc.html"><a href="hpc.html#footnotes"><i class="fa fa-check"></i><b>9.8</b> Footnotes</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>10</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="10.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>10.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="10.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>10.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="store.html"><a href="store.html"><i class="fa fa-check"></i><b>11</b> Storage</a><ul>
<li class="chapter" data-level="11.1" data-path="store.html"><a href="store.html#caches"><i class="fa fa-check"></i><b>11.1</b> Caches</a></li>
<li class="chapter" data-level="11.2" data-path="store.html"><a href="store.html#hash-algorithms"><i class="fa fa-check"></i><b>11.2</b> Hash algorithms</a></li>
<li class="chapter" data-level="11.3" data-path="store.html"><a href="store.html#which-hash-algorithm-should-you-choose"><i class="fa fa-check"></i><b>11.3</b> Which hash algorithm should you choose?</a></li>
<li class="chapter" data-level="11.4" data-path="store.html"><a href="store.html#select-the-hash-algorithms-of-the-cache"><i class="fa fa-check"></i><b>11.4</b> Select the hash algorithms of the cache</a></li>
<li class="chapter" data-level="11.5" data-path="store.html"><a href="store.html#using-storr-directly"><i class="fa fa-check"></i><b>11.5</b> Using <code>storr</code> directly</a></li>
<li class="chapter" data-level="11.6" data-path="store.html"><a href="store.html#cleaning-up"><i class="fa fa-check"></i><b>11.6</b> Cleaning up</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>12</b> Cautionary notes</a><ul>
<li class="chapter" data-level="12.1" data-path="caution.html"><a href="caution.html#projects-built-with-drake-4.4.0-are-not-back-compatible-with-drake-4.4.0."><i class="fa fa-check"></i><b>12.1</b> Projects built with drake &lt;= 4.4.0 are not back compatible with drake &gt; 4.4.0.</a></li>
<li class="chapter" data-level="12.2" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>12.2</b> Workflow plans</a><ul>
<li class="chapter" data-level="12.2.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>12.2.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="12.2.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>12.2.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>12.3</b> Execution</a><ul>
<li class="chapter" data-level="12.3.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>12.3.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="12.3.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>12.3.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="12.3.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation-1"><i class="fa fa-check"></i><b>12.3.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="12.3.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>12.3.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="12.3.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>12.3.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="12.3.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>12.3.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="12.3.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>12.3.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="12.3.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>12.3.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="caution.html"><a href="caution.html#dependencies"><i class="fa fa-check"></i><b>12.4</b> Dependencies</a><ul>
<li class="chapter" data-level="12.4.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-trigger-unwanted-builds"><i class="fa fa-check"></i><b>12.4.1</b> Objects that contain functions may trigger unwanted builds</a></li>
<li class="chapter" data-level="12.4.2" data-path="caution.html"><a href="caution.html#the-magrittr-dot-.-is-always-ignored."><i class="fa fa-check"></i><b>12.4.2</b> The <code>magrittr</code> dot (<code>.</code>) is always ignored.</a></li>
<li class="chapter" data-level="12.4.3" data-path="caution.html"><a href="caution.html#triggers-and-skipped-imports"><i class="fa fa-check"></i><b>12.4.3</b> Triggers and skipped imports</a></li>
<li class="chapter" data-level="12.4.4" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>12.4.4</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="12.4.5" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>12.4.5</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="12.4.6" data-path="caution.html"><a href="caution.html#knitr-inputs-and-file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>12.4.6</b> Knitr inputs and file outputs in imported functions.</a></li>
<li class="chapter" data-level="12.4.7" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>12.4.7</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="12.4.8" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>12.4.8</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="12.4.9" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>12.4.9</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="12.4.10" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>12.4.10</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>12.5</b> High-performance computing</a><ul>
<li class="chapter" data-level="12.5.1" data-path="caution.html"><a href="caution.html#the-practical-utility-of-parallel-computing"><i class="fa fa-check"></i><b>12.5.1</b> The practical utility of parallel computing</a></li>
<li class="chapter" data-level="12.5.2" data-path="caution.html"><a href="caution.html#maximum-number-of-simultaneous-jobs"><i class="fa fa-check"></i><b>12.5.2</b> Maximum number of simultaneous jobs</a></li>
<li class="chapter" data-level="12.5.3" data-path="caution.html"><a href="caution.html#parallel-computing-on-windows"><i class="fa fa-check"></i><b>12.5.3</b> Parallel computing on Windows</a></li>
<li class="chapter" data-level="12.5.4" data-path="caution.html"><a href="caution.html#configuring-futurebatchtools-parallelism-for-clusters"><i class="fa fa-check"></i><b>12.5.4</b> Configuring <a href="https://github.com/HenrikBengtsson/future">future</a>/<a href="https://github.com/mllg/batchtools">batchtools</a> parallelism for clusters</a></li>
<li class="chapter" data-level="12.5.5" data-path="caution.html"><a href="caution.html#proper-makefiles-are-not-standalone."><i class="fa fa-check"></i><b>12.5.5</b> Proper Makefiles are not standalone.</a></li>
<li class="chapter" data-level="12.5.6" data-path="caution.html"><a href="caution.html#makefile-level-parallelism-for-imported-objects-and-files"><i class="fa fa-check"></i><b>12.5.6</b> Makefile-level parallelism for imported objects and files</a></li>
<li class="chapter" data-level="12.5.7" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>12.5.7</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="caution.html"><a href="caution.html#storage"><i class="fa fa-check"></i><b>12.6</b> Storage</a><ul>
<li class="chapter" data-level="12.6.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>12.6.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="12.6.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>12.6.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="12.6.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>12.6.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>13</b> Frequently-asked questions</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The User Manual of the drake R Package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="best-practices" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> General best practices for drake projects</h1>
<p>This chapter describes general best practices for creating, configuring, and running <code>drake</code> projects. It answers frequently asked questions and clears up common misconceptions, and it will continuously develop in response to community feedback.</p>
<div id="how-to-organize-your-files" class="section level2">
<h2><span class="header-section-number">6.1</span> How to organize your files</h2>
<div id="examples-1" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Examples</h3>
<p>For examples of how to structure your code files, see the beginner oriented example projects:</p>
<ul>
<li><a href="https://github.com/ropensci/drake/tree/master/inst/examples/mtcars">mtcars</a></li>
<li><a href="https://github.com/ropensci/drake/tree/master/inst/examples/gsp">gsp</a></li>
<li><a href="https://github.com/ropensci/drake/tree/master/inst/examples/packages">packages</a></li>
</ul>
<p>Write the code directly with the <code>drake_example()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">drake_example</span>(<span class="st">&quot;mtcars&quot;</span>)
<span class="kw">drake_example</span>(<span class="st">&quot;gsp&quot;</span>)
<span class="kw">drake_example</span>(<span class="st">&quot;packages&quot;</span>)</code></pre></div>
<p>In practice, you do not need to organize your files the way the examples do, but it does happen to be a reasonable way of doing things.</p>
</div>
<div id="where-do-you-put-your-code" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Where do you put your code?</h3>
<p>It is best to write your code as a bunch of functions. You can save those functions in R scripts and then <code>source()</code> them before doing anything else.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Load functions get_data(), analyze_data, and summarize_results()
<span class="kw">source</span>(<span class="st">&quot;my_functions.R&quot;</span>)</code></pre></div>
<p>Then, set up your workflow plan data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">good_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">my_data =</span> <span class="kw">get_data</span>(<span class="kw">file_in</span>(<span class="st">&quot;data.csv&quot;</span>)), <span class="co"># External files need to be in commands explicitly. # nolint</span>
  <span class="dt">my_analysis =</span> <span class="kw">analyze_data</span>(my_data),
  <span class="dt">my_summaries =</span> <span class="kw">summarize_results</span>(my_data, my_analysis)
)

good_plan
## # A tibble: 3 x 2
##   target       command                                
##   &lt;chr&gt;        &lt;chr&gt;                                  
## 1 my_data      &quot;get_data(file_in(\&quot;data.csv\&quot;))&quot;      
## 2 my_analysis  analyze_data(my_data)                  
## 3 my_summaries summarize_results(my_data, my_analysis)</code></pre></div>
<p><code>Drake</code> knows that <code>my_analysis</code> depends on <code>my_data</code> because <code>my_data</code> is an argument to <code>analyze_data()</code>, which is part of the command for <code>my_analysis</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(good_plan)
<span class="kw">vis_drake_graph</span>(config)</code></pre></div>
<div id="htmlwidget-ffb026e0f95f638569ee" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ffb026e0f95f638569ee">{"x":{"nodes":{"id":["analyze_data","get_data","summarize_results","\"data.csv\"","my_data","my_analysis","my_summaries"],"label":["analyze_data\n0.001s","get_data\n0.001s","summarize_results\n0s","\"data.csv\"\n0.001s","my_data","my_analysis","my_summaries"],"status":["imported","imported","imported","imported","outdated","outdated","outdated"],"type":["function","function","function","file","object","object","object"],"font.size":[20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#000000","#000000","#000000"],"shape":["triangle","triangle","triangle","square","dot","dot","dot"],"level":[1,1,1,1,2,3,4],"hover_label":["function () \n{\n}","function () \n{\n}","function () \n{\n}","","get_data(file_in(\"data.csv\"))","analyze_data(my_data)","summarize_results(my_data, my_analysis)"],"x":[-1,-0.333333333333333,1,0.333333333333333,0,-1,0],"y":[-1,-1,-1,-1,-0.333333333333333,0.333333333333333,1]},"edges":{"from":["analyze_data","get_data","summarize_results","\"data.csv\"","my_data","my_data","my_analysis"],"to":["my_analysis","my_data","my_summaries","my_data","my_analysis","my_summaries","my_summaries"],"arrows":["to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true,"hover":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","In progress","Failed","Imported","Missing","Object","Function","File"],"color":["#228B22","#000000","#FF7221","#AA0000","#1874CD","#9A32CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","dot","dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black","black","black","black","black"],"font.size":[20,20,20,20,20,20,20,20,20],"id":[1,2,3,4,5,6,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","events":{"hoverNode":"function(e){\n        var label_info = this.body.data.nodes.get({\n          fields: ['label', 'hover_label'],\n          filter: function (item) {\n            return item.id === e.node\n          },\n          returnType :'Array'\n        });\n        this.body.data.nodes.update({\n          id: e.node,\n          label : label_info[0].hover_label,\n          hover_label : label_info[0].label\n        });\n      }","blurNode":"function(e){\n        var label_info = this.body.data.nodes.get({\n          fields: ['label', 'hover_label'],\n          filter: function (item) {\n            return item.id === e.node\n          },\n          returnType :'Array'\n        });\n        this.body.data.nodes.update({\n          id: e.node,\n          label : label_info[0].hover_label,\n          hover_label : label_info[0].label\n        });\n      }"}},"evals":["events.hoverNode","events.blurNode"],"jsHooks":[]}</script>
<p>Now, you can call <code>make()</code> to build the targets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(good_plan)</code></pre></div>
<p>If your commands are really long, just put them in larger functions. <code>Drake</code> analyzes imported functions for non-file dependencies.</p>
</div>
<div id="remember-your-commands-are-code-chunks-not-r-scripts" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Remember: your commands are code chunks, not R scripts</h3>
<p>Some people are accustomed to dividing their work into R scripts and then calling <code>source()</code> to run each step of the analysis. For example you might have the following files.</p>
<ul>
<li><code>get_data.R</code></li>
<li><code>analyze_data.R</code></li>
<li><code>summarize_results.R</code></li>
</ul>
<p>If you migrate to <code>drake</code>, you may be tempted to set up a workflow plan like this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bad_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">my_data =</span> <span class="kw">source</span>(<span class="kw">file_in</span>(<span class="st">&quot;get_data.R&quot;</span>)),
  <span class="dt">my_analysis =</span> <span class="kw">source</span>(<span class="kw">file_in</span>(<span class="st">&quot;analyze_data.R&quot;</span>)),
  <span class="dt">my_summaries =</span> <span class="kw">source</span>(<span class="kw">file_in</span>(<span class="st">&quot;summarize_data.R&quot;</span>))
)

bad_plan
## # A tibble: 3 x 2
##   target       command                                
##   &lt;chr&gt;        &lt;chr&gt;                                  
## 1 my_data      &quot;source(file_in(\&quot;get_data.R\&quot;))&quot;      
## 2 my_analysis  &quot;source(file_in(\&quot;analyze_data.R\&quot;))&quot;  
## 3 my_summaries &quot;source(file_in(\&quot;summarize_data.R\&quot;))&quot;</code></pre></div>
<p>But now, the dependency structure of your work is broken. Your R script files are dependencies, but since <code>my_data</code> is not mentioned in a function or command, <code>drake</code> does not know that <code>my_analysis</code> depends on it.</p>
<pre><code>## [[1]]
## [1] TRUE
## 
## [[2]]
## [1] TRUE
## 
## [[3]]
## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(bad_plan)
<span class="kw">vis_drake_graph</span>(config)</code></pre></div>
<div id="htmlwidget-25db82eb3b31272a5d15" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-25db82eb3b31272a5d15">{"x":{"nodes":{"id":["\"get_data.R\"","source","\"analyze_data.R\"","\"summarize_data.R\"","my_data","my_analysis","my_summaries"],"label":["\"get_data.R\"\n0s","source\n0.029s","\"analyze_data.R\"\n0.001s","\"summarize_data.R\"\n0.001s","my_data","my_analysis","my_summaries"],"status":["imported","imported","imported","imported","outdated","outdated","outdated"],"type":["file","function","file","file","object","object","object"],"font.size":[20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#000000","#000000","#000000"],"shape":["square","triangle","square","square","dot","dot","dot"],"level":[1,1,1,1,2,2,2],"hover_label":["","function (file, local = FALSE, echo = verbose, print.eval = echo, \n    exprs, spaced = use_file, verbose = getOption(\"verbose\"), \n    prompt.echo = getOption(\"prompt\"), max.deparse.length = 150, \n    width.cutoff = 60L, deparseCtrl = \"showAttribut...","","","source(file_in(\"get_data.R\"))","source(file_in(\"analyze_data.R\"))","source(file_in(\"summarize_data.R\"))"],"x":[-1,-0.333333333333333,0.333333333333333,1,-1,0,1],"y":[-1,-1,-1,-1,1,1,1]},"edges":{"from":["\"get_data.R\"","source","source","source","\"analyze_data.R\"","\"summarize_data.R\""],"to":["my_data","my_data","my_analysis","my_summaries","my_analysis","my_summaries"],"arrows":["to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true,"hover":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","In progress","Failed","Imported","Missing","Object","Function","File"],"color":["#228B22","#000000","#FF7221","#AA0000","#1874CD","#9A32CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","dot","dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black","black","black","black","black"],"font.size":[20,20,20,20,20,20,20,20,20],"id":[1,2,3,4,5,6,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","events":{"hoverNode":"function(e){\n        var label_info = this.body.data.nodes.get({\n          fields: ['label', 'hover_label'],\n          filter: function (item) {\n            return item.id === e.node\n          },\n          returnType :'Array'\n        });\n        this.body.data.nodes.update({\n          id: e.node,\n          label : label_info[0].hover_label,\n          hover_label : label_info[0].label\n        });\n      }","blurNode":"function(e){\n        var label_info = this.body.data.nodes.get({\n          fields: ['label', 'hover_label'],\n          filter: function (item) {\n            return item.id === e.node\n          },\n          returnType :'Array'\n        });\n        this.body.data.nodes.update({\n          id: e.node,\n          label : label_info[0].hover_label,\n          hover_label : label_info[0].label\n        });\n      }"}},"evals":["events.hoverNode","events.blurNode"],"jsHooks":[]}</script>
<pre><code>## [[1]]
## [1] TRUE
## 
## [[2]]
## [1] TRUE
## 
## [[3]]
## [1] TRUE</code></pre>
<p>Dangers:</p>
<ol style="list-style-type: decimal">
<li>In the first <code>make(bad_plan, jobs = 2)</code>, <code>drake</code> will try to build <code>my_data</code> and <code>my_analysis</code> at the same time even though <code>my_data</code> must finish before <code>my_analysis</code> begins.</li>
<li><code>Drake</code> is oblivious to <code>data.csv</code> since it is not explicitly mentioned in a workflow plan command. So when <code>data.csv</code> changes, <code>make(bad_plan)</code> will not rebuild <code>my_data</code>.</li>
<li><code>my_analysis</code> will not update when <code>my_data</code> changes.</li>
<li>The return value of <code>source()</code> is formatted counter-intuitively. If <code>source(file_in(&quot;get_data.R&quot;))</code> is the command for <code>my_data</code>, then <code>my_data</code> will always be a list with elements <code>&quot;value&quot;</code> and <code>&quot;visible&quot;</code>. In other words, <code>source(file_in(&quot;get_data.R&quot;))$value</code> is really what you would want.</li>
</ol>
<p>In addition, this <code>source()</code>-based approach is simply inconvenient. <code>Drake</code> rebuilds <code>my_data</code> every time <code>get_data.R</code> changes, even when those changes are just extra comments or blank lines. On the other hand, in the previous plan that uses <code>my_data = get_data()</code>, <code>drake</code> does not trigger rebuilds when comments or whitespace in <code>get_data()</code> are modified. <code>Drake</code> is R-focused, not file-focused. If you embrace this viewpoint, your work will be easier.</p>
</div>
<div id="file-output-targets" class="section level3">
<h3><span class="header-section-number">6.1.4</span> File output targets</h3>
<p>In your plan, the <code>file_out()</code> function tells <code>drake</code> that your target is an external file rather than an ordinary R object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="kw">writeLines</span>(<span class="dt">text =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>], <span class="dt">con =</span> <span class="kw">file_out</span>(<span class="st">&quot;file.txt&quot;</span>))
)
plan
## # A tibble: 1 x 2
##   target         command                                                  
##   &lt;chr&gt;          &lt;chr&gt;                                                    
## 1 &quot;\&quot;file.txt\&quot;&quot; &quot;writeLines(text = letters[1:6], con = file_out(\&quot;file.t…</code></pre></div>
<p>Now, <code>make()</code> knows to expect a file called <code>file.txt</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(plan)
## target file &quot;file.txt&quot;</code></pre></div>
<p>And if you manually mangle <code>file.txt</code> by accident, <code>make()</code> restores it to its reproducible state.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">writeLines</span>(<span class="dt">text =</span> <span class="st">&quot;123&quot;</span>, <span class="dt">con =</span> <span class="kw">file_out</span>(<span class="st">&quot;file.txt&quot;</span>))
<span class="kw">make</span>(plan)
## target file &quot;file.txt&quot;
<span class="kw">make</span>(plan)
## All targets are already up to date.</code></pre></div>
<p>But just because your command produces files does not mean you need to track them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(<span class="dt">real_output =</span> <span class="kw">long_job</span>())
<span class="kw">make</span>(plan)
<span class="kw">list.files</span>()
### [1] &quot;date-time.log&quot; &quot;error.log&quot; &quot;console.log&quot; </code></pre></div>
<p>These log files probably have nothing to do with the objectives of your research. If that is the case, you can safely ignore them with no loss of reproducibility.</p>
<p>Generally speaking, <code>drake</code> was designed to be as R-focused as possible, which means you should treat targets as R objects most of the time. External files are really an afterthought. This might be an uncomfortable notion. You may be accustomed to generating lots of files.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">drake_plan</span>(
  <span class="kw">write.csv</span>(<span class="kw">tabulate_results</span>(data), <span class="kw">file_out</span>(<span class="st">&quot;results.csv&quot;</span>)),
  <span class="kw">ggsave</span>(<span class="kw">my_ggplot</span>(data), <span class="dt">file =</span> <span class="kw">file_out</span>(<span class="st">&quot;plot.pdf&quot;</span>))
)
## # A tibble: 2 x 2
##   target            command                                               
##   &lt;chr&gt;             &lt;chr&gt;                                                 
## 1 &quot;\&quot;results.csv\&quot;&quot; &quot;write.csv(tabulate_results(data), file_out(\&quot;results…
## 2 &quot;\&quot;plot.pdf\&quot;&quot;    &quot;ggsave(my_ggplot(data), file = file_out(\&quot;plot.pdf\&quot;…</code></pre></div>
<p>But R object targets are much more convenient in the long run. If you really want to display them, consolidate them all in an R Markdown report at the end of the pipeline to reduce the number of output files.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">drake_plan</span>(
  <span class="dt">tab_results =</span> <span class="kw">tabulate_results</span>(data),
  <span class="dt">data_plot =</span> <span class="kw">my_ggplot</span>(data),
  rmarkdown<span class="op">::</span><span class="kw">render</span>(
    <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="co"># References tab_results` and data_plot in active code chunks using loadd() or readd().</span>
    <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>)
  )
)
## # A tibble: 3 x 2
##   target            command                                               
##   &lt;chr&gt;             &lt;chr&gt;                                                 
## 1 tab_results       tabulate_results(data)                                
## 2 data_plot         my_ggplot(data)                                       
## 3 &quot;\&quot;report.html\&quot;&quot; &quot;rmarkdown::render(knitr_in(\&quot;report.Rmd\&quot;), output_f…</code></pre></div>
<p>But sometimes, you may unavoidably have multiple important files for each target. For example, maybe you work with spatial data and use the <a href="https://github.com/r-spatial/sf"><code>sf</code> package</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_write</span>(spatial_data, <span class="st">&quot;spatial_data.shp&quot;</span>, <span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>)

### Creates:
###   - &quot;spatial_data.shp&quot;
###   - &quot;spatial_data.shx&quot;
###   - &quot;spatial_data.prj&quot;
###   - &quot;spatial_data.dbf&quot;</code></pre></div>
<p>Later targets may depend on many of these files, but there can only be one output file per target. So what do we do? Spoof <code>drake</code>: pick one file to be the real target, and let the other files be targets that depend on it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(drake)
<span class="kw">library</span>(magrittr)
<span class="kw">drake_plan</span>(
  <span class="kw">st_write</span>(spatial_data, <span class="kw">file_out</span>(<span class="st">&quot;spatial_data.shp&quot;</span>), <span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>),
  <span class="kw">c</span>(<span class="kw">file_out</span>(<span class="st">&quot;spatial_data.EXTN&quot;</span>), <span class="kw">file_in</span>(<span class="st">&quot;spatial_data.shp&quot;</span>)),
  <span class="dt">out =</span> <span class="kw">process_shx</span>(<span class="kw">file_in</span>(<span class="st">&quot;spatial_data.EXTN&quot;</span>))
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">evaluate_plan</span>(<span class="dt">wildcard =</span> <span class="st">&quot;EXTN&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;shx&quot;</span>, <span class="st">&quot;prj&quot;</span>, <span class="st">&quot;dbj&quot;</span>))
## # A tibble: 7 x 2
##   target                 command                                          
##   &lt;chr&gt;                  &lt;chr&gt;                                            
## 1 &quot;\&quot;spatial_data.shp\&quot;&quot; &quot;st_write(spatial_data, file_out(\&quot;spatial_data.…
## 2 &quot;\&quot;spatial_data.shx\&quot;&quot; &quot;c(file_out(\&quot;spatial_data.shx\&quot;), file_in(\&quot;spa…
## 3 &quot;\&quot;spatial_data.prj\&quot;&quot; &quot;c(file_out(\&quot;spatial_data.prj\&quot;), file_in(\&quot;spa…
## 4 &quot;\&quot;spatial_data.dbj\&quot;&quot; &quot;c(file_out(\&quot;spatial_data.dbj\&quot;), file_in(\&quot;spa…
## 5 out_shx                &quot;process_shx(file_in(\&quot;spatial_data.shx\&quot;))&quot;     
## 6 out_prj                &quot;process_shx(file_in(\&quot;spatial_data.prj\&quot;))&quot;     
## 7 out_dbj                &quot;process_shx(file_in(\&quot;spatial_data.dbj\&quot;))&quot;</code></pre></div>
<p>But be warned: If you manually mangle <code>spatial_data.shx</code>, <code>spatial_data.prj</code> or <code>spatial_data.dbj</code> later on, <code>make()</code> will not restore them. Having lots of output files can also slow down the construction of workflow plan data frames (ref: <a href="https://github.com/ropensci/drake/issues/366">issue 366</a>).</p>
<p>It may actually be safer to divide the workflow into two pipelines with separate caches and separate plans. That way, all the output files from the first pipeline, tracked or not tracked, become inputs to the second pipeline. An overarching R script can run both pipelines back to back.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plan1 &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="kw">st_write</span>(spatial_data, <span class="kw">file_out</span>(<span class="st">&quot;spatial_data.shp&quot;</span>), <span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>)
)
plan2 &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(<span class="dt">out =</span> <span class="kw">process_shx</span>(<span class="kw">file_in</span>(<span class="st">&quot;spatial_data.EXTN&quot;</span>)))<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">evaluate_plan</span>(<span class="dt">wildcard =</span> <span class="st">&quot;EXTN&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;shx&quot;</span>, <span class="st">&quot;prj&quot;</span>, <span class="st">&quot;dbj&quot;</span>))
cache1 &lt;-<span class="st"> </span><span class="kw">new_cache</span>(<span class="dt">path =</span> <span class="st">&quot;cache1&quot;</span>)
cache2 &lt;-<span class="st"> </span><span class="kw">new_cache</span>(<span class="dt">path =</span> <span class="st">&quot;cache2&quot;</span>)
<span class="kw">make</span>(plan1, <span class="dt">cache =</span> cache1)
<span class="kw">make</span>(plan2, <span class="dt">cache =</span> cache2)</code></pre></div>
<p>See the <a href="store.html#store">storage guide</a> for more on caching, particularly functions <code>get_cache()</code> and <code>this_cache()</code>.</p>
</div>
<div id="r-markdown-and-knitr-reports" class="section level3">
<h3><span class="header-section-number">6.1.5</span> R Markdown and knitr reports</h3>
<p>For a serious project, you should use <code>drake</code>’s <code>make()</code> function outside <code>knitr</code>. In other words, you should treat R Markdown reports and other <code>knitr</code> documents as targets and imports, not as a way to run <code>make()</code>. Viewed as targets, <code>drake</code> makes special exceptions for R Markdown reports and other <a href="https://github.com/yihui/knitr">knitr</a> reports such as <code>*.Rmd</code> and <code>*.Rnw</code> files. Not every <code>drake</code> project needs them, but it is good practice to use them to summarize the final results of a project once all the other targets have already been built. The mtcars example, for instance, has an R Markdown report. <code>report.Rmd</code> is knitted to build <code>report.md</code>, which summarizes the final results.</p>
<p>To see where <code>report.md</code> will be built, look to the right of the dependency graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load_mtcars_example</span>(<span class="dt">overwrite =</span> <span class="ot">TRUE</span>) <span class="co"># Get the code with drake_example(&quot;mtcars&quot;).</span>
## Warning in load_mtcars_example(overwrite = TRUE): Overwriting file
## &#39;report.Rmd&#39;.
config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(my_plan)
<span class="kw">vis_drake_graph</span>(config)</code></pre></div>
<div id="htmlwidget-dda5858bd620d236e22c" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-dda5858bd620d236e22c">{"x":{"nodes":{"id":["nrow","sample.int","data.frame","mtcars","random_rows","lm","x","y","x2","summary","coef_regression2_small","knit","large","\"report.Rmd\"","small","simulate","reg1","reg2","regression1_small","suppressWarnings","regression1_large","regression2_small","regression2_large","\"report.md\"","summ_regression1_small","summ_regression1_large","summ_regression2_small","summ_regression2_large","coef_regression1_small","coef_regression1_large","coef_regression2_large"],"label":["nrow\n0.006s","sample.int\n0.006s","data.frame\n0.021s","mtcars\n0.001s","random_rows\n0.001s","lm\n0.007s","x\n0.001s","y\n0.001s","x2\n0.001s","summary\n0.006s","coef_regression2_small","knit\n0.016s","large","\"report.Rmd\"\n0.002s","small","simulate\n0.002s","reg1\n0.001s","reg2\n0.001s","regression1_small","suppressWarnings\n0.007s","regression1_large","regression2_small","regression2_large","\"report.md\"","summ_regression1_small","summ_regression1_large","summ_regression2_small","summ_regression2_large","coef_regression1_small","coef_regression1_large","coef_regression2_large"],"status":["imported","imported","imported","imported","imported","imported","missing","missing","missing","imported","outdated","imported","outdated","imported","outdated","imported","imported","imported","outdated","imported","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["function","function","function","object","function","function","object","object","object","function","object","function","object","file","object","function","function","function","object","function","object","object","object","file","object","object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#9A32CD","#9A32CD","#9A32CD","#1874CD","#000000","#1874CD","#000000","#1874CD","#000000","#1874CD","#1874CD","#1874CD","#000000","#1874CD","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["triangle","triangle","triangle","dot","triangle","triangle","dot","dot","dot","triangle","dot","triangle","dot","square","dot","triangle","triangle","triangle","dot","triangle","dot","dot","dot","square","dot","dot","dot","dot","dot","dot","dot"],"level":[1,1,1,1,2,1,1,1,1,1,6,1,4,1,4,3,2,2,5,1,5,5,5,7,6,6,6,6,6,6,6],"hover_label":["function (x) \ndim(x)[1L]","function (n, size = n, replace = FALSE, prob = NULL, useHash = (!replace && \n    is.null(prob) && size <= n/2 && n > 1e+07)) \n{\n    if (useHash) \n        .Internal(sample2(n, size))\n    else .Internal(sample(n, size, replace, prob))\n}","function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE, \n    fix.empty.names = TRUE, stringsAsFactors = default.stringsAsFactors()) \n{\n    data.row.names <- if (check.rows && is.null(row.names)) \n        function(current, new, i) ...","mtcars","function (data, n) \n{\n    data[sample.int(n = nrow(data), size = n, replace = TRUE), \n        ]\n}","function (formula, data, subset, weights, na.action, method = \"qr\", \n    model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, \n    contrasts = NULL, offset, ...) \n{\n    ret.x <- x\n    ret.y <- y\n    cl <- match.call()\n    mf <- match...","x","y","x2","function (object, ...) \nUseMethod(\"summary\")","suppressWarnings(summary(regression2_small))$coefficients","function (input, output = NULL, tangle = FALSE, text = NULL, \n    quiet = FALSE, envir = parent.frame(), encoding = getOption(\"encoding\")) \n{\n    in.file = !missing(input) && (is.character(input) || prod(inherits(input, \n        c(\"file\", \"connect...","simulate(64)","---\ntitle: \"Final results report for the mtcars example\"\nauthor: You\noutput: html_document\n---\n\n# The weight and fuel efficiency of cars\n\nIs there an association between the weight and the fuel efficiency of cars? To find out, we use the `mtcars` ...","simulate(48)","function (n) \n{\n    data <- random_rows(data = mtcars, n = n)\n    data.frame(x = data$wt, y = data$mpg)\n}","function (d) \n{\n    lm(y ~ +x, data = d)\n}","function (d) \n{\n    d$x2 <- d$x^2\n    lm(y ~ x2, data = d)\n}","reg1(small)","function (expr) \n{\n    ops <- options(warn = -1)\n    on.exit(options(ops))\n    withCallingHandlers(expr, warning = function(w) invokeRestart(\"muffleWarning\"))\n}","reg1(large)","reg2(small)","reg2(large)","knit(knitr_in(\"report.Rmd\"), file_out(\"report.md\"), quiet = TRUE)","suppressWarnings(summary(regression1_small$residuals))","suppressWarnings(summary(regression1_large$residuals))","suppressWarnings(summary(regression2_small$residuals))","suppressWarnings(summary(regression2_large$residuals))","suppressWarnings(summary(regression1_small))$coefficients","suppressWarnings(summary(regression1_large))$coefficients","suppressWarnings(summary(regression2_large))$coefficients"],"x":[-0.685714285714286,-0.742857142857143,-0.628571428571429,-0.8,-0.142857142857143,0.771428571428571,0.828571428571429,0.428571428571429,-0.571428571428571,0,-0.8,-1,0.371428571428571,-0.857142857142857,-0.342857142857143,0,0.6,0.142857142857143,0.0571428571428572,0.0571428571428572,0.914285714285714,-0.4,0.571428571428571,-0.4,-0.142857142857143,1,-0.0285714285714286,0.685714285714286,0.114285714285714,0.6,0.485714285714286],"y":[-1,-1,-1,-1,-0.666666666666667,-1,-1,-1,-1,-1,0.666666666666667,-1,0,-1,0,-0.333333333333333,-0.666666666666667,-0.666666666666667,0.333333333333333,-1,0.333333333333333,0.333333333333333,0.333333333333333,1,0.666666666666667,0.666666666666667,0.666666666666667,0.666666666666667,0.666666666666667,0.666666666666667,0.666666666666667]},"edges":{"from":["nrow","sample.int","data.frame","mtcars","random_rows","lm","lm","x","y","y","x2","summary","summary","summary","summary","summary","summary","summary","summary","coef_regression2_small","knit","large","large","large","\"report.Rmd\"","small","small","small","simulate","simulate","reg1","reg1","reg2","reg2","regression1_small","regression1_small","suppressWarnings","suppressWarnings","suppressWarnings","suppressWarnings","suppressWarnings","suppressWarnings","suppressWarnings","suppressWarnings","regression1_large","regression1_large","regression2_small","regression2_small","regression2_large","regression2_large"],"to":["random_rows","random_rows","simulate","simulate","simulate","reg1","reg2","reg1","reg1","reg2","reg2","coef_regression2_small","summ_regression1_small","summ_regression1_large","summ_regression2_small","summ_regression2_large","coef_regression1_small","coef_regression1_large","coef_regression2_large","\"report.md\"","\"report.md\"","regression1_large","regression2_large","\"report.md\"","\"report.md\"","regression1_small","regression2_small","\"report.md\"","large","small","regression1_small","regression1_large","regression2_small","regression2_large","summ_regression1_small","coef_regression1_small","coef_regression2_small","summ_regression1_small","summ_regression1_large","summ_regression2_small","summ_regression2_large","coef_regression1_small","coef_regression1_large","coef_regression2_large","summ_regression1_large","coef_regression1_large","coef_regression2_small","summ_regression2_small","summ_regression2_large","coef_regression2_large"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true,"hover":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","In progress","Failed","Imported","Missing","Object","Function","File"],"color":["#228B22","#000000","#FF7221","#AA0000","#1874CD","#9A32CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","dot","dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black","black","black","black","black"],"font.size":[20,20,20,20,20,20,20,20,20],"id":[1,2,3,4,5,6,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","events":{"hoverNode":"function(e){\n        var label_info = this.body.data.nodes.get({\n          fields: ['label', 'hover_label'],\n          filter: function (item) {\n            return item.id === e.node\n          },\n          returnType :'Array'\n        });\n        this.body.data.nodes.update({\n          id: e.node,\n          label : label_info[0].hover_label,\n          hover_label : label_info[0].label\n        });\n      }","blurNode":"function(e){\n        var label_info = this.body.data.nodes.get({\n          fields: ['label', 'hover_label'],\n          filter: function (item) {\n            return item.id === e.node\n          },\n          returnType :'Array'\n        });\n        this.body.data.nodes.update({\n          id: e.node,\n          label : label_info[0].hover_label,\n          hover_label : label_info[0].label\n        });\n      }"}},"evals":["events.hoverNode","events.blurNode"],"jsHooks":[]}</script>
<p><code>Drake</code> treats <a href="https://github.com/yihui/knitr">knitr</a> report as a special cases. Whenever <code>drake</code> sees <code>knit()</code> or <code>render()</code> (<a href="https://github.com/rstudio/rmarkdown">rmarkdown</a>) mentioned in a command, it dives into the source file to look for dependencies. Consider <code>report.Rmd</code>, which you can view <a href="https://github.com/ropensci/drake/blob/master/inst/examples/mtcars/report.Rmd">here</a>. When <code>drake</code> sees <code>readd(small)</code> in an active code chunk, it knows <a href="https://github.com/ropensci/drake/blob/master/inst/examples/mtcars/report.Rmd">report.Rmd</a> depends on the target called <code>small</code>, and it draws the appropriate arrow in the dependency graph above. And if <code>small</code> ever changes, <code>make(my_plan)</code> will re-process <a href="https://github.com/ropensci/drake/blob/master/inst/examples/mtcars/report.Rmd">report.Rmd</a> to produce the target file <code>report.md</code>.</p>
<p><a href="https://github.com/yihui/knitr">knitr</a> reports are the only kind of file that <code>drake</code> analyzes for dependencies. It does not give R scripts the same special treatment.</p>
</div>
<div id="workflows-as-r-packages" class="section level3">
<h3><span class="header-section-number">6.1.6</span> Workflows as R packages</h3>
<p>The R package structure is a great way to organize the files of your project. Writing your own package to contain your data science workflow is a good idea, but you will need to</p>
<ol style="list-style-type: decimal">
<li>Use <code>expose_imports()</code> to properly account for all your nested function dependencies, and</li>
<li>If you load the package with <code>devtools::load_all()</code>, set the <code>prework</code> argument of <code>make()</code>: e.g. <code>make(prework = &quot;devtools::load_all()&quot;)</code>.</li>
</ol>
<p>Thanks to <a href="https://github.com/dapperjapper">Jasper Clarkberg</a> for the workaround behind <code>expose_imports()</code>.</p>
<div id="advantages-of-putting-workflows-in-r-packages" class="section level4">
<h4><span class="header-section-number">6.1.6.1</span> Advantages of putting workflows in R packages</h4>
<ul>
<li>The file organization of R packages is a well-understood community standard. If you follow it, your work may be more readable and thus reproducible.</li>
<li>R package installation is a standard process. The system makes it easier for others to obtain and run your code.</li>
<li>You get development and quality control tools for free: <a href="https://github.com/hadley/devtools">helpers for loading code and creating files</a>, <a href="http://r-pkgs.had.co.nz/tests.html">unit testing</a>, <a href="http://r-pkgs.had.co.nz/check.html">package checks</a>, <a href="https://github.com/r-lib/covr">code coverage</a>, and <a href="https://ipub.com/continuous-integration-for-r/">continuous integration</a>.</li>
</ul>
</div>
<div id="the-problem" class="section level4">
<h4><span class="header-section-number">6.1.6.2</span> The problem</h4>
<p>For <code>drake</code>, there is one problem: nested functions. <code>Drake</code> always looks for imported functions nested in other imported functions, but only in your environment. When it sees a function from a package, it does not look in its body for other imports.</p>
<p>To see this, consider the <code>digest()</code> function from the <a href="https://github.com/eddelbuettel/digest"><code>digest</code> package</a>. <a href="https://github.com/eddelbuettel/digest"><code>Digest</code> package</a> is a utility for computing hashes, not a data science workflow, but I will use it to demonstrate how <code>drake</code> treats imports from packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(digest)
g &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  <span class="kw">digest</span>(x)
}
f &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  <span class="kw">g</span>(x)
}
plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(<span class="dt">x =</span> <span class="kw">f</span>(<span class="dv">1</span>))

## Here are the reproducibly tracked objects in the workflow.
<span class="kw">tracked</span>(plan)
## [1] &quot;x&quot;      &quot;g&quot;      &quot;digest&quot; &quot;f&quot;

## But the `digest()` function has dependencies too.
## Because `drake` knows `digest()` is from a package,
## it ignores these dependencies by default.
<span class="kw">head</span>(<span class="kw">deps_code</span>(digest), <span class="dv">10</span>)
##  [1] &quot;any&quot;             &quot;as.integer&quot;      &quot;as.raw&quot;         
##  [4] &quot;base::serialize&quot; &quot;.Call&quot;           &quot;digest_impl&quot;    
##  [7] &quot;.errorhandler&quot;   &quot;file.access&quot;     &quot;file.exists&quot;    
## [10] &quot;file.info&quot;</code></pre></div>
</div>
<div id="the-solution" class="section level4">
<h4><span class="header-section-number">6.1.6.3</span> The solution</h4>
<p>To force <code>drake</code> to dive deeper into the nested functions in a package, you must use <code>expose_imports()</code>. Again, I demonstrate with the <a href="https://github.com/eddelbuettel/digest"><code>digest</code> package</a> package, but you should really only do this with a package you write yourself to contain your workflow. For external packages, <a href="https://rstudio.github.io/packrat/">packrat</a> is a much better solution for package reproducibility.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">expose_imports</span>(digest)
## &lt;environment: R_GlobalEnv&gt;
new_objects &lt;-<span class="st"> </span><span class="kw">tracked</span>(plan)
<span class="kw">head</span>(new_objects, <span class="dv">10</span>)
##  [1] &quot;digest&quot;     &quot;return&quot;     &quot;as.integer&quot; &quot;as.raw&quot;     &quot;.Call&quot;     
##  [6] &quot;match.arg&quot;  &quot;stop&quot;       &quot;warning&quot;    &quot;formals&quot;    &quot;isTRUE&quot;
<span class="kw">length</span>(new_objects)
## [1] 32

## Now when you call `make()`, `drake` will dive into `digest`
## to import dependencies.

cache &lt;-<span class="st"> </span>storr<span class="op">::</span><span class="kw">storr_environment</span>() <span class="co"># just for examples</span>
<span class="kw">make</span>(plan, <span class="dt">cache =</span> cache)
## target x
<span class="kw">head</span>(<span class="kw">cached</span>(<span class="dt">cache =</span> cache), <span class="dv">10</span>)
##  [1] &quot;any&quot;             &quot;as.integer&quot;      &quot;as.raw&quot;         
##  [4] &quot;base::serialize&quot; &quot;digest&quot;          &quot;digest_impl&quot;    
##  [7] &quot;f&quot;               &quot;file.access&quot;     &quot;file.exists&quot;    
## [10] &quot;file.info&quot;
<span class="kw">length</span>(<span class="kw">cached</span>(<span class="dt">cache =</span> cache))
## [1] 30</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
</div>
<div id="generating-workflow-plan-data-frames" class="section level2">
<h2><span class="header-section-number">6.2</span> Generating workflow plan data frames</h2>
<p><code>Drake</code> has the following functions to generate workflow plan data frames (the <code>plan</code> argument of <code>make()</code>, where you list your targets and commands).</p>
<ul>
<li><code>drake_plan()</code></li>
<li><code>evaluate_plan()</code></li>
<li><code>expand_plan()</code></li>
<li><code>gather_plan()</code></li>
<li><code>reduce_plan()</code></li>
<li><code>plan_analyses()</code></li>
<li><code>plan_summaries()</code></li>
</ul>
<p>Except for <code>drake_plan()</code>, they all use wildcards as templates. For example, suppose your workflow checks several metrics of several schools. The idea is to write a workflow plan with your metrics and let the wildcard templating expand over the available schools.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hard_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">credits =</span> <span class="kw">check_credit_hours</span>(school__),
  <span class="dt">students =</span> <span class="kw">check_students</span>(school__),
  <span class="dt">grads =</span> <span class="kw">check_graduations</span>(school__),
  <span class="dt">public_funds =</span> <span class="kw">check_public_funding</span>(school__)
)

<span class="kw">evaluate_plan</span>(
  hard_plan,
  <span class="dt">rules =</span> <span class="kw">list</span>(<span class="dt">school__ =</span> <span class="kw">c</span>(<span class="st">&quot;schoolA&quot;</span>, <span class="st">&quot;schoolB&quot;</span>, <span class="st">&quot;schoolC&quot;</span>))
)
## # A tibble: 12 x 2
##    target               command                      
##    &lt;chr&gt;                &lt;chr&gt;                        
##  1 credits_schoolA      check_credit_hours(schoolA)  
##  2 credits_schoolB      check_credit_hours(schoolB)  
##  3 credits_schoolC      check_credit_hours(schoolC)  
##  4 students_schoolA     check_students(schoolA)      
##  5 students_schoolB     check_students(schoolB)      
##  6 students_schoolC     check_students(schoolC)      
##  7 grads_schoolA        check_graduations(schoolA)   
##  8 grads_schoolB        check_graduations(schoolB)   
##  9 grads_schoolC        check_graduations(schoolC)   
## 10 public_funds_schoolA check_public_funding(schoolA)
## 11 public_funds_schoolB check_public_funding(schoolB)
## 12 public_funds_schoolC check_public_funding(schoolC)</code></pre></div>
<p>But what if some metrics do not make sense? For example, what if <code>schoolC</code> is a completely privately-funded school? With no public funds, <code>check_public_funds(schoolC)</code> may quit in error if we are not careful. This is where setting up workflow plans requires a little creativity. In this case, we recommend that you use two wildcards: one for all the schools and another for just the public schools. The new plan has no twelfth row.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plan_template &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">credits =</span> <span class="kw">check_credit_hours</span>(all_schools__),
  <span class="dt">students =</span> <span class="kw">check_students</span>(all_schools__),
  <span class="dt">grads =</span> <span class="kw">check_graduations</span>(all_schools__),
  <span class="dt">public_funds =</span> <span class="kw">check_public_funding</span>(public_schools__)
)
<span class="kw">evaluate_plan</span>(
  <span class="dt">plan =</span> plan_template,
  <span class="dt">rules =</span> <span class="kw">list</span>(
    <span class="dt">all_schools__ =</span>  <span class="kw">c</span>(<span class="st">&quot;schoolA&quot;</span>, <span class="st">&quot;schoolB&quot;</span>, <span class="st">&quot;schoolC&quot;</span>),
    <span class="dt">public_schools__ =</span> <span class="kw">c</span>(<span class="st">&quot;schoolA&quot;</span>, <span class="st">&quot;schoolB&quot;</span>)
  )
)
## # A tibble: 11 x 2
##    target               command                      
##    &lt;chr&gt;                &lt;chr&gt;                        
##  1 credits_schoolA      check_credit_hours(schoolA)  
##  2 credits_schoolB      check_credit_hours(schoolB)  
##  3 credits_schoolC      check_credit_hours(schoolC)  
##  4 students_schoolA     check_students(schoolA)      
##  5 students_schoolB     check_students(schoolB)      
##  6 students_schoolC     check_students(schoolC)      
##  7 grads_schoolA        check_graduations(schoolA)   
##  8 grads_schoolB        check_graduations(schoolB)   
##  9 grads_schoolC        check_graduations(schoolC)   
## 10 public_funds_schoolA check_public_funding(schoolA)
## 11 public_funds_schoolB check_public_funding(schoolB)</code></pre></div>
<p>Thanks to <a href="https://github.com/AlexAxthelm">Alex Axthelm</a> for this use case in <a href="https://github.com/ropensci/drake/issues/235">issue 235</a>.</p>
</div>
<div id="remote-data-sources" class="section level2">
<h2><span class="header-section-number">6.3</span> Remote data sources</h2>
<p>Some workflows rely on remote data from the internet, and the workflow needs to refresh when the datasets change. As an example, let us consider the download logs of <a href="https://cran.r-project.org/">CRAN packages</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(drake)
<span class="kw">library</span>(R.utils) <span class="co"># For unzipping the files we download.</span>
<span class="kw">library</span>(curl)    <span class="co"># For downloading data.</span>
<span class="kw">library</span>(httr)    <span class="co"># For querying websites.</span>

url &lt;-<span class="st"> &quot;http://cran-logs.rstudio.com/2018/2018-02-09-r.csv.gz&quot;</span></code></pre></div>
<p>How do we know when the data at the URL changed? We get the time that the file was last modified. (Alternatively, we could use an HTTP ETag.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">query &lt;-<span class="st"> </span><span class="kw">HEAD</span>(url)
timestamp &lt;-<span class="st"> </span>query<span class="op">$</span>headers[[<span class="st">&quot;last-modified&quot;</span>]]
timestamp
## [1] &quot;Mon, 12 Feb 2018 16:34:48 GMT&quot;</code></pre></div>
<p>In our workflow plan, the timestamp is a target and a dependency. When the timestamp changes, so does everything downstream.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cranlogs_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">timestamp =</span> <span class="kw">HEAD</span>(url)<span class="op">$</span>headers[[<span class="st">&quot;last-modified&quot;</span>]],
  <span class="dt">logs =</span> <span class="kw">get_logs</span>(url, timestamp),
  <span class="dt">strings_in_dots =</span> <span class="st">&quot;literals&quot;</span>
)
cranlogs_plan
## # A tibble: 2 x 2
##   target    command                                 
##   &lt;chr&gt;     &lt;chr&gt;                                   
## 1 timestamp &quot;HEAD(url)$headers[[\&quot;last-modified\&quot;]]&quot;
## 2 logs      get_logs(url, timestamp)</code></pre></div>
<p>To make sure we always have the latest timestamp, we use the <code>&quot;always&quot;</code> trigger. (For more on triggers, see the <a href="debug.html#debug">guide to debugging and testing drake projects</a>.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cranlogs_plan<span class="op">$</span>trigger &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;always&quot;</span>, <span class="st">&quot;any&quot;</span>)
cranlogs_plan
## # A tibble: 2 x 3
##   target    command                                  trigger
##   &lt;chr&gt;     &lt;chr&gt;                                    &lt;chr&gt;  
## 1 timestamp &quot;HEAD(url)$headers[[\&quot;last-modified\&quot;]]&quot; always 
## 2 logs      get_logs(url, timestamp)                 any</code></pre></div>
<p>Lastly, we define the <code>get_logs()</code> function, which actually downloads the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## The ... is just so we can write dependencies as function arguments
## in the workflow plan.
get_logs &lt;-<span class="st"> </span><span class="cf">function</span>(url, ...){
  <span class="kw">curl_download</span>(url, <span class="st">&quot;logs.csv.gz&quot;</span>)       <span class="co"># Get a big file.</span>
  <span class="kw">gunzip</span>(<span class="st">&quot;logs.csv.gz&quot;</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>) <span class="co"># Unzip it.</span>
  out &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;logs.csv&quot;</span>, <span class="dt">nrows =</span> <span class="dv">4</span>)  <span class="co"># Extract the data you need.</span>
  <span class="kw">unlink</span>(<span class="kw">c</span>(<span class="st">&quot;logs.csv.gz&quot;</span>, <span class="st">&quot;logs.csv&quot;</span>))    <span class="co"># Remove the big files</span>
  out                                     <span class="co"># Value of the target.</span>
}</code></pre></div>
<p>When we are ready, we run the workflow.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(cranlogs_plan)
## Unloading targets from environment:
##   timestamp
## target timestamp: trigger &quot;always&quot;
## target logs
## Used non-default triggers. Some targets may not be up to date.

<span class="kw">readd</span>(logs)
##         date     time     size version  os country ip_id
## 1 2018-02-09 13:01:13 82375220   3.4.3 win      RO     1
## 2 2018-02-09 13:02:06 74286541   3.3.3 win      US     2
## 3 2018-02-09 13:02:10 82375216   3.4.3 win      US     3
## 4 2018-02-09 13:03:30 82375220   3.4.3 win      IS     4</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mtcars.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="debug.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
