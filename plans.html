<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 drake plans | The drake R Package User Manual</title>
  <meta name="description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 drake plans | The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://books.ropensci.org/drake/" />
  <meta property="og:image" content="https://books.ropensci.org/drake//images/logo.png" />
  <meta property="og:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="github-repo" content="ropensci-books/drake" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 drake plans | The drake R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="twitter:image" content="https://books.ropensci.org/drake//images/logo.png" />

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert, Ellis Hughes, Matthew Mark Strasiotto" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="walkthrough.html"/>
<link rel="next" href="static.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150843595-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150843595-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="https://ropensci.github.io/dev_guide/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The drake R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#short-version"><i class="fa fa-check"></i><b>1.1</b> Short version</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#long-version"><i class="fa fa-check"></i><b>1.2</b> Long version</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.3</b> The drake R package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.4</b> Installation</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.5</b> Why drake?</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.5.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.5.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#scale-up-and-out."><i class="fa fa-check"></i><b>1.5.3</b> Scale up and out.</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#with-docker"><i class="fa fa-check"></i><b>1.6</b> With Docker</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.7</b> Documentation</a><ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.7.1</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.7.2</b> Function reference</a></li>
<li class="chapter" data-level="1.7.3" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.7.3</b> Tutorials</a></li>
<li class="chapter" data-level="1.7.4" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.7.4</b> Examples</a></li>
<li class="chapter" data-level="1.7.5" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.7.5</b> Presentations</a></li>
<li class="chapter" data-level="1.7.6" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.7.6</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.8</b> Help and troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="similar-work.html"><a href="similar-work.html"><i class="fa fa-check"></i><b>2</b> Similar work</a><ul>
<li class="chapter" data-level="2.1" data-path="similar-work.html"><a href="similar-work.html#pipeline-tools"><i class="fa fa-check"></i><b>2.1</b> Pipeline tools</a><ul>
<li class="chapter" data-level="2.1.1" data-path="similar-work.html"><a href="similar-work.html#gnu-make"><i class="fa fa-check"></i><b>2.1.1</b> GNU Make</a></li>
<li class="chapter" data-level="2.1.2" data-path="similar-work.html"><a href="similar-work.html#remake"><i class="fa fa-check"></i><b>2.1.2</b> Remake</a></li>
<li class="chapter" data-level="2.1.3" data-path="similar-work.html"><a href="similar-work.html#factuals-drake"><i class="fa fa-check"></i><b>2.1.3</b> Factual’s Drake</a></li>
<li class="chapter" data-level="2.1.4" data-path="similar-work.html"><a href="similar-work.html#other-pipeline-tools"><i class="fa fa-check"></i><b>2.1.4</b> Other pipeline tools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="similar-work.html"><a href="similar-work.html#memoization"><i class="fa fa-check"></i><b>2.2</b> Memoization</a></li>
<li class="chapter" data-level="2.3" data-path="similar-work.html"><a href="similar-work.html#literate-programming"><i class="fa fa-check"></i><b>2.3</b> Literate programming</a><ul>
<li class="chapter" data-level="2.3.1" data-path="similar-work.html"><a href="similar-work.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>2.3.1</b> knitr and R Markdown</a></li>
<li class="chapter" data-level="2.3.2" data-path="similar-work.html"><a href="similar-work.html#version-control"><i class="fa fa-check"></i><b>2.3.2</b> Version control</a></li>
<li class="chapter" data-level="2.3.3" data-path="similar-work.html"><a href="similar-work.html#containerization-and-r-package-environments"><i class="fa fa-check"></i><b>2.3.3</b> Containerization and R package environments</a></li>
<li class="chapter" data-level="2.3.4" data-path="similar-work.html"><a href="similar-work.html#workflowr"><i class="fa fa-check"></i><b>2.3.4</b> workflowr</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="similar-work.html"><a href="similar-work.html#acknowledgements"><i class="fa fa-check"></i><b>2.4</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="3" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>3</b> Walkthrough</a><ul>
<li class="chapter" data-level="3.1" data-path="walkthrough.html"><a href="walkthrough.html#set-the-stage."><i class="fa fa-check"></i><b>3.1</b> Set the stage.</a></li>
<li class="chapter" data-level="3.2" data-path="walkthrough.html"><a href="walkthrough.html#make-your-results."><i class="fa fa-check"></i><b>3.2</b> Make your results.</a></li>
<li class="chapter" data-level="3.3" data-path="walkthrough.html"><a href="walkthrough.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>3.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="3.4" data-path="walkthrough.html"><a href="walkthrough.html#history-and-provenance"><i class="fa fa-check"></i><b>3.4</b> History and provenance</a></li>
<li class="chapter" data-level="3.5" data-path="walkthrough.html"><a href="walkthrough.html#reproducible-data-recovery-and-renaming"><i class="fa fa-check"></i><b>3.5</b> Reproducible data recovery and renaming</a><ul>
<li class="chapter" data-level="3.5.1" data-path="walkthrough.html"><a href="walkthrough.html#undoing-clean"><i class="fa fa-check"></i><b>3.5.1</b> Undoing <code>clean()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="walkthrough.html"><a href="walkthrough.html#renaming"><i class="fa fa-check"></i><b>3.5.2</b> Renaming</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="walkthrough.html"><a href="walkthrough.html#try-the-code-yourself"><i class="fa fa-check"></i><b>3.6</b> Try the code yourself!</a></li>
<li class="chapter" data-level="3.7" data-path="walkthrough.html"><a href="walkthrough.html#thanks"><i class="fa fa-check"></i><b>3.7</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>4</b> <code>drake</code> plans</a><ul>
<li class="chapter" data-level="4.1" data-path="plans.html"><a href="plans.html#functions"><i class="fa fa-check"></i><b>4.1</b> Functions</a></li>
<li class="chapter" data-level="4.2" data-path="plans.html"><a href="plans.html#intro-to-plans"><i class="fa fa-check"></i><b>4.2</b> Intro to plans</a></li>
<li class="chapter" data-level="4.3" data-path="plans.html"><a href="plans.html#how-to-choose-good-targets"><i class="fa fa-check"></i><b>4.3</b> How to choose good targets</a></li>
<li class="chapter" data-level="4.4" data-path="plans.html"><a href="plans.html#special-data-formats-for-targets"><i class="fa fa-check"></i><b>4.4</b> Special data formats for targets</a></li>
<li class="chapter" data-level="4.5" data-path="plans.html"><a href="plans.html#special-columns"><i class="fa fa-check"></i><b>4.5</b> Special columns</a></li>
<li class="chapter" data-level="4.6" data-path="plans.html"><a href="plans.html#static-files"><i class="fa fa-check"></i><b>4.6</b> Static files</a><ul>
<li class="chapter" data-level="4.6.1" data-path="plans.html"><a href="plans.html#urls"><i class="fa fa-check"></i><b>4.6.1</b> URLs</a></li>
<li class="chapter" data-level="4.6.2" data-path="plans.html"><a href="plans.html#limitations-of-static-files"><i class="fa fa-check"></i><b>4.6.2</b> Limitations of static files</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="plans.html"><a href="plans.html#dynamic-files"><i class="fa fa-check"></i><b>4.7</b> Dynamic files</a><ul>
<li class="chapter" data-level="4.7.1" data-path="plans.html"><a href="plans.html#how-to-use-dynamic-files"><i class="fa fa-check"></i><b>4.7.1</b> How to use dynamic files</a></li>
<li class="chapter" data-level="4.7.2" data-path="plans.html"><a href="plans.html#example-of-dynamic-files"><i class="fa fa-check"></i><b>4.7.2</b> Example of dynamic files</a></li>
<li class="chapter" data-level="4.7.3" data-path="plans.html"><a href="plans.html#limitations-of-dynamic-files"><i class="fa fa-check"></i><b>4.7.3</b> Limitations of dynamic files</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="plans.html"><a href="plans.html#large-plans"><i class="fa fa-check"></i><b>4.8</b> Large plans</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="static.html"><a href="static.html"><i class="fa fa-check"></i><b>5</b> Static branching</a><ul>
<li class="chapter" data-level="5.1" data-path="static.html"><a href="static.html#why-static-branching"><i class="fa fa-check"></i><b>5.1</b> Why static branching?</a></li>
<li class="chapter" data-level="5.2" data-path="static.html"><a href="static.html#grouping-variables"><i class="fa fa-check"></i><b>5.2</b> Grouping variables</a><ul>
<li class="chapter" data-level="5.2.1" data-path="static.html"><a href="static.html#limitations-of-grouping-variables"><i class="fa fa-check"></i><b>5.2.1</b> Limitations of grouping variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="static.html"><a href="static.html#tidy-evaluation"><i class="fa fa-check"></i><b>5.3</b> Tidy evaluation</a></li>
<li class="chapter" data-level="5.4" data-path="static.html"><a href="static.html#static-transformations"><i class="fa fa-check"></i><b>5.4</b> Static transformations</a><ul>
<li class="chapter" data-level="5.4.1" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>5.4.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="5.4.2" data-path="static.html"><a href="static.html#cross"><i class="fa fa-check"></i><b>5.4.2</b> <code>cross()</code></a></li>
<li class="chapter" data-level="5.4.3" data-path="static.html"><a href="static.html#split"><i class="fa fa-check"></i><b>5.4.3</b> <code>split()</code></a></li>
<li class="chapter" data-level="5.4.4" data-path="static.html"><a href="static.html#combine"><i class="fa fa-check"></i><b>5.4.4</b> <code>combine()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="static.html"><a href="static.html#tags"><i class="fa fa-check"></i><b>5.5</b> Tags</a><ul>
<li class="chapter" data-level="5.5.1" data-path="static.html"><a href="static.html#target-names"><i class="fa fa-check"></i><b>5.5.1</b> Target names</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>6</b> Dynamic branching</a><ul>
<li class="chapter" data-level="6.1" data-path="dynamic.html"><a href="dynamic.html#a-note-about-versions"><i class="fa fa-check"></i><b>6.1</b> A note about versions</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic.html"><a href="dynamic.html#motivation"><i class="fa fa-check"></i><b>6.2</b> Motivation</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic.html"><a href="dynamic.html#which-kind-of-branching-should-i-use"><i class="fa fa-check"></i><b>6.3</b> Which kind of branching should I use?</a></li>
<li class="chapter" data-level="6.4" data-path="dynamic.html"><a href="dynamic.html#dynamic-targets"><i class="fa fa-check"></i><b>6.4</b> Dynamic targets</a></li>
<li class="chapter" data-level="6.5" data-path="dynamic.html"><a href="dynamic.html#dynamic-transformations"><i class="fa fa-check"></i><b>6.5</b> Dynamic transformations</a><ul>
<li class="chapter" data-level="6.5.1" data-path="dynamic.html"><a href="dynamic.html#map-1"><i class="fa fa-check"></i><b>6.5.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="dynamic.html"><a href="dynamic.html#cross-1"><i class="fa fa-check"></i><b>6.5.2</b> <code>cross()</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="dynamic.html"><a href="dynamic.html#group"><i class="fa fa-check"></i><b>6.5.3</b> <code>group()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="dynamic.html"><a href="dynamic.html#trace"><i class="fa fa-check"></i><b>6.6</b> Trace</a></li>
<li class="chapter" data-level="6.7" data-path="dynamic.html"><a href="dynamic.html#max_expand"><i class="fa fa-check"></i><b>6.7</b> <code>max_expand</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>7</b> <code>drake</code> projects</a><ul>
<li class="chapter" data-level="7.1" data-path="projects.html"><a href="projects.html#code-files"><i class="fa fa-check"></i><b>7.1</b> Code files</a></li>
<li class="chapter" data-level="7.2" data-path="projects.html"><a href="projects.html#safer-interactivity"><i class="fa fa-check"></i><b>7.2</b> Safer interactivity</a><ul>
<li class="chapter" data-level="7.2.1" data-path="projects.html"><a href="projects.html#motivation-1"><i class="fa fa-check"></i><b>7.2.1</b> Motivation</a></li>
<li class="chapter" data-level="7.2.2" data-path="projects.html"><a href="projects.html#usage"><i class="fa fa-check"></i><b>7.2.2</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="projects.html"><a href="projects.html#script-file-pitfalls"><i class="fa fa-check"></i><b>7.3</b> Script file pitfalls</a></li>
<li class="chapter" data-level="7.4" data-path="projects.html"><a href="projects.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>7.4</b> Workflows as R packages</a></li>
<li class="chapter" data-level="7.5" data-path="projects.html"><a href="projects.html#other-tools"><i class="fa fa-check"></i><b>7.5</b> Other tools</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="scripts.html"><a href="scripts.html"><i class="fa fa-check"></i><b>8</b> Script-based workflows</a><ul>
<li class="chapter" data-level="8.1" data-path="scripts.html"><a href="scripts.html#function-oriented-workflows"><i class="fa fa-check"></i><b>8.1</b> Function-oriented workflows</a></li>
<li class="chapter" data-level="8.2" data-path="scripts.html"><a href="scripts.html#traditional-and-legacy-workflows"><i class="fa fa-check"></i><b>8.2</b> Traditional and legacy workflows</a></li>
<li class="chapter" data-level="8.3" data-path="scripts.html"><a href="scripts.html#overcoming-technical-debt"><i class="fa fa-check"></i><b>8.3</b> Overcoming Technical Debt</a></li>
<li class="chapter" data-level="8.4" data-path="scripts.html"><a href="scripts.html#dependencies"><i class="fa fa-check"></i><b>8.4</b> Dependencies</a></li>
<li class="chapter" data-level="8.5" data-path="scripts.html"><a href="scripts.html#building-the-connections"><i class="fa fa-check"></i><b>8.5</b> Building the connections</a></li>
<li class="chapter" data-level="8.6" data-path="scripts.html"><a href="scripts.html#run-the-workflow"><i class="fa fa-check"></i><b>8.6</b> Run the workflow</a></li>
<li class="chapter" data-level="8.7" data-path="scripts.html"><a href="scripts.html#keeping-the-results-up-to-date"><i class="fa fa-check"></i><b>8.7</b> Keeping the results up to date</a></li>
<li class="chapter" data-level="8.8" data-path="scripts.html"><a href="scripts.html#final-thoughts"><i class="fa fa-check"></i><b>8.8</b> Final thoughts</a></li>
</ul></li>
<li class="part"><span><b>II Examples</b></span></li>
<li class="chapter" data-level="9" data-path="churn.html"><a href="churn.html"><i class="fa fa-check"></i><b>9</b> Customer churn and deep learning</a><ul>
<li class="chapter" data-level="9.1" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>9.1</b> Packages</a></li>
<li class="chapter" data-level="9.2" data-path="churn.html"><a href="churn.html#functions-1"><i class="fa fa-check"></i><b>9.2</b> Functions</a></li>
<li class="chapter" data-level="9.3" data-path="churn.html"><a href="churn.html#plan"><i class="fa fa-check"></i><b>9.3</b> Plan</a></li>
<li class="chapter" data-level="9.4" data-path="churn.html"><a href="churn.html#dependency-graph"><i class="fa fa-check"></i><b>9.4</b> Dependency graph</a></li>
<li class="chapter" data-level="9.5" data-path="churn.html"><a href="churn.html#run-the-models"><i class="fa fa-check"></i><b>9.5</b> Run the models</a></li>
<li class="chapter" data-level="9.6" data-path="churn.html"><a href="churn.html#inspect-the-results"><i class="fa fa-check"></i><b>9.6</b> Inspect the results</a></li>
<li class="chapter" data-level="9.7" data-path="churn.html"><a href="churn.html#add-models"><i class="fa fa-check"></i><b>9.7</b> Add models</a></li>
<li class="chapter" data-level="9.8" data-path="churn.html"><a href="churn.html#inspect-the-results-again"><i class="fa fa-check"></i><b>9.8</b> Inspect the results again</a></li>
<li class="chapter" data-level="9.9" data-path="churn.html"><a href="churn.html#update-your-code"><i class="fa fa-check"></i><b>9.9</b> Update your code</a></li>
<li class="chapter" data-level="9.10" data-path="churn.html"><a href="churn.html#history-and-provenance-1"><i class="fa fa-check"></i><b>9.10</b> History and provenance</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>10</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="10.1" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>10.1</b> Get the code.</a></li>
<li class="chapter" data-level="10.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>10.2</b> Overview</a></li>
<li class="chapter" data-level="10.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>10.3</b> Analysis</a></li>
<li class="chapter" data-level="10.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>10.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>11</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="11.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>11.1</b> Get the code.</a></li>
<li class="chapter" data-level="11.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>11.2</b> Objective and methods</a></li>
<li class="chapter" data-level="11.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>11.3</b> Data</a></li>
<li class="chapter" data-level="11.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>11.4</b> Analysis</a></li>
<li class="chapter" data-level="11.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>11.5</b> Results</a></li>
<li class="chapter" data-level="11.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>11.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="11.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>11.7</b> References</a></li>
</ul></li>
<li class="part"><span><b>III Resource management</b></span></li>
<li class="chapter" data-level="12" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>12</b> High-performance computing</a><ul>
<li class="chapter" data-level="12.1" data-path="hpc.html"><a href="hpc.html#start-small"><i class="fa fa-check"></i><b>12.1</b> Start small</a></li>
<li class="chapter" data-level="12.2" data-path="hpc.html"><a href="hpc.html#let-make-schedule-your-targets."><i class="fa fa-check"></i><b>12.2</b> Let <code>make()</code> schedule your targets.</a></li>
<li class="chapter" data-level="12.3" data-path="hpc.html"><a href="hpc.html#the-master-process"><i class="fa fa-check"></i><b>12.3</b> The master process</a><ul>
<li class="chapter" data-level="12.3.1" data-path="hpc.html"><a href="hpc.html#master-on-a-cluster"><i class="fa fa-check"></i><b>12.3.1</b> Master on a cluster</a></li>
<li class="chapter" data-level="12.3.2" data-path="hpc.html"><a href="hpc.html#local-master"><i class="fa fa-check"></i><b>12.3.2</b> Local master</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>12.4</b> Parallel backends</a></li>
<li class="chapter" data-level="12.5" data-path="hpc.html"><a href="hpc.html#the-clustermq-backend"><i class="fa fa-check"></i><b>12.5</b> The <code>clustermq</code> backend</a><ul>
<li class="chapter" data-level="12.5.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>12.5.1</b> Persistent workers</a></li>
<li class="chapter" data-level="12.5.2" data-path="hpc.html"><a href="hpc.html#installation-1"><i class="fa fa-check"></i><b>12.5.2</b> Installation</a></li>
<li class="chapter" data-level="12.5.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine"><i class="fa fa-check"></i><b>12.5.3</b> On your local machine</a></li>
<li class="chapter" data-level="12.5.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster"><i class="fa fa-check"></i><b>12.5.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="hpc.html"><a href="hpc.html#the-future-backend"><i class="fa fa-check"></i><b>12.6</b> The <code>future</code> backend</a><ul>
<li class="chapter" data-level="12.6.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>12.6.1</b> Transient workers</a></li>
<li class="chapter" data-level="12.6.2" data-path="hpc.html"><a href="hpc.html#installation-2"><i class="fa fa-check"></i><b>12.6.2</b> Installation</a></li>
<li class="chapter" data-level="12.6.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine-1"><i class="fa fa-check"></i><b>12.6.3</b> On your local machine</a></li>
<li class="chapter" data-level="12.6.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster-1"><i class="fa fa-check"></i><b>12.6.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="hpc.html"><a href="hpc.html#advanced-options"><i class="fa fa-check"></i><b>12.7</b> Advanced options</a><ul>
<li class="chapter" data-level="12.7.1" data-path="hpc.html"><a href="hpc.html#selectivity"><i class="fa fa-check"></i><b>12.7.1</b> Selectivity</a></li>
<li class="chapter" data-level="12.7.2" data-path="hpc.html"><a href="hpc.html#memory-options"><i class="fa fa-check"></i><b>12.7.2</b> Memory options</a></li>
<li class="chapter" data-level="12.7.3" data-path="hpc.html"><a href="hpc.html#storage-options"><i class="fa fa-check"></i><b>12.7.3</b> Storage options</a></li>
<li class="chapter" data-level="12.7.4" data-path="hpc.html"><a href="hpc.html#the-template-argument-for-persistent-workers"><i class="fa fa-check"></i><b>12.7.4</b> The <code>template</code> argument for persistent workers</a></li>
<li class="chapter" data-level="12.7.5" data-path="hpc.html"><a href="hpc.html#the-resources-column-for-transient-workers"><i class="fa fa-check"></i><b>12.7.5</b> The <code>resources</code> column for transient workers</a></li>
<li class="chapter" data-level="12.7.6" data-path="hpc.html"><a href="hpc.html#parallel-computing-within-targets"><i class="fa fa-check"></i><b>12.7.6</b> Parallel computing <em>within</em> targets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>13</b> Time: speed, time logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="13.1" data-path="time.html"><a href="time.html#why-is-drake-so-slow"><i class="fa fa-check"></i><b>13.1</b> Why is <code>drake</code> so slow?</a><ul>
<li class="chapter" data-level="13.1.1" data-path="time.html"><a href="time.html#help-us-find-out"><i class="fa fa-check"></i><b>13.1.1</b> Help us find out!</a></li>
<li class="chapter" data-level="13.1.2" data-path="time.html"><a href="time.html#too-many-targets"><i class="fa fa-check"></i><b>13.1.2</b> Too many targets?</a></li>
<li class="chapter" data-level="13.1.3" data-path="time.html"><a href="time.html#big-data"><i class="fa fa-check"></i><b>13.1.3</b> Big data?</a></li>
<li class="chapter" data-level="13.1.4" data-path="time.html"><a href="time.html#aggressive-shortcuts"><i class="fa fa-check"></i><b>13.1.4</b> Aggressive shortcuts</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="time.html"><a href="time.html#time-logging"><i class="fa fa-check"></i><b>13.2</b> Time logging</a></li>
<li class="chapter" data-level="13.3" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>13.3</b> Predict total runtime</a></li>
<li class="chapter" data-level="13.4" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>13.4</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>14</b> Memory management</a><ul>
<li class="chapter" data-level="14.1" data-path="memory.html"><a href="memory.html#garbage-collection-and-custom-files"><i class="fa fa-check"></i><b>14.1</b> Garbage collection and custom files</a></li>
<li class="chapter" data-level="14.2" data-path="memory.html"><a href="memory.html#memory-strategies"><i class="fa fa-check"></i><b>14.2</b> Memory strategies</a></li>
<li class="chapter" data-level="14.3" data-path="memory.html"><a href="memory.html#data-splitting"><i class="fa fa-check"></i><b>14.3</b> Data splitting</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="storage.html"><a href="storage.html"><i class="fa fa-check"></i><b>15</b> Storage</a><ul>
<li class="chapter" data-level="15.1" data-path="storage.html"><a href="storage.html#drakes-cache"><i class="fa fa-check"></i><b>15.1</b> <code>drake</code>’s cache</a></li>
<li class="chapter" data-level="15.2" data-path="storage.html"><a href="storage.html#efficient-target-storage"><i class="fa fa-check"></i><b>15.2</b> Efficient target storage</a></li>
<li class="chapter" data-level="15.3" data-path="storage.html"><a href="storage.html#why-is-my-cache-so-big"><i class="fa fa-check"></i><b>15.3</b> Why is my cache so big?</a><ul>
<li class="chapter" data-level="15.3.1" data-path="storage.html"><a href="storage.html#old-targets"><i class="fa fa-check"></i><b>15.3.1</b> Old targets</a></li>
<li class="chapter" data-level="15.3.2" data-path="storage.html"><a href="storage.html#garbage-from-interrupted-builds"><i class="fa fa-check"></i><b>15.3.2</b> Garbage from interrupted builds</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="storage.html"><a href="storage.html#interfaces-to-the-cache"><i class="fa fa-check"></i><b>15.4</b> Interfaces to the cache</a></li>
</ul></li>
<li class="part"><span><b>IV Extra features</b></span></li>
<li class="chapter" data-level="16" data-path="visuals.html"><a href="visuals.html"><i class="fa fa-check"></i><b>16</b> Visualization with drake</a><ul>
<li class="chapter" data-level="16.1" data-path="visuals.html"><a href="visuals.html#plotting-plans"><i class="fa fa-check"></i><b>16.1</b> Plotting plans</a><ul>
<li class="chapter" data-level="16.1.1" data-path="visuals.html"><a href="visuals.html#vis_drake_graph"><i class="fa fa-check"></i><b>16.1.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="16.1.2" data-path="visuals.html"><a href="visuals.html#sankey_drake_graph"><i class="fa fa-check"></i><b>16.1.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="16.1.3" data-path="visuals.html"><a href="visuals.html#drake_ggraph"><i class="fa fa-check"></i><b>16.1.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="16.1.4" data-path="visuals.html"><a href="visuals.html#text_drake_graph"><i class="fa fa-check"></i><b>16.1.4</b> <code>text_drake_graph()</code></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="visuals.html"><a href="visuals.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>16.2</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="16.3" data-path="visuals.html"><a href="visuals.html#visualizing-target-status"><i class="fa fa-check"></i><b>16.3</b> Visualizing target status</a></li>
<li class="chapter" data-level="16.4" data-path="visuals.html"><a href="visuals.html#subgraphs"><i class="fa fa-check"></i><b>16.4</b> Subgraphs</a></li>
<li class="chapter" data-level="16.5" data-path="visuals.html"><a href="visuals.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>16.5</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="16.6" data-path="visuals.html"><a href="visuals.html#clusters"><i class="fa fa-check"></i><b>16.6</b> Clusters</a></li>
<li class="chapter" data-level="16.7" data-path="visuals.html"><a href="visuals.html#output-files"><i class="fa fa-check"></i><b>16.7</b> Output files</a></li>
<li class="chapter" data-level="16.8" data-path="visuals.html"><a href="visuals.html#node-selection"><i class="fa fa-check"></i><b>16.8</b> Node Selection</a><ul>
<li class="chapter" data-level="16.8.1" data-path="visuals.html"><a href="visuals.html#perform-the-default-action-on-select"><i class="fa fa-check"></i><b>16.8.1</b> Perform the default action on select</a></li>
<li class="chapter" data-level="16.8.2" data-path="visuals.html"><a href="visuals.html#perform-no-action-on-select"><i class="fa fa-check"></i><b>16.8.2</b> Perform no action on select</a></li>
<li class="chapter" data-level="16.8.3" data-path="visuals.html"><a href="visuals.html#customize-the-onselect-event-behaviour"><i class="fa fa-check"></i><b>16.8.3</b> Customize the onSelect event behaviour</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>17</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="17.1" data-path="debugging.html"><a href="debugging.html#debugging-failed-targets"><i class="fa fa-check"></i><b>17.1</b> Debugging failed targets</a><ul>
<li class="chapter" data-level="17.1.1" data-path="debugging.html"><a href="debugging.html#diagnosing-errors"><i class="fa fa-check"></i><b>17.1.1</b> Diagnosing errors</a></li>
<li class="chapter" data-level="17.1.2" data-path="debugging.html"><a href="debugging.html#interactive-debugging"><i class="fa fa-check"></i><b>17.1.2</b> Interactive debugging</a></li>
<li class="chapter" data-level="17.1.3" data-path="debugging.html"><a href="debugging.html#efficient-trial-and-error"><i class="fa fa-check"></i><b>17.1.3</b> Efficient trial and error</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="debugging.html"><a href="debugging.html#why-do-my-targets-keep-rerunning"><i class="fa fa-check"></i><b>17.2</b> Why do my targets keep rerunning?</a><ul>
<li class="chapter" data-level="17.2.1" data-path="debugging.html"><a href="debugging.html#how-your-workflow-fits-together"><i class="fa fa-check"></i><b>17.2.1</b> How your workflow fits together</a></li>
<li class="chapter" data-level="17.2.2" data-path="debugging.html"><a href="debugging.html#which-targets-are-outdated"><i class="fa fa-check"></i><b>17.2.2</b> Which targets are outdated</a></li>
<li class="chapter" data-level="17.2.3" data-path="debugging.html"><a href="debugging.html#why-your-targets-are-outdated"><i class="fa fa-check"></i><b>17.2.3</b> Why your targets are outdated</a></li>
<li class="chapter" data-level="17.2.4" data-path="debugging.html"><a href="debugging.html#strategies-to-prevent-unexpected-changes-in-the-future"><i class="fa fa-check"></i><b>17.2.4</b> Strategies to prevent unexpected changes in the future</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="debugging.html"><a href="debugging.html#more-help"><i class="fa fa-check"></i><b>17.3</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>18</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="18.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>18.1</b> What are triggers?</a></li>
<li class="chapter" data-level="18.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>18.2</b> Customization</a></li>
<li class="chapter" data-level="18.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>18.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="18.4" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>18.4</b> A more practical example</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>B</b> Design</a><ul>
<li class="chapter" data-level="B.1" data-path="design.html"><a href="design.html#principles"><i class="fa fa-check"></i><b>B.1</b> Principles</a><ul>
<li class="chapter" data-level="B.1.1" data-path="design.html"><a href="design.html#functions-first"><i class="fa fa-check"></i><b>B.1.1</b> Functions first</a></li>
<li class="chapter" data-level="B.1.2" data-path="design.html"><a href="design.html#light-use-of-traditional-oop"><i class="fa fa-check"></i><b>B.1.2</b> Light use of traditional OOP</a></li>
<li class="chapter" data-level="B.1.3" data-path="design.html"><a href="design.html#high-performant-small-objects"><i class="fa fa-check"></i><b>B.1.3</b> High-performant small objects</a></li>
<li class="chapter" data-level="B.1.4" data-path="design.html"><a href="design.html#fast-iteration-along-aggregated-data"><i class="fa fa-check"></i><b>B.1.4</b> Fast iteration along aggregated data</a></li>
<li class="chapter" data-level="B.1.5" data-path="design.html"><a href="design.html#access-to-information-across-targets"><i class="fa fa-check"></i><b>B.1.5</b> Access to information across targets</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="design.html"><a href="design.html#specific-classes"><i class="fa fa-check"></i><b>B.2</b> Specific classes</a><ul>
<li class="chapter" data-level="B.2.1" data-path="design.html"><a href="design.html#config"><i class="fa fa-check"></i><b>B.2.1</b> Config</a></li>
<li class="chapter" data-level="B.2.2" data-path="design.html"><a href="design.html#settings"><i class="fa fa-check"></i><b>B.2.2</b> Settings</a></li>
<li class="chapter" data-level="B.2.3" data-path="design.html"><a href="design.html#plan-1"><i class="fa fa-check"></i><b>B.2.3</b> Plan</a></li>
<li class="chapter" data-level="B.2.4" data-path="design.html"><a href="design.html#specification"><i class="fa fa-check"></i><b>B.2.4</b> Specification</a></li>
<li class="chapter" data-level="B.2.5" data-path="design.html"><a href="design.html#graph"><i class="fa fa-check"></i><b>B.2.5</b> Graph</a></li>
<li class="chapter" data-level="B.2.6" data-path="design.html"><a href="design.html#priority-queue"><i class="fa fa-check"></i><b>B.2.6</b> Priority queue</a></li>
<li class="chapter" data-level="B.2.7" data-path="design.html"><a href="design.html#metadata"><i class="fa fa-check"></i><b>B.2.7</b> Metadata</a></li>
<li class="chapter" data-level="B.2.8" data-path="design.html"><a href="design.html#cache"><i class="fa fa-check"></i><b>B.2.8</b> Cache</a></li>
<li class="chapter" data-level="B.2.9" data-path="design.html"><a href="design.html#code-analysis-lists"><i class="fa fa-check"></i><b>B.2.9</b> Code analysis lists</a></li>
<li class="chapter" data-level="B.2.10" data-path="design.html"><a href="design.html#environments"><i class="fa fa-check"></i><b>B.2.10</b> Environments</a></li>
<li class="chapter" data-level="B.2.11" data-path="design.html"><a href="design.html#hash-tables"><i class="fa fa-check"></i><b>B.2.11</b> Hash tables</a></li>
<li class="chapter" data-level="B.2.12" data-path="design.html"><a href="design.html#logger"><i class="fa fa-check"></i><b>B.2.12</b> Logger</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="plans" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> <code>drake</code> plans</h1>
<p>Most data analysis workflows consist of several steps, such as data cleaning, model fitting, visualization, and reporting. A <code>drake</code> plan is the high-level catalog of all these steps for a single workflow. It is the centerpiece of every <code>drake</code>-powered project, and it is always required. However, the plan is almost never the first thing we write. A typical plan rests on a foundation of carefully-crafted custom functions.</p>
<div id="functions" class="section level2">
<h2><span class="header-section-number">4.1</span> Functions</h2>
<p>A function is a reusable instruction that accepts some inputs and returns a single output. After we define a function once, we can easily call it any number of times.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">root_square_term &lt;-<span class="st"> </span><span class="cf">function</span>(l, w, h) {</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">  half_w &lt;-<span class="st"> </span>w <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  l <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(half_w <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>h <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb25-5" data-line-number="5"></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="kw">root_square_term</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="co">#&gt; [1] 3.162278</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="kw">root_square_term</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="co">#&gt; [1] 26</span></a></code></pre></div>
<p>In practice, functions are vocabulary. They are concise references to complicated ideas, and they help us write instructions of ever increasing complexity.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># right rectangular pyramid</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">volume_pyramid &lt;-<span class="st"> </span><span class="cf">function</span>(length_base, width_base, height) {</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">  area_base &lt;-<span class="st"> </span>length_base <span class="op">*</span><span class="st"> </span>width_base</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">  term1 &lt;-<span class="st"> </span><span class="kw">root_square_term</span>(length_base, width_base, height)</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">  term2 &lt;-<span class="st"> </span><span class="kw">root_square_term</span>(width_base, length_base, height)</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">  area_base <span class="op">+</span><span class="st"> </span>term1 <span class="op">+</span><span class="st"> </span>term2</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb26-8" data-line-number="8"></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="kw">volume_pyramid</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="co">#&gt; [1] 73.09366</span></a></code></pre></div>
<p>The <code>root_square_term()</code> function is custom shorthand that makes <code>volume_pyramid()</code> easier to write and understand. <code>volume_pyramid()</code>, in turn, helps us crudely approximate the total square meters of stone eroded from the Great Pyramid of Giza (<a href="https://en.m.wikipedia.org/wiki/Great_Pyramid_of_Giza">dimensions from Wikipedia</a>).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">volume_original &lt;-<span class="st"> </span><span class="kw">volume_pyramid</span>(<span class="fl">230.4</span>, <span class="fl">230.4</span>, <span class="fl">146.5</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">volume_current &lt;-<span class="st"> </span><span class="kw">volume_pyramid</span>(<span class="fl">230.4</span>, <span class="fl">230.4</span>, <span class="fl">138.8</span>)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">volume_original <span class="op">-</span><span class="st"> </span>volume_current <span class="co"># volume eroded</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt; [1] 2760.183</span></a></code></pre></div>
<p>This function-oriented code is concise and clear. Contrast it with the cumbersome mountain of <a href="https://en.wikipedia.org/wiki/Imperative_programming">imperative</a> arithmetic that would have otherwise daunted us.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># Don&#39;t try this at home!</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">width_original &lt;-<span class="st"> </span><span class="fl">230.4</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3">length_original &lt;-<span class="st"> </span><span class="fl">230.4</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4">height_original &lt;-<span class="st"> </span><span class="fl">146.5</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="co"># We supply the same lengths and widths,</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="co"># but we use different variable names</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="co"># to illustrate the general case.</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9">width_current &lt;-<span class="st"> </span><span class="fl">230.4</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10">length_current &lt;-<span class="st"> </span><span class="fl">230.4</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11">height_current &lt;-<span class="st"> </span><span class="fl">138.8</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"></a>
<a class="sourceLine" id="cb28-13" data-line-number="13">area_original &lt;-<span class="st"> </span>length_original <span class="op">*</span><span class="st"> </span>width_original</a>
<a class="sourceLine" id="cb28-14" data-line-number="14">term1_original &lt;-<span class="st"> </span>length_original <span class="op">*</span></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="st">  </span><span class="kw">sqrt</span>((width_original <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>height_original <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-16" data-line-number="16">term2_original &lt;-<span class="st"> </span>width_original <span class="op">*</span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="st">  </span><span class="kw">sqrt</span>((length_original <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>height_original <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-18" data-line-number="18">volume_original &lt;-<span class="st"> </span>area_original <span class="op">+</span><span class="st"> </span>term1_original <span class="op">+</span><span class="st"> </span>term2_original</a>
<a class="sourceLine" id="cb28-19" data-line-number="19"></a>
<a class="sourceLine" id="cb28-20" data-line-number="20">area_current &lt;-<span class="st"> </span>length_current <span class="op">*</span><span class="st"> </span>width_current</a>
<a class="sourceLine" id="cb28-21" data-line-number="21">term1_current &lt;-<span class="st"> </span>length_current <span class="op">*</span></a>
<a class="sourceLine" id="cb28-22" data-line-number="22"><span class="st">  </span><span class="kw">sqrt</span>((width_current <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>height_current <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-23" data-line-number="23">term2_current &lt;-<span class="st"> </span>width_current <span class="op">*</span></a>
<a class="sourceLine" id="cb28-24" data-line-number="24"><span class="st">  </span><span class="kw">sqrt</span>((length_current <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>height_current <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-25" data-line-number="25">volume_current &lt;-<span class="st"> </span>area_current <span class="op">+</span><span class="st"> </span>term1_current <span class="op">+</span><span class="st"> </span>term2_current</a>
<a class="sourceLine" id="cb28-26" data-line-number="26"></a>
<a class="sourceLine" id="cb28-27" data-line-number="27">volume_original <span class="op">-</span><span class="st"> </span>volume_current <span class="co"># volume eroded</span></a>
<a class="sourceLine" id="cb28-28" data-line-number="28"><span class="co">#&gt; [1] 2760.183</span></a></code></pre></div>
<p>Unlike <a href="https://en.wikipedia.org/wiki/Imperative_programming">imperative</a> scripts, functions break down complex ideas into manageable pieces, and they gradually build up bigger and bigger pieces until an elegant solution materializes. This process of building up functions helps us think clearly, understand what we are doing, and explain our methods to others.</p>
</div>
<div id="intro-to-plans" class="section level2">
<h2><span class="header-section-number">4.2</span> Intro to plans</h2>
<p>A <code>drake</code> plan is a data frame with columns named <code>target</code> and <code>command</code>. Each row represents a step in the workflow. Each command is a concise <a href="http://adv-r.had.co.nz/Expressions.html">expression</a> that makes use of our functions, and each target is the return value of the command. (The <code>target</code> column has the <em>names</em> of the targets, not the values.)</p>
<p>We create plans with the <code>drake_plan()</code> function.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">  <span class="dt">raw_data =</span> readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">file_in</span>(<span class="st">&quot;raw_data.xlsx&quot;</span>)),</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">  <span class="dt">data =</span> raw_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Species =</span> forcats<span class="op">::</span><span class="kw">fct_inorder</span>(Species)),</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">  <span class="dt">hist =</span> <span class="kw">create_plot</span>(data),</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">  <span class="dt">fit =</span> <span class="kw">lm</span>(Sepal.Width <span class="op">~</span><span class="st"> </span>Petal.Width <span class="op">+</span><span class="st"> </span>Species, data),</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">  <span class="dt">report =</span> rmarkdown<span class="op">::</span><span class="kw">render</span>(</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">    <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>),</a>
<a class="sourceLine" id="cb29-9" data-line-number="9">    <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>),</a>
<a class="sourceLine" id="cb29-10" data-line-number="10">    <span class="dt">quiet =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb29-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb29-13" data-line-number="13"></a>
<a class="sourceLine" id="cb29-14" data-line-number="14">plan</a>
<a class="sourceLine" id="cb29-15" data-line-number="15"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb29-16" data-line-number="16"><span class="co">#&gt;   target   command                                                              </span></a>
<a class="sourceLine" id="cb29-17" data-line-number="17"><span class="co">#&gt;   &lt;chr&gt;    &lt;expr&gt;                                                               </span></a>
<a class="sourceLine" id="cb29-18" data-line-number="18"><span class="co">#&gt; 1 raw_data readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))                        …</span></a>
<a class="sourceLine" id="cb29-19" data-line-number="19"><span class="co">#&gt; 2 data     raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species))        …</span></a>
<a class="sourceLine" id="cb29-20" data-line-number="20"><span class="co">#&gt; 3 hist     create_plot(data)                                                   …</span></a>
<a class="sourceLine" id="cb29-21" data-line-number="21"><span class="co">#&gt; 4 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                       …</span></a>
<a class="sourceLine" id="cb29-22" data-line-number="22"><span class="co">#&gt; 5 report   rmarkdown::render(knitr_in(&quot;report.Rmd&quot;), output_file = file_out(&quot;re…</span></a></code></pre></div>
<p>The plan makes use of a custom <code>create_plot()</code> function to produce target <code>hist</code>. Functions make the plan more concise and easier to read.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">create_plot &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">  <span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x =</span> Petal.Width, <span class="dt">fill =</span> Species)) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="st">    </span><span class="kw">theme_gray</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">}</a></code></pre></div>
<p><code>drake</code> automatically understands the relationships among targets in the plan. It knows <code>data</code> depends on <code>raw_data</code> because the symbol <code>raw_data</code> is mentioned in the command for <code>data</code>. <code>drake</code> represents this dependency relationship with an arrow from <code>raw_data</code> to <code>data</code> in the graph.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">vis_drake_graph</span>(plan)</a></code></pre></div>
<div id="htmlwidget-437c9b36fe661843587a" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-437c9b36fe661843587a">{"x":{"nodes":{"id":["create_plot","n-OJSWCZDYNQ5DU4TFMFSF6ZLYMNSWY","p-OJQXOX3EMF2GCLTYNRZXQ","n-OJWWC4TLMRXXO3R2HJZGK3TEMVZA","p-OJSXA33SOQXFE3LE","n-MZXXEY3BORZTUOTGMN2F62LON5ZGIZLS","raw_data","data","fit","hist","report","p-OJSXA33SOQXGQ5DNNQ"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false],"label":["create_plot","readxl::read_excel","file raw_data.xlsx","rmarkdown::render","file report.Rmd","forcats::fct_inorder","raw_data","data","fit","hist","report","file report.html"],"status":["imported","imported","imported","imported","imported","imported","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["function","function","file","function","file","function","object","object","object","object","object","file"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["triangle","triangle","square","triangle","square","triangle","dot","dot","dot","dot","dot","square"],"level":[1,1,1,1,1,1,2,3,4,4,5,6],"x":[-1,-1,-1,-1,-1,-1,-0.6,-0.2,0.2,0.2,0.6,1],"y":[-1,-0.6,-0.2,0.2,0.6,1,2.22044604925031e-16,2.22044604925031e-16,-0.466666666666667,0.466666666666667,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["create_plot","data","data","n-OJSWCZDYNQ5DU4TFMFSF6ZLYMNSWY","p-OJQXOX3EMF2GCLTYNRZXQ","n-OJWWC4TLMRXXO3R2HJZGK3TEMVZA","fit","hist","p-OJSXA33SOQXFE3LE","report","raw_data","n-MZXXEY3BORZTUOTGMN2F62LON5ZGIZLS"],"to":["hist","fit","hist","raw_data","raw_data","report","report","report","report","p-OJSXA33SOQXGQ5DNNQ","data","data"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","File"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,6,8,10,11]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
<p>We can write the targets in any order and <code>drake</code> still understands the dependency relationships.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">  <span class="dt">report =</span> rmarkdown<span class="op">::</span><span class="kw">render</span>(</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">    <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>),</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">    <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>),</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">    <span class="dt">quiet =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb32-7" data-line-number="7">  <span class="dt">fit =</span> <span class="kw">lm</span>(Sepal.Width <span class="op">~</span><span class="st"> </span>Petal.Width <span class="op">+</span><span class="st"> </span>Species, data),</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">  <span class="dt">data =</span> raw_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Species =</span> forcats<span class="op">::</span><span class="kw">fct_inorder</span>(Species)),</a>
<a class="sourceLine" id="cb32-10" data-line-number="10">  <span class="dt">hist =</span> <span class="kw">create_plot</span>(data),</a>
<a class="sourceLine" id="cb32-11" data-line-number="11">  <span class="dt">raw_data =</span> readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">file_in</span>(<span class="st">&quot;raw_data.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb32-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb32-13" data-line-number="13"></a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="kw">vis_drake_graph</span>(plan)</a></code></pre></div>
<div id="htmlwidget-52077144b47bb6e4b9dc" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-52077144b47bb6e4b9dc">{"x":{"nodes":{"id":["create_plot","n-OJSWCZDYNQ5DU4TFMFSF6ZLYMNSWY","p-OJQXOX3EMF2GCLTYNRZXQ","n-OJWWC4TLMRXXO3R2HJZGK3TEMVZA","p-OJSXA33SOQXFE3LE","n-MZXXEY3BORZTUOTGMN2F62LON5ZGIZLS","raw_data","data","fit","hist","report","p-OJSXA33SOQXGQ5DNNQ"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false],"label":["create_plot","readxl::read_excel","file raw_data.xlsx","rmarkdown::render","file report.Rmd","forcats::fct_inorder","raw_data","data","fit","hist","report","file report.html"],"status":["imported","imported","imported","imported","imported","imported","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["function","function","file","function","file","function","object","object","object","object","object","file"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["triangle","triangle","square","triangle","square","triangle","dot","dot","dot","dot","dot","square"],"level":[1,1,1,1,1,1,2,3,4,4,5,6],"x":[-1,-1,-1,-1,-1,-1,-0.6,-0.2,0.2,0.2,0.6,1],"y":[-1,-0.6,-0.2,0.2,0.6,1,2.22044604925031e-16,2.22044604925031e-16,-0.466666666666667,0.466666666666667,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["create_plot","data","data","n-OJSWCZDYNQ5DU4TFMFSF6ZLYMNSWY","p-OJQXOX3EMF2GCLTYNRZXQ","n-OJWWC4TLMRXXO3R2HJZGK3TEMVZA","fit","hist","p-OJSXA33SOQXFE3LE","report","raw_data","n-MZXXEY3BORZTUOTGMN2F62LON5ZGIZLS"],"to":["hist","fit","hist","raw_data","raw_data","report","report","report","report","p-OJSXA33SOQXGQ5DNNQ","data","data"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","File"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,6,8,10,11]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
<p>The <code>make()</code> function runs the correct targets in the correct order and stores the results in a hidden cache.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">library</span>(drake)</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="kw">library</span>(rlang)</a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb33-6" data-line-number="6"></a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co">#&gt; ▶ target raw_data</span></a>
<a class="sourceLine" id="cb33-9" data-line-number="9"><span class="co">#&gt; ▶ target data</span></a>
<a class="sourceLine" id="cb33-10" data-line-number="10"><span class="co">#&gt; ▶ target fit</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11"><span class="co">#&gt; ▶ target hist</span></a>
<a class="sourceLine" id="cb33-12" data-line-number="12"><span class="co">#&gt; ▶ target report</span></a>
<a class="sourceLine" id="cb33-13" data-line-number="13"></a>
<a class="sourceLine" id="cb33-14" data-line-number="14"><span class="kw">readd</span>(hist)</a></code></pre></div>
<p><img src="drake-manual_files/figure-html/unnamed-chunk-38-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The purpose of the plan is to identify steps we can skip in our workflow. If we change some code or data, <code>drake</code> saves time by running some steps and skipping others.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">create_plot &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">  <span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x =</span> Petal.Width, <span class="dt">fill =</span> Species)) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.25</span>) <span class="op">+</span><span class="st"> </span><span class="co"># new bin width</span></a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="st">    </span><span class="kw">theme_gray</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb34-6" data-line-number="6"></a>
<a class="sourceLine" id="cb34-7" data-line-number="7"><span class="kw">vis_drake_graph</span>(plan)</a></code></pre></div>
<div id="htmlwidget-5b2f3f64e2ae588c1146" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-5b2f3f64e2ae588c1146">{"x":{"nodes":{"id":["create_plot","n-OJSWCZDYNQ5DU4TFMFSF6ZLYMNSWY","p-OJQXOX3EMF2GCLTYNRZXQ","n-OJWWC4TLMRXXO3R2HJZGK3TEMVZA","p-OJSXA33SOQXFE3LE","n-MZXXEY3BORZTUOTGMN2F62LON5ZGIZLS","raw_data","data","fit","hist","report","p-OJSXA33SOQXGQ5DNNQ"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false],"label":["create_plot","readxl::read_excel","file raw_data.xlsx","rmarkdown::render","file report.Rmd","forcats::fct_inorder","raw_data\n0.013s","data\n0.004s","fit\n0.006s","hist\n0.029s","report\n0.671s","file report.html"],"status":["imported","imported","imported","imported","imported","imported","up to date","up to date","up to date","outdated","outdated","outdated"],"type":["function","function","file","function","file","function","object","object","object","object","object","file"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#228B22","#228B22","#228B22","#000000","#000000","#000000"],"shape":["triangle","triangle","square","triangle","square","triangle","dot","dot","dot","dot","dot","square"],"level":[1,1,1,1,1,1,2,3,4,4,5,6],"x":[-1,-1,-1,-1,-1,-1,-0.6,-0.2,0.2,0.2,0.6,1],"y":[-1,-0.6,-0.2,0.2,0.6,1,2.22044604925031e-16,2.22044604925031e-16,-0.466666666666667,0.466666666666667,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["create_plot","data","data","n-OJSWCZDYNQ5DU4TFMFSF6ZLYMNSWY","p-OJQXOX3EMF2GCLTYNRZXQ","n-OJWWC4TLMRXXO3R2HJZGK3TEMVZA","fit","hist","p-OJSXA33SOQXFE3LE","report","raw_data","n-MZXXEY3BORZTUOTGMN2F62LON5ZGIZLS"],"to":["hist","fit","hist","raw_data","raw_data","report","report","report","report","p-OJSXA33SOQXGQ5DNNQ","data","data"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","Imported","Object","Function","File"],"color":["#228B22","#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black","black"],"font.size":[20,20,20,20,20,20],"id":[1,2,6,8,10,11]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="co">#&gt; ▶ target hist</span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="co">#&gt; ▶ target report</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="kw">readd</span>(hist)</a></code></pre></div>
<p><img src="drake-manual_files/figure-html/unnamed-chunk-40-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="how-to-choose-good-targets" class="section level2">
<h2><span class="header-section-number">4.3</span> How to choose good targets</h2>
<p>Defining good targets is more of an art than a science, and it requires personal judgement and context specific to your use case. Generally speaking, a good target is</p>
<ol style="list-style-type: decimal">
<li>Long enough to eat up a decent chunk of runtime, and</li>
<li>Small enough that <code>make()</code> frequently skips it, and</li>
<li>Meaningful to your project, and</li>
<li>A well-behaved R object compatible with <code>saveRDS()</code>. For example, data frames behave better than database connection objects (discussions <a href="https://github.com/ropensci/drake/issues/1046">here</a> and <a href="https://github.com/ropensci-books/drake/issues/46">here</a>), <a href="https://github.com/ropensci/drake/issues/345">R6 classes</a>, and <a href="https://github.com/ropensci/drake/issues/1038"><code>xgboost</code> matrices</a>.</li>
</ol>
<p>Above, “long” and “short” refer to computational runtime, not the size of the target’s value. The more data you return to the targets, the more data <code>drake</code> puts in storage, and the slower your workflow becomes. If you have a large dataset, it may not be wise to copy it over several targets.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">bad_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">  <span class="dt">raw =</span> <span class="kw">get_big_raw_dataset</span>(), <span class="co"># We write this ourselves.</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3">  <span class="dt">selection =</span> <span class="kw">select</span>(raw, column1, column2),</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">  <span class="dt">filtered =</span> <span class="kw">filter</span>(selection, column3 <span class="op">==</span><span class="st"> &quot;abc&quot;</span>),</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">  <span class="dt">analysis =</span> <span class="kw">my_analysis_function</span>(filtered) <span class="co"># Same here.</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6">)</a></code></pre></div>
<p>In the above sketch, the dataset is super large, and selection and filtering are fast by comparison. It is much better to wrap up these steps in a data cleaning function and reduce the number of targets.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">munged_dataset &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">  <span class="kw">get_big_raw_dataset</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">    </span><span class="kw">select</span>(column1, column2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="st">    </span><span class="kw">filter</span>(column3 <span class="op">==</span><span class="st"> &quot;abc&quot;</span>)</a>
<a class="sourceLine" id="cb37-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb37-6" data-line-number="6"></a>
<a class="sourceLine" id="cb37-7" data-line-number="7">good_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb37-8" data-line-number="8">  <span class="dt">dataset =</span> <span class="kw">munged_dataset</span>(),</a>
<a class="sourceLine" id="cb37-9" data-line-number="9">  <span class="dt">analysis =</span> <span class="kw">my_analysis_function</span>(dataset)</a>
<a class="sourceLine" id="cb37-10" data-line-number="10">)</a></code></pre></div>
</div>
<div id="special-data-formats-for-targets" class="section level2">
<h2><span class="header-section-number">4.4</span> Special data formats for targets</h2>
<p><code>drake</code> supports custom formats for saving and loading large objects and highly specialized objects. For example, the <code>&quot;fst&quot;</code> and <code>&quot;fst_tbl&quot;</code> formats use the <a href="https://github.com/fstpackage/fst"><code>fst</code></a> package to save <code>data.frame</code> and <code>tibble</code> targets faster. Simply enclose the command and the format together with the <code>target()</code> function.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">library</span>(drake)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="fl">1e8</span> <span class="co"># Each target is 1.6 GB in memory.</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb38-4" data-line-number="4">  <span class="dt">data_fst =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb38-5" data-line-number="5">    <span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(n), <span class="dt">y =</span> <span class="kw">runif</span>(n)),</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">    <span class="dt">format =</span> <span class="st">&quot;fst&quot;</span></a>
<a class="sourceLine" id="cb38-7" data-line-number="7">  ),</a>
<a class="sourceLine" id="cb38-8" data-line-number="8">  <span class="dt">data_old =</span> <span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(n), <span class="dt">y =</span> <span class="kw">runif</span>(n))</a>
<a class="sourceLine" id="cb38-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb38-10" data-line-number="10"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb38-11" data-line-number="11"><span class="co">#&gt; target data_fst</span></a>
<a class="sourceLine" id="cb38-12" data-line-number="12"><span class="co">#&gt; target data_old</span></a>
<a class="sourceLine" id="cb38-13" data-line-number="13"><span class="kw">build_times</span>(<span class="dt">type =</span> <span class="st">&quot;build&quot;</span>)</a>
<a class="sourceLine" id="cb38-14" data-line-number="14"><span class="co">#&gt; # A tibble: 2 x 4</span></a>
<a class="sourceLine" id="cb38-15" data-line-number="15"><span class="co">#&gt;   target   elapsed              user                 system    </span></a>
<a class="sourceLine" id="cb38-16" data-line-number="16"><span class="co">#&gt;   &lt;chr&gt;    &lt;Duration&gt;           &lt;Duration&gt;           &lt;Duration&gt;</span></a>
<a class="sourceLine" id="cb38-17" data-line-number="17"><span class="co">#&gt; 1 data_fst 13.93s               37.562s              7.954s    </span></a>
<a class="sourceLine" id="cb38-18" data-line-number="18"><span class="co">#&gt; 2 data_old 184s (~3.07 minutes) 177s (~2.95 minutes) 4.157s</span></a></code></pre></div>
<p>There are several formats, each with their own system requirements. These system requirements, such as the <code>fst</code> R package for the <code>&quot;fst&quot;</code> format, do not come pre-installed with <code>drake</code>. You will need to install them manually.</p>
<ul>
<li><code>&quot;file&quot;</code>: Dynamic files. To use this format, simply create local files and directories yourself and then return a character vector of paths as the target’s value. Then, <code>drake</code> will watch for changes to those files in subsequent calls to <code>make()</code>. This is a more flexible alternative to <code>file_in()</code> and <code>file_out()</code>, and it is compatible with dynamic branching. See <a href="https://github.com/ropensci/drake/pull/1178" class="uri">https://github.com/ropensci/drake/pull/1178</a> for an example.</li>
<li><code>&quot;fst&quot;</code>: save big data frames fast. Requires the <code>fst</code> package.
Note: this format strips non-data-frame attributes such as the</li>
<li><code>&quot;fst_tbl&quot;</code>: Like <code>&quot;fst&quot;</code>, but for <code>tibble</code> objects.
Requires the <code>fst</code> and <code>tibble</code> packages.
Strips away non-data-frame non-tibble attributes.</li>
<li><code>&quot;fst_dt&quot;</code>: Like <code>&quot;fst&quot;</code> format, but for <code>data.table</code> objects.
Requires the <code>fst</code> and <code>data.table</code> packages.
Strips away non-data-frame non-data-table attributes.</li>
<li><code>&quot;diskframe&quot;</code>:
Stores <code>disk.frame</code> objects, which could potentially be
larger than memory. Requires the <code>fst</code> and <code>disk.frame</code> packages.
Coerces objects to <code>disk.frame</code>s.
Note: <code>disk.frame</code> objects get moved to the <code>drake</code> cache
(a subfolder of <code>.drake/</code> for most workflows).
To ensure this data transfer is fast, it is best to
save your <code>disk.frame</code> objects to the same physical storage
drive as the <code>drake</code> cache,
<code>as.disk.frame(your_dataset, outdir = drake_tempfile())</code>.</li>
<li><code>&quot;keras&quot;</code>: save Keras models as HDF5 files.
Requires the <code>keras</code> package.</li>
<li><code>&quot;qs&quot;</code>: save any R object that can be properly serialized
with the <code>qs</code> package. Requires the <code>qs</code> package.
Uses <code>qsave()</code> and <code>qread()</code>.
Uses the default settings in <code>qs</code> version 0.20.2.</li>
<li><code>&quot;rds&quot;</code>: save any R object that can be properly serialized.
Requires R version &gt;= 3.5.0 due to ALTREP.
Note: the <code>&quot;rds&quot;</code> format uses gzip compression, which is slow.
<code>&quot;qs&quot;</code> is a superior format.</li>
</ul>
</div>
<div id="special-columns" class="section level2">
<h2><span class="header-section-number">4.5</span> Special columns</h2>
<p>With <code>target()</code>, you can define any kind of special column in the plan.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">target</span>((<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">5</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">golden =</span> <span class="st">&quot;ratio&quot;</span>),</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">  <span class="dt">y =</span> <span class="kw">target</span>(pi <span class="op">*</span><span class="st"> </span><span class="dv">3</span> <span class="op">^</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">area =</span> <span class="st">&quot;circle&quot;</span>)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="co">#&gt; # A tibble: 2 x 4</span></a>
<a class="sourceLine" id="cb39-6" data-line-number="6"><span class="co">#&gt;   target command         golden area  </span></a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;          &lt;chr&gt;  &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb39-8" data-line-number="8"><span class="co">#&gt; 1 x      (1 + sqrt(5))/2 ratio  &lt;NA&gt;  </span></a>
<a class="sourceLine" id="cb39-9" data-line-number="9"><span class="co">#&gt; 2 y      pi * 3^2        &lt;NA&gt;   circle</span></a></code></pre></div>
<p>The following columns have special meanings, and <code>make()</code> reads and interprets them.</p>
<ul>
<li><code>format</code>: already described above.</li>
<li><code>dynamic</code>: See the <a href="dynamic.html#dynamic">chapter on dynamic branching</a>.</li>
<li><code>transform</code>: Automatically processed by <code>drake_plan()</code> except for <code>drake_plan(transform = FALSE)</code>. See the <a href="static.html#static">chapter on static branching</a>.</li>
<li><code>trigger</code>: rule to decide whether a target needs to run. See the <a href="triggers.html#triggers">trigger chapter</a> to learn more.</li>
<li><code>elapsed</code> and <code>cpu</code>: number of seconds to wait for the target to build before timing out (<code>elapsed</code> for elapsed time and <code>cpu</code> for CPU time).</li>
<li><code>hpc</code>: logical values (<code>TRUE</code>/<code>FALSE</code>/<code>NA</code>) whether to send each target to parallel workers. <a href="https://books.ropensci.org/drake/hpc.html#selectivity">Click here</a> to learn more.</li>
<li><code>resources</code>: target-specific lists of resources for a computing cluster. See the advanced options in the <a href="hpc.html#hpc">parallel computing</a> chapter for details.</li>
<li><code>caching</code>: overrides the <code>caching</code> argument of <code>make()</code> for each target individually. Only supported in <code>drake</code> version 7.6.1.9000 and above. Possible values:
<ul>
<li>“master”: tell the master process to store the target in the cache.</li>
<li>“worker”: tell the HPC worker to store the target in the cache.</li>
<li>NA: default to the <code>caching</code> argument of <code>make()</code>.</li>
</ul></li>
<li><code>retries</code>: number of times to retry building a target in the event of an error.</li>
<li><code>seed</code>: pseudo-random number generator (RNG) seed for each target. <code>drake</code> usually computes its own unique reproducible target-specific seeds using the target name and the global seed (the <code>seed</code> argument of <code>make()</code>). Any non-missing seeds in the <code>seed</code> column override <code>drake</code>’s default target seeds.</li>
<li><code>max_expand</code>: for dynamic branching only. Same as the <code>max_expand</code> argument of [make()], but on a target-by-target basis. Limits the number of sub-targets created for a given target. Only supported in <code>drake</code> &gt;= 7.11.0.</li>
</ul>
</div>
<div id="static-files" class="section level2">
<h2><span class="header-section-number">4.6</span> Static files</h2>
<p><code>drake</code> has special functions to declare relationships between targets and external storage on disk. <a href="https://docs.ropensci.org/drake/reference/file_in.html"><code>file_in()</code></a> is for input files and directories, <a href="https://docs.ropensci.org/drake/reference/file_out.html"><code>file_out()</code></a> is for output files and directories, and <a href="https://docs.ropensci.org/drake/reference/knitr_in.html"><code>knitr_in()</code></a> is for R Markdown reports and <code>knitr</code> source files. If you use one of these functions inline in the plan, it tells <code>drake</code> to rerun a target when a file changes (or any of the files in a directory).</p>
<p>All three functions appear in this plan.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">plan</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="co">#&gt;   target   command                                                              </span></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;    &lt;expr&gt;                                                               </span></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="co">#&gt; 1 report   rmarkdown::render(knitr_in(&quot;report.Rmd&quot;), output_file = file_out(&quot;re…</span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="co">#&gt; 2 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                       …</span></a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="co">#&gt; 3 data     raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species))        …</span></a>
<a class="sourceLine" id="cb40-8" data-line-number="8"><span class="co">#&gt; 4 hist     create_plot(data)                                                   …</span></a>
<a class="sourceLine" id="cb40-9" data-line-number="9"><span class="co">#&gt; 5 raw_data readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))                        …</span></a></code></pre></div>
<p>If we break the <code>file_out()</code> file, <code>drake</code> automatically repairs it.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">unlink</span>(<span class="st">&quot;report.html&quot;</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="kw">make</span>(plan)</a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="co">#&gt; ▶ target report</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"></a>
<a class="sourceLine" id="cb41-6" data-line-number="6"><span class="kw">file.exists</span>(<span class="st">&quot;report.html&quot;</span>)</a>
<a class="sourceLine" id="cb41-7" data-line-number="7"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>As for <code>knitr_in()</code>, recall what happened when we changed the <code>create_plot()</code>. Not only did <code>hist</code> rerun, <code>report</code> ran as well. Why? Because <code>knitr_in()</code> is special. It tells <code>drake</code> to look for mentions of <code>loadd()</code> and <code>readd()</code> in the code chunks. <code>drake</code> finds the targets you mention in those <code>loadd()</code> and <code>readd()</code> calls and treats them as dependencies of the report. This lets you choose to run the report either inside or outside a <code>drake</code> pipeline.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="co">#&gt; title: &quot;Example R Markdown drake file target&quot;</span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4"><span class="co">#&gt; author: Will Landau and Kirill Müller</span></a>
<a class="sourceLine" id="cb42-5" data-line-number="5"><span class="co">#&gt; output: html_document</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb42-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb42-8" data-line-number="8"><span class="co">#&gt; Run `make.R` to generate the output `report.pdf` and its dependencies. Because we use `loadd()` and `readd()` below, `drake` knows `report.pdf` depends on targets `fit`, and `hist`.</span></a>
<a class="sourceLine" id="cb42-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb42-10" data-line-number="10"><span class="co">#&gt; ```{r content}</span></a>
<a class="sourceLine" id="cb42-11" data-line-number="11"><span class="co">#&gt; library(drake)</span></a>
<a class="sourceLine" id="cb42-12" data-line-number="12"><span class="co">#&gt; loadd(fit)</span></a>
<a class="sourceLine" id="cb42-13" data-line-number="13"><span class="co">#&gt; print(fit)</span></a>
<a class="sourceLine" id="cb42-14" data-line-number="14"><span class="co">#&gt; readd(hist)</span></a>
<a class="sourceLine" id="cb42-15" data-line-number="15"><span class="co">#&gt; ```</span></a>
<a class="sourceLine" id="cb42-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb42-17" data-line-number="17"><span class="co">#&gt; More:</span></a>
<a class="sourceLine" id="cb42-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb42-19" data-line-number="19"><span class="co">#&gt; - Walkthrough: [this chapter of the user manual](https://books.ropensci.org/drake/walkthrough.html)</span></a>
<a class="sourceLine" id="cb42-20" data-line-number="20"><span class="co">#&gt; - Code: `drake_example(&quot;main&quot;)`</span></a></code></pre></div>
<p>That is why we have an arrow from <code>hist</code> to <code>report</code> in the graph.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">vis_drake_graph</span>(plan)</a></code></pre></div>
<div id="htmlwidget-4bd26251e3510f85efcc" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-4bd26251e3510f85efcc">{"x":{"nodes":{"id":["create_plot","n-MZXXEY3BORZTUOTGMN2F62LON5ZGIZLS","n-OJWWC4TLMRXXO3R2HJZGK3TEMVZA","p-OJSXA33SOQXFE3LE","n-OJSWCZDYNQ5DU4TFMFSF6ZLYMNSWY","p-OJQXOX3EMF2GCLTYNRZXQ","raw_data","data","fit","hist","report","p-OJSXA33SOQXGQ5DNNQ"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false],"label":["create_plot","forcats::fct_inorder","rmarkdown::render","file report.Rmd","readxl::read_excel","file raw_data.xlsx","raw_data\n0.013s","data\n0.004s","fit\n0.006s","hist\n0.031s","report\n0.639s","file report.html"],"status":["imported","imported","imported","imported","imported","imported","up to date","up to date","up to date","up to date","up to date","up to date"],"type":["function","function","function","file","function","file","object","object","object","object","object","file"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22"],"shape":["triangle","triangle","triangle","square","triangle","square","dot","dot","dot","dot","dot","square"],"level":[1,1,1,1,1,1,2,3,4,4,5,6],"x":[-1,-1,-1,-1,-1,-1,-0.6,-0.2,0.2,0.2,0.6,1],"y":[-1,-0.6,-0.2,0.2,0.6,1,2.22044604925031e-16,2.22044604925031e-16,-0.466666666666667,0.466666666666667,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["create_plot","raw_data","n-MZXXEY3BORZTUOTGMN2F62LON5ZGIZLS","data","data","n-OJWWC4TLMRXXO3R2HJZGK3TEMVZA","fit","hist","p-OJSXA33SOQXFE3LE","report","n-OJSWCZDYNQ5DU4TFMFSF6ZLYMNSWY","p-OJQXOX3EMF2GCLTYNRZXQ"],"to":["hist","data","data","fit","hist","report","report","report","report","p-OJSXA33SOQXGQ5DNNQ","raw_data","raw_data"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Imported","Object","Function","File"],"color":["#228B22","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[1,6,8,10,11]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
<div id="urls" class="section level3">
<h3><span class="header-section-number">4.6.1</span> URLs</h3>
<p><code>file_in()</code> understands URLs. If you supply a string beginning with <code>http://</code>, <code>https://</code>, or <code>ftp://</code>, <code>drake</code> watches the HTTP ETag, file size, and timestamp for changes.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">  <span class="dt">external_data =</span> <span class="kw">download.file</span>(<span class="kw">file_in</span>(<span class="st">&quot;http://example.com/file.zip&quot;</span>))</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="co">#&gt;   target        command                                              </span></a>
<a class="sourceLine" id="cb44-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt;         &lt;expr&gt;                                               </span></a>
<a class="sourceLine" id="cb44-7" data-line-number="7"><span class="co">#&gt; 1 external_data download.file(file_in(&quot;http://example.com/file.zip&quot;))</span></a></code></pre></div>
</div>
<div id="limitations-of-static-files" class="section level3">
<h3><span class="header-section-number">4.6.2</span> Limitations of static files</h3>
<div id="paths-must-be-literal-strings" class="section level4">
<h4><span class="header-section-number">4.6.2.1</span> Paths must be literal strings</h4>
<p><code>file_in()</code>, <code>file_out()</code>, and <code>knitr_in()</code> require you to mention file and directory names <em>explicitly</em>. You cannot use a variable containing the name of a file. The reason is that <code>drake</code> detects dependency relationships with <a href="http://adv-r.had.co.nz/Expressions.html#ast-funs">static code analysis</a>. In other words, <code>drake</code> needs to know the names of all your files ahead of time (before we start building targets in <code>make()</code>). Here is an example of a bad plan.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">prefix &lt;-<span class="st"> &quot;eco_&quot;</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2">bad_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb45-3" data-line-number="3">  <span class="dt">data =</span> <span class="kw">read_csv</span>(<span class="kw">file_in</span>(<span class="kw">paste0</span>(prefix, <span class="st">&quot;data.csv&quot;</span>)))</a>
<a class="sourceLine" id="cb45-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb45-5" data-line-number="5"></a>
<a class="sourceLine" id="cb45-6" data-line-number="6"><span class="kw">vis_drake_graph</span>(bad_plan)</a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="co">#&gt; Warning: Detected file_in(paste0(prefix, &quot;data.csv&quot;)). File paths in</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="co">#&gt; file_in(), file_out(), and knitr_in() must be literal strings, not</span></a>
<a class="sourceLine" id="cb45-9" data-line-number="9"><span class="co">#&gt; variables. For example, file_in(&quot;file1.csv&quot;, &quot;file2.csv&quot;) is legal, but</span></a>
<a class="sourceLine" id="cb45-10" data-line-number="10"><span class="co">#&gt; file_in(paste0(filename_variable, &quot;.csv&quot;)) is not. Details: https://</span></a>
<a class="sourceLine" id="cb45-11" data-line-number="11"><span class="co">#&gt; books.ropensci.org/drake/plans.html#static-files</span></a></code></pre></div>
<div id="htmlwidget-c8c2efd752b3f9f48dc8" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-c8c2efd752b3f9f48dc8">{"x":{"nodes":{"id":["p-MRQXIYJOMNZXM","data"],"imported":[true,false],"label":["file data.csv","data\n0.004s"],"status":["missing","outdated"],"type":["file","object"],"font.size":[20,20],"color":["#9A32CD","#000000"],"shape":["square","dot"],"level":[1,2],"x":[-1,1],"y":[0,0]},"edges":{"from":["p-MRQXIYJOMNZXM"],"to":["data"],"arrows":["to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Missing","Object","File"],"color":["#000000","#9A32CD","#888888","#888888"],"shape":["dot","dot","dot","square"],"font.color":["black","black","black","black"],"font.size":[20,20,20,20],"id":[2,7,8,11]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>Instead, write this:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">good_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">  <span class="dt">file =</span> <span class="kw">read_csv</span>(<span class="kw">file_in</span>(<span class="st">&quot;eco_data.csv&quot;</span>))</a>
<a class="sourceLine" id="cb46-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb46-4" data-line-number="4"></a>
<a class="sourceLine" id="cb46-5" data-line-number="5"><span class="kw">vis_drake_graph</span>(good_plan)</a></code></pre></div>
<div id="htmlwidget-094a7ca09aea0953f3fb" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-094a7ca09aea0953f3fb">{"x":{"nodes":{"id":["p-MVRW6X3EMF2GCLTDON3A","file"],"imported":[true,false],"label":["file eco_data.csv","file"],"status":["imported","outdated"],"type":["file","object"],"font.size":[20,20],"color":["#1874CD","#000000"],"shape":["square","dot"],"level":[1,2],"x":[-1,1],"y":[0,0]},"edges":{"from":["p-MVRW6X3EMF2GCLTDON3A"],"to":["file"],"arrows":["to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","File"],"color":["#000000","#1874CD","#888888","#888888"],"shape":["dot","dot","dot","square"],"font.color":["black","black","black","black"],"font.size":[20,20,20,20],"id":[2,6,8,11]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>Or even the one below, which uses the <code>!!</code> (“bang-bang”) tidy evaluation unquoting operator.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">prefix &lt;-<span class="st"> &quot;eco_&quot;</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb47-3" data-line-number="3">  <span class="dt">file =</span> <span class="kw">read_csv</span>(<span class="kw">file_in</span>(<span class="op">!!</span><span class="kw">paste0</span>(prefix, <span class="st">&quot;data.csv&quot;</span>)))</a>
<a class="sourceLine" id="cb47-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb47-5" data-line-number="5"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb47-6" data-line-number="6"><span class="co">#&gt;   target command                          </span></a>
<a class="sourceLine" id="cb47-7" data-line-number="7"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;                           </span></a>
<a class="sourceLine" id="cb47-8" data-line-number="8"><span class="co">#&gt; 1 file   read_csv(file_in(&quot;eco_data.csv&quot;))</span></a></code></pre></div>
</div>
<div id="do-not-use-inside-functions" class="section level4">
<h4><span class="header-section-number">4.6.2.2</span> Do not use inside functions</h4>
<p><code>file_out()</code> and <code>knitr_in()</code> should not be used inside imported functions because <code>drake</code> does not know how to deal with functions that depend on targets. Instead of this:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb48-2" data-line-number="2">  <span class="kw">render</span>(<span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>))</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb48-4" data-line-number="4"></a>
<a class="sourceLine" id="cb48-5" data-line-number="5">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb48-6" data-line-number="6">  <span class="dt">y =</span> <span class="kw">f</span>()</a>
<a class="sourceLine" id="cb48-7" data-line-number="7">)</a></code></pre></div>
<p>Write this:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb49-2" data-line-number="2">  <span class="dt">y =</span> <span class="kw">render</span>(<span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>))</a>
<a class="sourceLine" id="cb49-3" data-line-number="3">)</a></code></pre></div>
<p>Or this:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">  <span class="kw">render</span>(input, <span class="dt">output_file =</span> output)</a>
<a class="sourceLine" id="cb50-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb50-4" data-line-number="4"></a>
<a class="sourceLine" id="cb50-5" data-line-number="5">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb50-6" data-line-number="6">  <span class="dt">y =</span> <span class="kw">f</span>(<span class="dt">input =</span> <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="dt">output =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>))</a>
<a class="sourceLine" id="cb50-7" data-line-number="7">)</a></code></pre></div>
<p><code>file_in()</code> can be used inside functions, but only for files that exist before you call <code>make()</code>.</p>
</div>
<div id="incompatible-with-dynamic-branching" class="section level4">
<h4><span class="header-section-number">4.6.2.3</span> Incompatible with dynamic branching</h4>
<p><code>file_out()</code> and <code>knitr_in()</code> deal with static output files, so they must not be used with <a href="dynamic.html#dynamic">dynamic branching</a>. As an alternative, consider dynamic files (described below). You can still use <code>file_in()</code>, but only for files that <em>all</em> the dynamic sub-targets depend on. (Changing a static input file dependency will invalidate all the sub-targets.)</p>
</div>
<div id="database-connections" class="section level4">
<h4><span class="header-section-number">4.6.2.4</span> Database connections</h4>
<p><code>file_in()</code> and friends do not help us manage database connections. If you work with a database, the most general best practice is to always <a href="triggers.html#triggers">trigger</a> a snapshot to make sure you have the latest data.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb51-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb51-3" data-line-number="3">     <span class="kw">get_data_from_db</span>(<span class="st">&quot;my_table&quot;</span>), <span class="co"># Define yourself.</span></a>
<a class="sourceLine" id="cb51-4" data-line-number="4">     <span class="dt">trigger =</span> <span class="kw">trigger</span>(<span class="dt">condition =</span> <span class="ot">TRUE</span>) <span class="co"># Always runs.</span></a>
<a class="sourceLine" id="cb51-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb51-6" data-line-number="6">  <span class="dt">preprocess =</span> <span class="kw">my_preprocessing</span>(data) <span class="co"># Runs when the data change.</span></a>
<a class="sourceLine" id="cb51-7" data-line-number="7">)</a></code></pre></div>
<p>In specific use cases, you may be able to watch database metadata for changes, but this information is situation-specific.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">library</span>(DBI)</a>
<a class="sourceLine" id="cb52-2" data-line-number="2"></a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="co"># Connection objects are brittle, so they should not be targets.</span></a>
<a class="sourceLine" id="cb52-4" data-line-number="4"><span class="co"># We define them up front, and we use ignore() to prevent</span></a>
<a class="sourceLine" id="cb52-5" data-line-number="5"><span class="co"># drake from rerunning targets when the connection object changes.</span></a>
<a class="sourceLine" id="cb52-6" data-line-number="6">con &lt;-<span class="st">  </span><span class="kw">dbConnect</span>(...)</a>
<a class="sourceLine" id="cb52-7" data-line-number="7"></a>
<a class="sourceLine" id="cb52-8" data-line-number="8">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb52-9" data-line-number="9">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb52-10" data-line-number="10">     <span class="kw">dbReadTable</span>(<span class="kw">ignore</span>(con), <span class="st">&quot;my_table&quot;</span>), <span class="co"># Use ignore() for db connection objects.</span></a>
<a class="sourceLine" id="cb52-11" data-line-number="11">     <span class="dt">trigger =</span> <span class="kw">trigger</span>(<span class="dt">change =</span> <span class="kw">somehow_get_db_timestamp</span>()) <span class="co"># Define yourself.</span></a>
<a class="sourceLine" id="cb52-12" data-line-number="12">  ),</a>
<a class="sourceLine" id="cb52-13" data-line-number="13">  <span class="dt">preprocess =</span> <span class="kw">my_preprocessing</span>(data) <span class="co"># runs when the data change</span></a>
<a class="sourceLine" id="cb52-14" data-line-number="14">)</a></code></pre></div>
</div>
</div>
</div>
<div id="dynamic-files" class="section level2">
<h2><span class="header-section-number">4.7</span> Dynamic files</h2>
<p><code>drake</code> &gt;= 7.11.0 supports dynamic files through a specialized format. With dynamic files, <code>drake</code> can watch local files without knowing them in advance. This is a more flexible alternative to <code>file_out()</code> and <code>file_in()</code>, and it is fully compatible with <a href="dynamic.html#dynamic">dynamic branching</a>.</p>
<div id="how-to-use-dynamic-files" class="section level3">
<h3><span class="header-section-number">4.7.1</span> How to use dynamic files</h3>
<ol style="list-style-type: decimal">
<li>Set format = “file” in target() within drake_plan().</li>
<li>Return the paths to local files from the target.</li>
<li>To link targets together in dependency relationships, reference target names and not literal character strings.</li>
</ol>
</div>
<div id="example-of-dynamic-files" class="section level3">
<h3><span class="header-section-number">4.7.2</span> Example of dynamic files</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">bad_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">  <span class="dt">upstream =</span> <span class="kw">target</span>({</a>
<a class="sourceLine" id="cb53-3" data-line-number="3">      <span class="kw">writeLines</span>(<span class="st">&quot;one line&quot;</span>, <span class="st">&quot;my file&quot;</span>) <span class="co"># Make sure the file exists.</span></a>
<a class="sourceLine" id="cb53-4" data-line-number="4">      <span class="st">&quot;my file&quot;</span> <span class="co"># Must return the file path.</span></a>
<a class="sourceLine" id="cb53-5" data-line-number="5">    },</a>
<a class="sourceLine" id="cb53-6" data-line-number="6">    <span class="dt">format =</span> <span class="st">&quot;file&quot;</span> <span class="co"># Necessary for dynamic files</span></a>
<a class="sourceLine" id="cb53-7" data-line-number="7">  ),</a>
<a class="sourceLine" id="cb53-8" data-line-number="8">  <span class="dt">downstream =</span> <span class="kw">readLines</span>(<span class="st">&quot;my file&quot;</span>) <span class="co"># Oops!</span></a>
<a class="sourceLine" id="cb53-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb53-10" data-line-number="10"></a>
<a class="sourceLine" id="cb53-11" data-line-number="11"><span class="kw">plot</span>(bad_plan)</a></code></pre></div>
<div id="htmlwidget-d6a708145d7725acdca8" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-d6a708145d7725acdca8">{"x":{"nodes":{"id":["downstream","upstream"],"imported":[false,false],"label":["downstream","upstream"],"status":["outdated","outdated"],"type":["object","object"],"font.size":[20,20],"color":["#000000","#000000"],"shape":["dot","dot"],"level":[1,1],"x":[0,0],"y":[-1,1]},"edges":{"from":[],"to":[]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Object"],"color":["#000000","#888888"],"shape":["dot","dot"],"font.color":["black","black"],"font.size":[20,20],"id":[2,8]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"></a>
<a class="sourceLine" id="cb54-2" data-line-number="2">good_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb54-3" data-line-number="3">  <span class="dt">upstream =</span> <span class="kw">target</span>({</a>
<a class="sourceLine" id="cb54-4" data-line-number="4">      <span class="kw">writeLines</span>(<span class="st">&quot;one line&quot;</span>, <span class="st">&quot;my file&quot;</span>) <span class="co"># Make sure the file exists.</span></a>
<a class="sourceLine" id="cb54-5" data-line-number="5">      <span class="st">&quot;my file&quot;</span> <span class="co"># Must return the file path.</span></a>
<a class="sourceLine" id="cb54-6" data-line-number="6">    },</a>
<a class="sourceLine" id="cb54-7" data-line-number="7">    <span class="dt">format =</span> <span class="st">&quot;file&quot;</span> <span class="co"># Necessary for dynamic files</span></a>
<a class="sourceLine" id="cb54-8" data-line-number="8">  ),</a>
<a class="sourceLine" id="cb54-9" data-line-number="9">  <span class="dt">downstream =</span> <span class="kw">readLines</span>(upstream) <span class="co"># Use the target name.</span></a>
<a class="sourceLine" id="cb54-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb54-11" data-line-number="11"></a>
<a class="sourceLine" id="cb54-12" data-line-number="12"><span class="kw">plot</span>(good_plan)</a></code></pre></div>
<div id="htmlwidget-ac107c500d52c5ea361f" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac107c500d52c5ea361f">{"x":{"nodes":{"id":["upstream","downstream"],"imported":[false,false],"label":["upstream","downstream"],"status":["outdated","outdated"],"type":["object","object"],"font.size":[20,20],"color":["#000000","#000000"],"shape":["dot","dot"],"level":[1,2],"x":[-1,1],"y":[0,0]},"edges":{"from":["upstream"],"to":["downstream"],"arrows":["to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Object"],"color":["#000000","#888888"],"shape":["dot","dot"],"font.color":["black","black"],"font.size":[20,20],"id":[2,8]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="kw">make</span>(good_plan)</a>
<a class="sourceLine" id="cb55-3" data-line-number="3"><span class="co">#&gt; ▶ target upstream</span></a>
<a class="sourceLine" id="cb55-4" data-line-number="4"><span class="co">#&gt; ▶ target downstream</span></a>
<a class="sourceLine" id="cb55-5" data-line-number="5"></a>
<a class="sourceLine" id="cb55-6" data-line-number="6"><span class="co"># Change how the file is generated.</span></a>
<a class="sourceLine" id="cb55-7" data-line-number="7">good_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb55-8" data-line-number="8">  <span class="dt">upstream =</span> <span class="kw">target</span>({</a>
<a class="sourceLine" id="cb55-9" data-line-number="9">      <span class="kw">writeLines</span>(<span class="st">&quot;different line&quot;</span>, <span class="st">&quot;my file&quot;</span>) <span class="co"># Change the file.</span></a>
<a class="sourceLine" id="cb55-10" data-line-number="10">      <span class="st">&quot;my file&quot;</span></a>
<a class="sourceLine" id="cb55-11" data-line-number="11">    },</a>
<a class="sourceLine" id="cb55-12" data-line-number="12">    <span class="dt">format =</span> <span class="st">&quot;file&quot;</span></a>
<a class="sourceLine" id="cb55-13" data-line-number="13">  ),</a>
<a class="sourceLine" id="cb55-14" data-line-number="14">  <span class="dt">downstream =</span> <span class="kw">readLines</span>(upstream)</a>
<a class="sourceLine" id="cb55-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb55-16" data-line-number="16"></a>
<a class="sourceLine" id="cb55-17" data-line-number="17"><span class="co"># The downstream target automatically reruns.</span></a>
<a class="sourceLine" id="cb55-18" data-line-number="18"><span class="kw">make</span>(good_plan)</a>
<a class="sourceLine" id="cb55-19" data-line-number="19"><span class="co">#&gt; ▶ target upstream</span></a>
<a class="sourceLine" id="cb55-20" data-line-number="20"><span class="co">#&gt; ▶ target downstream</span></a></code></pre></div>
</div>
<div id="limitations-of-dynamic-files" class="section level3">
<h3><span class="header-section-number">4.7.3</span> Limitations of dynamic files</h3>
<p>Unlike <code>file_in()</code>, dynamic files cannot handle URLs. All files and directories must have valid local paths.</p>
</div>
</div>
<div id="large-plans" class="section level2">
<h2><span class="header-section-number">4.8</span> Large plans</h2>
<p><code>drake</code> has special interfaces to concisely define large numbers of targets. See the chapters on <a href="static.html#static">static branching</a> and <a href="dynamic.html#dynamic">dynamic branching</a> for details.</p>

</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="walkthrough.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="static.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropensci-books/drake/edit/master/plans.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropensci-books/drake/commits/master/plans.Rmd",
"text": "Chapter edit history"
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
